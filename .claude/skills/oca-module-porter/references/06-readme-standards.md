# OCA README Standards and oca-gen-addon-readme

Sources:
- https://github.com/OCA/maintainer-tools/blob/master/README.md
- https://github.com/OCA/maintainer-tools/tree/master/template/module/readme
- https://github.com/OCA/maintainer-tools/blob/master/tools/gen_addon_readme.py

---

## README Fragment Files

OCA generates `README.rst` automatically from fragment files placed in `readme/` inside each module.
Never edit `README.rst` directly — it is overwritten by the hook.

### Required Fragment

| File | Required | Notes |
|------|----------|-------|
| `readme/DESCRIPTION.rst` | YES | What the module does |

### Recommended Fragments

| File | Notes |
|------|-------|
| `readme/USAGE.rst` | How to use the module |
| `readme/CONTRIBUTORS.rst` | List of contributors |

### Optional Fragments

| File | Notes |
|------|-------|
| `readme/INSTALL.rst` | Installation requirements beyond standard |
| `readme/CONFIGURE.rst` | Configuration steps after installation |
| `readme/ROADMAP.rst` | Future plans / known limitations |
| `readme/HISTORY.rst` | Changelog (auto-generated by towncrier if using newsfragments) |
| `readme/CREDITS.rst` | Financing acknowledgments (remove on migration!) |

### Changelog Fragments (towncrier)

```
readme/newsfragments/
    123.feature        # New feature (linked to PR #123)
    456.fix            # Bug fix
    789.improvement    # Improvement
    42.breaking        # Breaking change
    55.doc             # Documentation update
    66.removal         # Feature removal
```

---

## Fragment Format Rules

Each `.rst` file must:
- Contain only **body content** (paragraphs, lists, tables, images)
- NOT have section titles (no `===`, `---`, `~~~` underlines)
- Use valid RST syntax

Example `DESCRIPTION.rst`:
```rst
This module extends the standard account move functionality to support
multi-currency invoice validation with automatic exchange rate computation.

Key features:

* Automatic exchange rate lookup via configured provider
* Manual override option per invoice line
* Audit trail for all rate changes
* Compatible with OCA account-financial-tools
```

Example `CONTRIBUTORS.rst`:
```rst
* `FirstName LastName <email@example.com>`__
* `Another Contributor <another@example.com>`__
```

Example `USAGE.rst`:
```rst
Go to **Accounting > Invoices** and create a new invoice.

When selecting a foreign currency, the exchange rate is automatically
fetched from the configured provider. To override the rate:

#. Click on the **Exchange Rate** field
#. Enter the desired rate manually
#. Save the invoice
```

---

## oca-gen-addon-readme Command

```bash
# Basic usage
oca-gen-addon-readme \
  --repo-name=server-tools \
  --branch=19.0 \
  --addon-dir=server_environment

# Custom organization
oca-gen-addon-readme \
  --repo-name=server-tools \
  --branch=19.0 \
  --addon-dir=server_environment \
  --org-name=myorganization

# Process multiple addons in a directory
oca-gen-addon-readme \
  --repo-name=server-tools \
  --branch=19.0 \
  --addons-dir=. \
  --if-source-missing=ignore

# Skip if README.rst already exists
oca-gen-addon-readme \
  --repo-name=server-tools \
  --branch=19.0 \
  --addon-dir=server_environment \
  --if-source-missing=skip

# Fail if DESCRIPTION.rst is missing
oca-gen-addon-readme \
  --repo-name=server-tools \
  --branch=19.0 \
  --addon-dir=server_environment \
  --if-source-missing=fail
```

**Options**:
| Option | Description |
|--------|-------------|
| `--repo-name` | GitHub repository name (used for links) |
| `--branch` | Target branch (used for links) |
| `--addon-dir` | Single addon directory |
| `--addons-dir` | Directory containing multiple addons |
| `--org-name` | GitHub organization (default: OCA) |
| `--if-source-missing` | Action if DESCRIPTION.rst missing: `ignore`, `skip`, `fail` |

---

## Generated README.rst Structure

The generated README contains:

1. **Module name and badges** (build status, maturity, license, etc.)
2. **Table of Contents**
3. **Description** (from `DESCRIPTION.rst`)
4. **Installation** (from `INSTALL.rst` if present)
5. **Configuration** (from `CONFIGURE.rst` if present)
6. **Usage** (from `USAGE.rst` if present)
7. **Known Issues / Roadmap** (from `ROADMAP.rst` if present)
8. **Changelog** (from `HISTORY.rst` if present)
9. **Bug Tracker** (auto-generated GitHub issues link)
10. **Credits / Contributors** (from `CONTRIBUTORS.rst`)
11. **Maintainers** (from manifest `maintainers` field)
12. **License** (from manifest `license` field)

---

## Badges Auto-Generated

The README includes badges pulled from:
- `development_status` in manifest → maturity badge
- `license` in manifest → license badge
- `maintainers` in manifest → OCA maintainer badge
- Repository → build status badges

---

## Pre-Commit Hook Configuration

In `.pre-commit-config.yaml`:

```yaml
- repo: https://github.com/OCA/maintainer-tools
  rev: 0.1.39
  hooks:
    - id: oca-gen-addon-readme
      args:
        - '--addons-dir'
        - '.'
        - '--if-source-missing'
        - 'ignore'    # Don't fail if DESCRIPTION.rst missing (useful during porting)
```

---

## Minimum README Setup for a Port

The minimum to satisfy pre-commit:

```bash
mkdir -p ${MODULE}/readme

cat > ${MODULE}/readme/DESCRIPTION.rst << 'EOF'
This module provides [brief description of what it does].
EOF

cat > ${MODULE}/readme/CONTRIBUTORS.rst << 'EOF'
* `Original Author <original@example.com>`__
EOF

# Generate README.rst
oca-gen-addon-readme \
  --repo-name=${REPO} \
  --branch=${TO_VERSION} \
  --addon-dir=${MODULE} \
  --if-source-missing=ignore
```

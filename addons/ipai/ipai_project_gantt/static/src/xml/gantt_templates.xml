<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">
    <t t-name="ipai_project_gantt.IpaiProjectGantt">
        <div class="ipai-gantt">
            <!-- Header with controls -->
            <div class="ipai-gantt__header">
                <div class="ipai-gantt__title-row">
                    <h2>Gantt (IPAI)</h2>
                    <div class="ipai-gantt__hint">
                        Set <b>Planned Start</b> / <b>Planned End</b> on tasks to display them here.
                    </div>
                </div>
                <div class="ipai-gantt__controls">
                    <select class="ipai-gantt__select" t-on-change="onProjectChange">
                        <option value="">All Projects</option>
                        <t t-foreach="state.projects" t-as="p" t-key="p.id">
                            <option t-att-value="p.id" t-att-selected="state.selectedProjectId === p.id">
                                <t t-esc="p.name"/>
                            </option>
                        </t>
                    </select>
                    <button class="btn btn-secondary btn-sm" t-on-click="refresh">
                        Refresh
                    </button>
                    <button class="btn btn-primary btn-sm" t-on-click="openTaskList">
                        View Task List
                    </button>
                </div>
            </div>

            <!-- Loading state -->
            <t t-if="state.loading">
                <div class="ipai-gantt__loading">
                    <span class="fa fa-spinner fa-spin"/> Loading tasks...
                </div>
            </t>

            <!-- Error state -->
            <t t-if="state.error">
                <div class="ipai-gantt__error">
                    <b>Error:</b> <t t-esc="state.error"/>
                </div>
            </t>

            <!-- Main content -->
            <t t-if="!state.loading and !state.error">
                <!-- Empty state -->
                <t t-if="!state.tasks.length">
                    <div class="ipai-gantt__empty">
                        <div class="ipai-gantt__empty-icon">
                            <span class="fa fa-calendar-alt fa-3x"/>
                        </div>
                        <p>No tasks with planned dates found.</p>
                        <p class="text-muted">
                            Set <b>Planned Start</b> and <b>Planned End</b> on tasks to see them here.
                        </p>
                    </div>
                </t>

                <!-- Task list with bars -->
                <t t-if="state.tasks.length">
                    <div class="ipai-gantt__summary">
                        Showing <b><t t-esc="state.tasks.length"/></b> tasks
                        <t t-if="state.selectedProjectId"> in selected project</t>
                    </div>

                    <div class="ipai-gantt__list">
                        <t t-foreach="state.tasks" t-as="task" t-key="task.id">
                            <div class="ipai-gantt__row" t-on-click="() => this.openTask(task.id)">
                                <!-- Task metadata -->
                                <div class="ipai-gantt__meta">
                                    <div class="ipai-gantt__task-name">
                                        <t t-esc="task.name"/>
                                    </div>
                                    <div class="ipai-gantt__tags">
                                        <span class="ipai-gantt__tag ipai-gantt__tag--project">
                                            <t t-esc="task.project"/>
                                        </span>
                                        <span class="ipai-gantt__tag ipai-gantt__tag--stage">
                                            <t t-esc="task.stage"/>
                                        </span>
                                        <t t-if="task.priority !== '0'">
                                            <span class="ipai-gantt__tag ipai-gantt__tag--priority">
                                                P<t t-esc="task.priority"/>
                                            </span>
                                        </t>
                                        <t t-if="task.duration">
                                            <span class="ipai-gantt__tag ipai-gantt__tag--duration">
                                                <t t-esc="Math.round(task.duration * 10) / 10"/>d
                                            </span>
                                        </t>
                                    </div>
                                </div>

                                <!-- Timeline track -->
                                <div class="ipai-gantt__track">
                                    <div class="ipai-gantt__bar"
                                         t-att-style="getBarStyle(task) + ' background-color: ' + getBarColor(task) + ';'">
                                        <span class="ipai-gantt__bar-text">
                                            <t t-esc="formatDate(task.start)"/> â†’ <t t-esc="formatDate(task.end)"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </t>
            </t>
        </div>
    </t>
</templates>

{"version":3,"sources":["../../../../../../../../../../Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/app/%28app%29/projects/%5BprojectId%5D/builds/%5BbuildId%5D/monitor/page.tsx"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\n\ninterface MetricDataPoint {\n  timestamp: string;\n  value: number;\n}\n\ninterface Metric {\n  key: string;\n  label: string;\n  current: string;\n  data: MetricDataPoint[];\n  unit: string;\n}\n\nfunction formatTime(ts: string): string {\n  const date = new Date(ts);\n  return date.toLocaleTimeString(\"en-US\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    hour12: false,\n  });\n}\n\nexport default async function BuildMonitorPage({\n  params,\n}: {\n  params: Promise<{ projectId: string; buildId: string }>;\n}) {\n  const { projectId } = await params;\n\n  const supabase = await createClient();\n\n  // Fetch metrics for the last hour\n  const metricKeys = [\"cpu_pct\", \"mem_mb\", \"p95_ms\", \"req_rate\"];\n  const metricConfigs = {\n    cpu_pct: { label: \"CPU Usage\", unit: \"%\" },\n    mem_mb: { label: \"Memory Usage\", unit: \"MB\" },\n    p95_ms: { label: \"Response Time (P95)\", unit: \"ms\" },\n    req_rate: { label: \"Requests/Min\", unit: \"req/min\" },\n  };\n\n  const metricsPromises = metricKeys.map((metricKey) =>\n    supabase\n      .rpc(\"ops.project_metrics\", {\n        p_project_id: projectId,\n        p_metric: metricKey,\n        p_hours: 1,\n      })\n      .then((res) => ({\n        key: metricKey,\n        data: res.data || [],\n        error: res.error,\n      }))\n  );\n\n  const metricsResults = await Promise.all(metricsPromises);\n\n  // Check for errors\n  const firstError = metricsResults.find((r) => r.error);\n  if (firstError?.error) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-lg font-semibold\">Performance Monitor</h2>\n        </div>\n        <div className=\"rounded-md bg-red-50 p-4\">\n          <h3 className=\"text-sm font-medium text-red-800\">\n            Error loading metrics\n          </h3>\n          <p className=\"mt-2 text-sm text-red-700\">\n            {firstError.error.message}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const metrics: Metric[] = metricsResults.map((result) => {\n    const config =\n      metricConfigs[result.key as keyof typeof metricConfigs];\n    const data = result.data.map((d: any) => ({\n      timestamp: formatTime(d.ts),\n      value: Number(d.value),\n    }));\n    const current = data.length > 0 ? data[0].value : 0;\n\n    return {\n      key: result.key,\n      label: config.label,\n      current: `${current.toFixed(1)} ${config.unit}`,\n      unit: config.unit,\n      data: data.reverse(), // Oldest to newest for chart\n    };\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-lg font-semibold\">Performance Monitor</h2>\n        <div className=\"flex gap-2\">\n          <select className=\"px-3 py-1.5 text-sm border border-gray-300 rounded\">\n            <option>Last 5 minutes</option>\n            <option>Last hour</option>\n            <option>Last 24 hours</option>\n          </select>\n          <button className=\"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-50\">\n            Refresh\n          </button>\n        </div>\n      </div>\n\n      {/* Metrics Grid */}\n      <div className=\"grid grid-cols-2 gap-6\">\n        {metrics.map((metric) => (\n          <div\n            key={metric.key}\n            className=\"bg-white border border-gray-200 rounded-lg p-4\"\n          >\n            {/* Metric Header */}\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-sm font-semibold text-gray-700\">\n                {metric.label}\n              </h3>\n              <span className=\"text-2xl font-bold text-gray-900\">\n                {metric.current}\n              </span>\n            </div>\n\n            {/* Simple Chart Visualization */}\n            <div className=\"space-y-2\">\n              <div className=\"flex items-end gap-1 h-32\">\n                {metric.data.map((point, idx) => {\n                  const maxValue = Math.max(...metric.data.map((d) => d.value));\n                  const heightPercent = (point.value / maxValue) * 100;\n\n                  return (\n                    <div\n                      key={idx}\n                      className=\"flex-1 bg-blue-500 rounded-t transition-all hover:bg-blue-600\"\n                      style={{ height: `${heightPercent}%` }}\n                      title={`${point.timestamp}: ${point.value}${metric.unit}`}\n                    />\n                  );\n                })}\n              </div>\n\n              {/* Time Labels */}\n              <div className=\"flex justify-between text-xs text-gray-500\">\n                {metric.data.map((point, idx) => (\n                  <span key={idx}>{point.timestamp}</span>\n                ))}\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Additional Metrics Table */}\n      <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div className=\"px-4 py-3 border-b border-gray-200 bg-gray-50\">\n          <h3 className=\"text-sm font-semibold\">Health Metrics</h3>\n        </div>\n        <div className=\"divide-y divide-gray-200\">\n          {[\n            { label: \"Database Connections\", value: \"12 / 100\", status: \"healthy\" },\n            { label: \"Cache Hit Rate\", value: \"94.2%\", status: \"healthy\" },\n            { label: \"Error Rate\", value: \"0.01%\", status: \"healthy\" },\n            { label: \"Uptime\", value: \"99.98%\", status: \"healthy\" },\n          ].map((item, idx) => (\n            <div key={idx} className=\"px-4 py-3 flex items-center justify-between\">\n              <span className=\"text-sm text-gray-700\">{item.label}</span>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-medium\">{item.value}</span>\n                <span className=\"w-2 h-2 bg-green-500 rounded-full\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"0dAAA,EAAA,EAAA,CAAA,CAAA,OAwBe,eAAe,EAAiB,QAC7C,CAAM,CAGP,EACC,GAAM,WAAE,CAAS,CAAE,CAAG,MAAM,EAEtB,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAI7B,EAAgB,CACpB,QAAS,CAAE,MAAO,YAAa,KAAM,GAAI,EACzC,OAAQ,CAAE,MAAO,eAAgB,KAAM,IAAK,EAC5C,OAAQ,CAAE,MAAO,sBAAuB,KAAM,IAAK,EACnD,SAAU,CAAE,MAAO,eAAgB,KAAM,SAAU,CACrD,EAEM,EARa,AAQK,CARJ,UAAW,SAAU,SAAU,WAAW,CAQ3B,GAAG,CAAC,AAAC,GACtC,EACG,GAAG,CAAC,sBAAuB,CAC1B,aAAc,EACd,SAAU,EACV,QAAS,CACX,GACC,IAAI,CAAC,AAAC,GAAS,EACd,CADa,GACR,EACL,KAAM,EAAI,IAAI,EAAI,EAAE,CACpB,MAAO,EAAI,KAAK,CAClB,CAAC,GAGC,EAAiB,MAAM,QAAQ,GAAG,CAAC,GAGnC,EAAa,EAAe,IAAI,CAAC,AAAC,GAAM,EAAE,KAAK,EACrD,GAAI,GAAY,MACd,CADqB,KAEnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6CACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iCAAwB,0BAExC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,qCACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,4CAAmC,0BAGjD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qCACV,EAAW,KAAK,CAAC,OAAO,SAOnC,IAAM,EAAoB,EAAe,GAAG,CAAC,AAAC,IAC5C,IAAM,EACJ,CAAa,CAAC,EAAO,GAAG,CAA+B,CACnD,EAAO,EAAO,IAAI,CAAC,GAAG,CAAC,AAAC,IAAW,AAAC,CACxC,UAjEG,AADM,CAkEE,GAlEE,KAkES,AAlEJ,EAkEM,EAAE,EAjElB,kBAAkB,CAAC,QAAS,CACtC,KAAM,UACN,OAAQ,UACR,QAAQ,CACV,GA8DI,MAAO,OAAO,EAAE,KAAK,EACvB,CAAC,EACK,EAAU,EAAK,MAAM,CAAG,EAAI,CAAI,CAAC,EAAE,CAAC,KAAK,CAAG,EAElD,MAAO,CACL,IAAK,EAAO,GAAG,CACf,MAAO,EAAO,KAAK,CACnB,QAAS,CAAA,EAAG,EAAQ,OAAO,CAAC,GAAG,CAAC,EAAE,EAAO,IAAI,CAAA,CAAE,CAC/C,KAAM,EAAO,IAAI,CACjB,KAAM,EAAK,OAAO,EACpB,CACF,GAEA,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iCAAwB,wBACtC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CAAO,UAAU,+DAChB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,mBACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,cACR,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,qBAEV,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,+EAAsE,kBAO5F,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kCACZ,EAAQ,GAAG,CAAC,AAAC,GACZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAEC,UAAU,2DAGV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,+CACX,EAAO,KAAK,GAEf,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4CACb,EAAO,OAAO,MAKnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qCACZ,EAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAO,KACvB,IAAM,EAAW,KAAK,GAAG,IAAI,EAAO,IAAI,CAAC,GAAG,CAAC,AAAC,GAAM,EAAE,KAAK,GACrD,EAAiB,EAAM,KAAK,CAAG,EAAY,IAEjD,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAEC,UAAU,gEACV,MAAO,CAAE,OAAQ,CAAA,EAAG,EAAc,CAAC,CAAC,AAAC,EACrC,MAAO,CAAA,EAAG,EAAM,SAAS,CAAC,EAAE,EAAE,EAAM,KAAK,CAAA,EAAG,EAAO,IAAI,CAAA,CAAE,EAHpD,EAMX,KAIF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sDACZ,EAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAO,IACvB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAgB,EAAM,SAAS,EAArB,WAlCZ,EAAO,GAAG,KA2CrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uEACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iCAAwB,qBAExC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oCACZ,CACC,CAAE,MAAO,uBAAwB,MAAO,WAAY,OAAQ,SAAU,EACtE,CAAE,MAAO,iBAAkB,MAAO,QAAS,OAAQ,SAAU,EAC7D,CAAE,MAAO,aAAc,MAAO,QAAS,OAAQ,SAAU,EACzD,CAAE,MAAO,SAAU,MAAO,SAAU,OAAQ,SAAU,EACvD,CAAC,GAAG,CAAC,CAAC,EAAM,IACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAc,UAAU,wDACvB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAyB,EAAK,KAAK,GACnD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BAAuB,EAAK,KAAK,GACjD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,2CAJV,WAYtB"}
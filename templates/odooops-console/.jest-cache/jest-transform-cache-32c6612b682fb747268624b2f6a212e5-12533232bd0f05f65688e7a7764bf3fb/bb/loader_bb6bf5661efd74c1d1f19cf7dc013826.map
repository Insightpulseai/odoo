{"version":3,"sources":["/Users/tbwa/Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/src/lib/docs/loader.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport matter from \"gray-matter\";\n\n// Paths\n// Paths\nconst REPO_ROOT = path.resolve(process.cwd(), \"../..\"); // Assuming running from templates/odooops-console\nconst OVERRIDES_DIR = path.join(\n  process.cwd(),\n  \"src/content/docs/upstream_overrides\",\n);\nconst DEPLOYED_DIR = path.join(process.cwd(), \"src/content/docs/stack\");\nconst UPSTREAM_DIR = path.resolve(REPO_ROOT, \"docs/kb/odoo19/upstream\");\n\nexport interface DocMetadata {\n  layer: \"override\" | \"deployed\" | \"upstream\";\n  sourcePath: string;\n  canonicalId: string;\n  pinnedSha?: string; // Only for upstream\n  [key: string]: any;\n}\n\nexport interface DocPage {\n  slug: string;\n  title: string;\n  content: string;\n  meta: DocMetadata;\n}\n\nexport async function getDocPage(slugParts: string[]): Promise<DocPage | null> {\n  const slugPath = slugParts.join(\"/\");\n\n  // 1. Check Overrides (Highest Priority)\n  const overridePath = path.join(OVERRIDES_DIR, `${slugPath}.md`);\n  if (fs.existsSync(overridePath)) {\n    return loadFile(overridePath, slugPath, \"override\");\n  } else {\n    // Check for index file in directory\n    const overrideIndexPath = path.join(OVERRIDES_DIR, slugPath, \"index.md\");\n    if (fs.existsSync(overrideIndexPath)) {\n      return loadFile(overrideIndexPath, slugPath, \"override\");\n    }\n  }\n\n  // 2. Check Deployed Stack (Middle Priority)\n  const deployedPath = path.join(DEPLOYED_DIR, `${slugPath}.md`);\n  if (fs.existsSync(deployedPath)) {\n    return loadFile(deployedPath, slugPath, \"deployed\");\n  }\n\n  // 3. Check Upstream (Lowest Priority)\n  const upstreamContentDir = path.join(UPSTREAM_DIR, \"content\");\n\n  // Check for MD/MDX first\n  let upstreamPath = path.join(upstreamContentDir, `${slugPath}.md`);\n  if (fs.existsSync(upstreamPath)) {\n    return loadFile(upstreamPath, slugPath, \"upstream\");\n  }\n\n  // Check for RST\n  upstreamPath = path.join(upstreamContentDir, `${slugPath}.rst`);\n  if (fs.existsSync(upstreamPath)) {\n    return loadFile(upstreamPath, slugPath, \"upstream\");\n  }\n\n  // Check for index (MD then RST)\n  const upstreamIndexMd = path.join(upstreamContentDir, slugPath, \"index.md\");\n  if (fs.existsSync(upstreamIndexMd)) {\n    return loadFile(upstreamIndexMd, slugPath, \"upstream\");\n  }\n  const upstreamIndexRst = path.join(upstreamContentDir, slugPath, \"index.rst\");\n  if (fs.existsSync(upstreamIndexRst)) {\n    return loadFile(upstreamIndexRst, slugPath, \"upstream\");\n  }\n\n  return null;\n}\n\nfunction loadFile(\n  filePath: string,\n  slug: string,\n  layer: \"override\" | \"deployed\" | \"upstream\",\n): DocPage {\n  const fileContent = fs.readFileSync(filePath, \"utf8\");\n  const { data, content } = matter(fileContent);\n\n  // Canonical ID: kb://odoo19/<slug>\n  // This ID is stable regardless of which layer serves the content.\n  const canonicalId = `kb://odoo19/${slug}`;\n\n  // For upstream, we could read PIN file, but that might differ if verifying pin.\n  // We'll leave pinnedSha undefined for now or inject it if needed by UI.\n\n  const meta: DocMetadata = {\n    ...data,\n    layer,\n    sourcePath: filePath,\n    canonicalId,\n  };\n\n  return {\n    slug,\n    title: data.title || slug.split(\"/\").pop() || \"Untitled\",\n    content,\n    meta,\n  };\n}\n"],"names":["getDocPage","REPO_ROOT","path","resolve","process","cwd","OVERRIDES_DIR","join","DEPLOYED_DIR","UPSTREAM_DIR","slugParts","slugPath","overridePath","fs","existsSync","loadFile","overrideIndexPath","deployedPath","upstreamContentDir","upstreamPath","upstreamIndexMd","upstreamIndexRst","filePath","slug","layer","fileContent","readFileSync","data","content","matter","canonicalId","meta","sourcePath","title","split","pop"],"mappings":";;;;+BA6BsBA;;;eAAAA;;;2DA7BP;6DACE;mEACE;;;;;;AAEnB,QAAQ;AACR,QAAQ;AACR,MAAMC,YAAYC,aAAI,CAACC,OAAO,CAACC,QAAQC,GAAG,IAAI,UAAU,kDAAkD;AAC1G,MAAMC,gBAAgBJ,aAAI,CAACK,IAAI,CAC7BH,QAAQC,GAAG,IACX;AAEF,MAAMG,eAAeN,aAAI,CAACK,IAAI,CAACH,QAAQC,GAAG,IAAI;AAC9C,MAAMI,eAAeP,aAAI,CAACC,OAAO,CAACF,WAAW;AAiBtC,eAAeD,WAAWU,SAAmB;IAClD,MAAMC,WAAWD,UAAUH,IAAI,CAAC;IAEhC,wCAAwC;IACxC,MAAMK,eAAeV,aAAI,CAACK,IAAI,CAACD,eAAe,GAAGK,SAAS,GAAG,CAAC;IAC9D,IAAIE,WAAE,CAACC,UAAU,CAACF,eAAe;QAC/B,OAAOG,SAASH,cAAcD,UAAU;IAC1C,OAAO;QACL,oCAAoC;QACpC,MAAMK,oBAAoBd,aAAI,CAACK,IAAI,CAACD,eAAeK,UAAU;QAC7D,IAAIE,WAAE,CAACC,UAAU,CAACE,oBAAoB;YACpC,OAAOD,SAASC,mBAAmBL,UAAU;QAC/C;IACF;IAEA,4CAA4C;IAC5C,MAAMM,eAAef,aAAI,CAACK,IAAI,CAACC,cAAc,GAAGG,SAAS,GAAG,CAAC;IAC7D,IAAIE,WAAE,CAACC,UAAU,CAACG,eAAe;QAC/B,OAAOF,SAASE,cAAcN,UAAU;IAC1C;IAEA,sCAAsC;IACtC,MAAMO,qBAAqBhB,aAAI,CAACK,IAAI,CAACE,cAAc;IAEnD,yBAAyB;IACzB,IAAIU,eAAejB,aAAI,CAACK,IAAI,CAACW,oBAAoB,GAAGP,SAAS,GAAG,CAAC;IACjE,IAAIE,WAAE,CAACC,UAAU,CAACK,eAAe;QAC/B,OAAOJ,SAASI,cAAcR,UAAU;IAC1C;IAEA,gBAAgB;IAChBQ,eAAejB,aAAI,CAACK,IAAI,CAACW,oBAAoB,GAAGP,SAAS,IAAI,CAAC;IAC9D,IAAIE,WAAE,CAACC,UAAU,CAACK,eAAe;QAC/B,OAAOJ,SAASI,cAAcR,UAAU;IAC1C;IAEA,gCAAgC;IAChC,MAAMS,kBAAkBlB,aAAI,CAACK,IAAI,CAACW,oBAAoBP,UAAU;IAChE,IAAIE,WAAE,CAACC,UAAU,CAACM,kBAAkB;QAClC,OAAOL,SAASK,iBAAiBT,UAAU;IAC7C;IACA,MAAMU,mBAAmBnB,aAAI,CAACK,IAAI,CAACW,oBAAoBP,UAAU;IACjE,IAAIE,WAAE,CAACC,UAAU,CAACO,mBAAmB;QACnC,OAAON,SAASM,kBAAkBV,UAAU;IAC9C;IAEA,OAAO;AACT;AAEA,SAASI,SACPO,QAAgB,EAChBC,IAAY,EACZC,KAA2C;IAE3C,MAAMC,cAAcZ,WAAE,CAACa,YAAY,CAACJ,UAAU;IAC9C,MAAM,EAAEK,IAAI,EAAEC,OAAO,EAAE,GAAGC,IAAAA,mBAAM,EAACJ;IAEjC,mCAAmC;IACnC,kEAAkE;IAClE,MAAMK,cAAc,CAAC,YAAY,EAAEP,MAAM;IAEzC,gFAAgF;IAChF,wEAAwE;IAExE,MAAMQ,OAAoB;QACxB,GAAGJ,IAAI;QACPH;QACAQ,YAAYV;QACZQ;IACF;IAEA,OAAO;QACLP;QACAU,OAAON,KAAKM,KAAK,IAAIV,KAAKW,KAAK,CAAC,KAAKC,GAAG,MAAM;QAC9CP;QACAG;IACF;AACF"}
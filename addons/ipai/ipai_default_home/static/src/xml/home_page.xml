<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="ipai_default_home.HomePage">
        <div class="ipai-home-page">
            <div class="ipai-home-container">

                <!-- Loading State -->
                <div t-if="state.isLoading" class="ipai-app-grid-loading">
                    <div class="ipai-loading-spinner"></div>
                </div>

                <!-- Error State -->
                <div t-elif="state.error" class="ipai-error-message">
                    <p t-esc="state.error"/>
                </div>

                <!-- App Grid -->
                <section t-else="" class="ipai-app-grid-section">
                    <div class="ipai-app-grid">
                        <t t-foreach="state.filteredApps" t-as="app" t-key="app.id">
                            <a class="ipai-app-card"
                               t-on-click="() => this.onAppClick(app)"
                               t-on-contextmenu="(ev) => this.onAppContextMenu(ev, app)"
                               t-attf-style="animation-delay: #{app_index * 0.05}s">

                                <div class="ipai-app-icon-wrapper">
                                    <div class="ipai-app-icon-bg"></div>

                                    <!-- App Icon -->
                                    <t t-if="app.icon and app.icon.startsWith('data:')">
                                        <img class="ipai-app-icon" t-att-src="app.icon" t-att-alt="app.name"/>
                                    </t>
                                    <t t-elif="app.icon">
                                        <img class="ipai-app-icon"
                                             t-att-src="app.icon"
                                             t-att-alt="app.name"
                                             onerror="this.src='/base/static/description/icon.png'"/>
                                    </t>
                                    <t t-else="">
                                        <div class="ipai-app-icon ipai-app-icon-default"
                                             t-attf-style="background-color: #{app.color}">
                                            <span t-esc="app.name.charAt(0).toUpperCase()"/>
                                        </div>
                                    </t>

                                    <!-- Badge for unread count -->
                                    <span t-if="app.unread > 0" class="ipai-app-badge">
                                        <t t-esc="app.unread > 99 ? '99+' : app.unread"/>
                                    </span>
                                </div>

                                <div class="ipai-app-name" t-esc="app.name"/>
                            </a>
                        </t>
                    </div>

                    <!-- Empty State -->
                    <div t-if="state.filteredApps.length === 0 and !state.isLoading"
                         class="text-center py-5">
                        <p class="text-muted">No apps found</p>
                    </div>
                </section>

            </div>

            <!-- Search Overlay -->
            <div t-attf-class="ipai-search-overlay #{state.showSearch ? 'active' : ''}">
                <div class="ipai-search-container">
                    <input type="search"
                           class="ipai-search-input"
                           placeholder="Search apps... (Ctrl+K)"
                           t-att-value="state.searchQuery"
                           t-on-input="onSearchInput"/>

                    <div t-if="state.searchQuery" class="ipai-search-results">
                        <t t-foreach="state.filteredApps" t-as="app" t-key="app.id">
                            <div class="ipai-search-result-item"
                                 t-on-click="() => this.onSearchResultClick(app)">
                                <div class="ipai-search-result-icon">
                                    <img t-att-src="app.icon || '/base/static/description/icon.png'"
                                         t-att-alt="app.name"
                                         onerror="this.src='/base/static/description/icon.png'"/>
                                </div>
                                <div class="ipai-search-result-content">
                                    <div class="ipai-search-result-title" t-esc="app.name"/>
                                    <div class="ipai-search-result-desc" t-esc="app.id"/>
                                </div>
                            </div>
                        </t>

                        <div t-if="state.filteredApps.length === 0"
                             class="ipai-search-result-item text-muted">
                            No apps found
                        </div>
                    </div>
                </div>
            </div>

            <!-- Context Menu -->
            <div t-if="state.contextMenu"
                 class="ipai-context-menu"
                 t-attf-style="top: #{state.contextMenu.y}px; left: #{state.contextMenu.x}px;">
                <div class="ipai-context-menu-item"
                     t-on-click="() => this.onContextMenuOpen(state.contextMenu.app)">
                    Open
                </div>
                <div class="ipai-context-menu-item"
                     t-on-click="() => this.onContextMenuNewWindow(state.contextMenu.app)">
                    Open in New Tab
                </div>
                <div class="ipai-context-menu-divider"></div>
                <div class="ipai-context-menu-item"
                     t-on-click="() => this.onContextMenuFavorite(state.contextMenu.app)">
                    <t t-if="this.isFavorite(state.contextMenu.app)">Remove from Favorites</t>
                    <t t-else="">Add to Favorites</t>
                </div>
            </div>

        </div>
    </t>

</templates>

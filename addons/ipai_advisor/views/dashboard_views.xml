<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>
    <!-- Advisor Overview Kanban (Azure Advisor-style tiles) -->
    <record id="view_advisor_category_kanban" model="ir.ui.view">
      <field name="name">advisor.category.kanban.overview</field>
      <field name="model">advisor.category</field>
      <field name="arch" type="xml">
        <kanban class="o_kanban_dashboard" create="false" edit="false">
          <field name="name"/>
          <field name="code"/>
          <field name="icon"/>
          <field name="color"/>
          <field name="latest_score"/>
          <field name="open_count"/>
          <field name="high_count"/>
          <templates>
            <t t-name="card" class="flex-row">
              <div class="o_kanban_card_content d-flex flex-column">
                <div class="o_kanban_primary_left d-flex align-items-center mb-2">
                  <i t-attf-class="fa #{record.icon.raw_value} fa-2x me-2" t-att-style="'color: var(--o-enterprise-color-' + record.color.raw_value + ');'"/>
                  <div>
                    <strong class="o_kanban_record_title"><field name="name"/></strong>
                  </div>
                </div>

                <div class="o_kanban_primary_bottom mb-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">Score:</span>
                    <span class="badge rounded-pill" t-attf-class="#{record.latest_score.raw_value >= 80 ? 'text-bg-success' : record.latest_score.raw_value >= 60 ? 'text-bg-warning' : 'text-bg-danger'}">
                      <field name="latest_score"/>%
                    </span>
                  </div>
                </div>

                <div class="o_kanban_primary_bottom">
                  <div class="d-flex justify-content-between">
                    <span><field name="open_count"/> open</span>
                    <span t-if="record.high_count.raw_value > 0" class="text-danger">
                      <field name="high_count"/> high priority
                    </span>
                  </div>
                </div>

                <div class="mt-auto pt-2 border-top">
                  <a type="object" name="action_view_recommendations" class="btn btn-link btn-sm p-0">
                    See recommendations â†’
                  </a>
                </div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>

    <!-- Advisor Overview Action -->
    <record id="action_advisor_overview" model="ir.actions.act_window">
      <field name="name">Advisor Overview</field>
      <field name="res_model">advisor.category</field>
      <field name="view_mode">kanban</field>
      <field name="view_id" ref="view_advisor_category_kanban"/>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Advisor Overview
        </p>
        <p>
          View health scores and recommendations across all categories.
        </p>
      </field>
    </record>

    <!-- Server Action to Recompute Scores -->
    <record id="action_recompute_scores" model="ir.actions.server">
      <field name="name">Recompute Scores</field>
      <field name="model_id" ref="model_advisor_score"/>
      <field name="binding_model_id" ref="model_advisor_category"/>
      <field name="binding_view_types">list,form</field>
      <field name="state">code</field>
      <field name="code">
env['advisor.score'].compute_scores()
action = {'type': 'ir.actions.client', 'tag': 'display_notification', 'params': {'title': 'Scores Recomputed', 'message': 'All category scores have been updated.', 'type': 'success'}}
      </field>
    </record>
  </data>
</odoo>

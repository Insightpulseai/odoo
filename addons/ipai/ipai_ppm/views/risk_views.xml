<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>
    <!-- Risk List View -->
    <record id="view_ppm_risk_list" model="ir.ui.view">
      <field name="name">ppm.risk.list</field>
      <field name="model">ppm.risk</field>
      <field name="arch" type="xml">
        <list string="Risks" decoration-danger="severity=='critical'" decoration-warning="severity=='high'">
          <field name="code"/>
          <field name="name"/>
          <field name="category" optional="show"/>
          <field name="scope"/>
          <field name="program_id" optional="show"/>
          <field name="project_id" optional="show"/>
          <field name="impact"/>
          <field name="probability"/>
          <field name="risk_score"/>
          <field name="severity" widget="badge" decoration-success="severity=='low'" decoration-info="severity=='medium'" decoration-warning="severity=='high'" decoration-danger="severity=='critical'"/>
          <field name="status" widget="badge"/>
          <field name="owner_id" widget="many2one_avatar_user"/>
          <field name="date_target"/>
        </list>
      </field>
    </record>

    <!-- Risk Form View -->
    <record id="view_ppm_risk_form" model="ir.ui.view">
      <field name="name">ppm.risk.form</field>
      <field name="model">ppm.risk</field>
      <field name="arch" type="xml">
        <form string="Risk">
          <header>
            <button name="action_open" string="Open" type="object" invisible="status != 'identified'" class="btn-primary"/>
            <button name="action_close" string="Close" type="object" invisible="status in ('closed', 'realized')" class="btn-secondary"/>
            <field name="status" widget="statusbar" options="{'clickable': '1'}"/>
          </header>
          <sheet>
            <div class="oe_title">
              <label for="code"/>
              <h3><field name="code" readonly="1"/></h3>
              <label for="name"/>
              <h1><field name="name" placeholder="Risk Title"/></h1>
            </div>
            <group>
              <group string="Scope">
                <field name="scope"/>
                <field name="portfolio_id" invisible="scope != 'portfolio'"/>
                <field name="program_id" invisible="scope != 'program'"/>
                <field name="project_id" invisible="scope != 'project'"/>
                <field name="category"/>
              </group>
              <group string="Assessment">
                <field name="impact"/>
                <field name="probability"/>
                <field name="risk_score" readonly="1"/>
                <field name="severity" widget="badge" readonly="1"/>
              </group>
            </group>
            <group>
              <group string="Ownership">
                <field name="owner_id" widget="many2one_avatar_user"/>
                <field name="assigned_to_id" widget="many2one_avatar_user"/>
              </group>
              <group string="Dates">
                <field name="date_identified"/>
                <field name="date_target"/>
                <field name="date_closed"/>
              </group>
            </group>
            <group>
              <group string="Financial Impact">
                <field name="potential_cost"/>
                <field name="currency_id" invisible="1"/>
              </group>
              <group string="Strategy">
                <field name="mitigation_strategy"/>
              </group>
            </group>
            <notebook>
              <page string="Description" name="description">
                <field name="description" placeholder="Describe the risk..."/>
              </page>
              <page string="Mitigation Plan" name="mitigation">
                <field name="mitigation_plan" placeholder="Actions to reduce likelihood or impact..."/>
              </page>
              <page string="Contingency Plan" name="contingency">
                <field name="contingency_plan" placeholder="Actions if risk materializes..."/>
              </page>
            </notebook>
          </sheet>
          <chatter/>
        </form>
      </field>
    </record>

    <!-- Risk Search View -->
    <record id="view_ppm_risk_search" model="ir.ui.view">
      <field name="name">ppm.risk.search</field>
      <field name="model">ppm.risk</field>
      <field name="arch" type="xml">
        <search string="Search Risks">
          <field name="name"/>
          <field name="code"/>
          <field name="program_id"/>
          <field name="project_id"/>
          <field name="owner_id"/>
          <separator/>
          <filter name="filter_open" string="Open" domain="[('status', 'in', ['identified', 'open', 'mitigating'])]"/>
          <filter name="filter_critical" string="Critical" domain="[('severity', '=', 'critical')]"/>
          <filter name="filter_high" string="High" domain="[('severity', '=', 'high')]"/>
          <separator/>
          <group expand="0" string="Group By">
            <filter name="groupby_status" string="Status" context="{'group_by': 'status'}"/>
            <filter name="groupby_severity" string="Severity" context="{'group_by': 'severity'}"/>
            <filter name="groupby_category" string="Category" context="{'group_by': 'category'}"/>
            <filter name="groupby_program" string="Program" context="{'group_by': 'program_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- Risk Action -->
    <record id="action_ppm_risk" model="ir.actions.act_window">
      <field name="name">Risk Register</field>
      <field name="res_model">ppm.risk</field>
      <field name="view_mode">list,form</field>
      <field name="search_view_id" ref="view_ppm_risk_search"/>
      <field name="context">{'search_default_filter_open': 1}</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Add a risk to the register
        </p>
        <p>
          Track and manage risks across portfolios, programs, and projects.
        </p>
      </field>
    </record>
  </data>
</odoo>

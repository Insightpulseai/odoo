version: 1
type: ssot.runtime.prod_settings
scope: odoo_runtime

# =============================================================================
# Prod Settings SSOT — InsightPulse AI
# =============================================================================
# This file is the production readiness contract for the Odoo runtime.
# It captures invariants (what must be true) and secret references (by name only).
#
# CI gate: scripts/ci/check_prod_settings_ssot.py
# Workflow: .github/workflows/prod-settings-ssot-gate.yml
#
# Rules:
# - NO plaintext secrets or credentials in this file
# - Secrets are referenced by registry ID (must exist in ssot/secrets/registry.yaml)
# - "required: true" means the gate fails if the invariant is absent from SSOT
# =============================================================================

environment: prod

# ---------------------------------------------------------------------------
# Odoo Core Runtime Invariants
# ---------------------------------------------------------------------------
odoo:
  invariants:
    web_base_url: "https://erp.insightpulseai.com"
    web_base_url_freeze: true
    proxy_mode: true

  auth:
    signup:
      allow_uninvited: false
      reset_password: true

# ---------------------------------------------------------------------------
# Email
# ---------------------------------------------------------------------------
email:
  status: required
  smtp:
    provider: zoho
    from_domain: insightpulseai.com
    # Secret names only — raw values never in repo
    # Registry IDs must exist in ssot/secrets/registry.yaml
    secrets:
      smtp_user: zoho_smtp_user
      smtp_app_password: zoho_smtp_app_password
  aliases:
    enabled: true
    catchall_domain: "insightpulseai.com"

# ---------------------------------------------------------------------------
# OCR Pipeline
# ---------------------------------------------------------------------------
ocr:
  status: required
  endpoint:
    base_url: "https://ocr.insightpulseai.com"
    health_path: "/healthz"
  secrets:
    bridge_token: ocr_bridge_token

# ---------------------------------------------------------------------------
# AI Provider Policy
# ---------------------------------------------------------------------------
ai:
  policy:
    fail_closed: true
    missing_key_http_status: 503
    missing_key_code: "AI_KEY_NOT_CONFIGURED"
    provider_priority:
      - anthropic
      - gemini
      - ollama
  policy_ssot:
    file: ssot/ai/odoo_ai.yaml
    require_fail_closed: true
  providers:
    anthropic:
      status: optional
      secret: anthropic_api_key
      dependency_gate:
        dependency_id: apexive_odoo_llm
        require_pinned_ref: true
    gemini:
      status: optional
      secret: gemini_api_key

# ---------------------------------------------------------------------------
# Domain Lifecycle Truth
# ---------------------------------------------------------------------------
urls:
  lifecycle_truth:
    require_healthcheck_for_active: true
  active_required:
    - "https://erp.insightpulseai.com"
    - "https://ocr.insightpulseai.com"

# ---------------------------------------------------------------------------
# Backup Evidence References
# ---------------------------------------------------------------------------
backups:
  database:
    required: true
    evidence:
      - path: docs/ops/BACKUP_POLICY.md
        required: false  # Gate won't fail if absent; use as documentation pointer
  filestore:
    required: true
    evidence:
      - path: docs/ops/BACKUP_POLICY.md
        required: false

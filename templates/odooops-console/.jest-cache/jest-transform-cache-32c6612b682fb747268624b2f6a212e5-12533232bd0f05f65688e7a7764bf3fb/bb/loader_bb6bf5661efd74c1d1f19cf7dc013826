c4ebb6ab8bffcb0a246bb09b8ba944fc
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "getDocPage", {
    enumerable: true,
    get: function() {
        return getDocPage;
    }
});
const _fs = /*#__PURE__*/ _interop_require_default(require("fs"));
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
const _graymatter = /*#__PURE__*/ _interop_require_default(require("gray-matter"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
// Paths
// Paths
const REPO_ROOT = _path.default.resolve(process.cwd(), "../.."); // Assuming running from templates/odooops-console
const OVERRIDES_DIR = _path.default.join(process.cwd(), "src/content/docs/upstream_overrides");
const DEPLOYED_DIR = _path.default.join(process.cwd(), "src/content/docs/stack");
const UPSTREAM_DIR = _path.default.resolve(REPO_ROOT, "docs/kb/odoo19/upstream");
async function getDocPage(slugParts) {
    const slugPath = slugParts.join("/");
    // 1. Check Overrides (Highest Priority)
    const overridePath = _path.default.join(OVERRIDES_DIR, `${slugPath}.md`);
    if (_fs.default.existsSync(overridePath)) {
        return loadFile(overridePath, slugPath, "override");
    } else {
        // Check for index file in directory
        const overrideIndexPath = _path.default.join(OVERRIDES_DIR, slugPath, "index.md");
        if (_fs.default.existsSync(overrideIndexPath)) {
            return loadFile(overrideIndexPath, slugPath, "override");
        }
    }
    // 2. Check Deployed Stack (Middle Priority)
    const deployedPath = _path.default.join(DEPLOYED_DIR, `${slugPath}.md`);
    if (_fs.default.existsSync(deployedPath)) {
        return loadFile(deployedPath, slugPath, "deployed");
    }
    // 3. Check Upstream (Lowest Priority)
    const upstreamContentDir = _path.default.join(UPSTREAM_DIR, "content");
    // Check for MD/MDX first
    let upstreamPath = _path.default.join(upstreamContentDir, `${slugPath}.md`);
    if (_fs.default.existsSync(upstreamPath)) {
        return loadFile(upstreamPath, slugPath, "upstream");
    }
    // Check for RST
    upstreamPath = _path.default.join(upstreamContentDir, `${slugPath}.rst`);
    if (_fs.default.existsSync(upstreamPath)) {
        return loadFile(upstreamPath, slugPath, "upstream");
    }
    // Check for index (MD then RST)
    const upstreamIndexMd = _path.default.join(upstreamContentDir, slugPath, "index.md");
    if (_fs.default.existsSync(upstreamIndexMd)) {
        return loadFile(upstreamIndexMd, slugPath, "upstream");
    }
    const upstreamIndexRst = _path.default.join(upstreamContentDir, slugPath, "index.rst");
    if (_fs.default.existsSync(upstreamIndexRst)) {
        return loadFile(upstreamIndexRst, slugPath, "upstream");
    }
    return null;
}
function loadFile(filePath, slug, layer) {
    const fileContent = _fs.default.readFileSync(filePath, "utf8");
    const { data, content } = (0, _graymatter.default)(fileContent);
    // Canonical ID: kb://odoo19/<slug>
    // This ID is stable regardless of which layer serves the content.
    const canonicalId = `kb://odoo19/${slug}`;
    // For upstream, we could read PIN file, but that might differ if verifying pin.
    // We'll leave pinnedSha undefined for now or inject it if needed by UI.
    const meta = {
        ...data,
        layer,
        sourcePath: filePath,
        canonicalId
    };
    return {
        slug,
        title: data.title || slug.split("/").pop() || "Untitled",
        content,
        meta
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90YndhL0RvY3VtZW50cy9HaXRIdWIvSW5zaWdodHB1bHNlYWkvb2Rvby90ZW1wbGF0ZXMvb2Rvb29wcy1jb25zb2xlL3NyYy9saWIvZG9jcy9sb2FkZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBtYXR0ZXIgZnJvbSBcImdyYXktbWF0dGVyXCI7XG5cbi8vIFBhdGhzXG4vLyBQYXRoc1xuY29uc3QgUkVQT19ST09UID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIFwiLi4vLi5cIik7IC8vIEFzc3VtaW5nIHJ1bm5pbmcgZnJvbSB0ZW1wbGF0ZXMvb2Rvb29wcy1jb25zb2xlXG5jb25zdCBPVkVSUklERVNfRElSID0gcGF0aC5qb2luKFxuICBwcm9jZXNzLmN3ZCgpLFxuICBcInNyYy9jb250ZW50L2RvY3MvdXBzdHJlYW1fb3ZlcnJpZGVzXCIsXG4pO1xuY29uc3QgREVQTE9ZRURfRElSID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwic3JjL2NvbnRlbnQvZG9jcy9zdGFja1wiKTtcbmNvbnN0IFVQU1RSRUFNX0RJUiA9IHBhdGgucmVzb2x2ZShSRVBPX1JPT1QsIFwiZG9jcy9rYi9vZG9vMTkvdXBzdHJlYW1cIik7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG9jTWV0YWRhdGEge1xuICBsYXllcjogXCJvdmVycmlkZVwiIHwgXCJkZXBsb3llZFwiIHwgXCJ1cHN0cmVhbVwiO1xuICBzb3VyY2VQYXRoOiBzdHJpbmc7XG4gIGNhbm9uaWNhbElkOiBzdHJpbmc7XG4gIHBpbm5lZFNoYT86IHN0cmluZzsgLy8gT25seSBmb3IgdXBzdHJlYW1cbiAgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIERvY1BhZ2Uge1xuICBzbHVnOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgbWV0YTogRG9jTWV0YWRhdGE7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXREb2NQYWdlKHNsdWdQYXJ0czogc3RyaW5nW10pOiBQcm9taXNlPERvY1BhZ2UgfCBudWxsPiB7XG4gIGNvbnN0IHNsdWdQYXRoID0gc2x1Z1BhcnRzLmpvaW4oXCIvXCIpO1xuXG4gIC8vIDEuIENoZWNrIE92ZXJyaWRlcyAoSGlnaGVzdCBQcmlvcml0eSlcbiAgY29uc3Qgb3ZlcnJpZGVQYXRoID0gcGF0aC5qb2luKE9WRVJSSURFU19ESVIsIGAke3NsdWdQYXRofS5tZGApO1xuICBpZiAoZnMuZXhpc3RzU3luYyhvdmVycmlkZVBhdGgpKSB7XG4gICAgcmV0dXJuIGxvYWRGaWxlKG92ZXJyaWRlUGF0aCwgc2x1Z1BhdGgsIFwib3ZlcnJpZGVcIik7XG4gIH0gZWxzZSB7XG4gICAgLy8gQ2hlY2sgZm9yIGluZGV4IGZpbGUgaW4gZGlyZWN0b3J5XG4gICAgY29uc3Qgb3ZlcnJpZGVJbmRleFBhdGggPSBwYXRoLmpvaW4oT1ZFUlJJREVTX0RJUiwgc2x1Z1BhdGgsIFwiaW5kZXgubWRcIik7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMob3ZlcnJpZGVJbmRleFBhdGgpKSB7XG4gICAgICByZXR1cm4gbG9hZEZpbGUob3ZlcnJpZGVJbmRleFBhdGgsIHNsdWdQYXRoLCBcIm92ZXJyaWRlXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIDIuIENoZWNrIERlcGxveWVkIFN0YWNrIChNaWRkbGUgUHJpb3JpdHkpXG4gIGNvbnN0IGRlcGxveWVkUGF0aCA9IHBhdGguam9pbihERVBMT1lFRF9ESVIsIGAke3NsdWdQYXRofS5tZGApO1xuICBpZiAoZnMuZXhpc3RzU3luYyhkZXBsb3llZFBhdGgpKSB7XG4gICAgcmV0dXJuIGxvYWRGaWxlKGRlcGxveWVkUGF0aCwgc2x1Z1BhdGgsIFwiZGVwbG95ZWRcIik7XG4gIH1cblxuICAvLyAzLiBDaGVjayBVcHN0cmVhbSAoTG93ZXN0IFByaW9yaXR5KVxuICBjb25zdCB1cHN0cmVhbUNvbnRlbnREaXIgPSBwYXRoLmpvaW4oVVBTVFJFQU1fRElSLCBcImNvbnRlbnRcIik7XG5cbiAgLy8gQ2hlY2sgZm9yIE1EL01EWCBmaXJzdFxuICBsZXQgdXBzdHJlYW1QYXRoID0gcGF0aC5qb2luKHVwc3RyZWFtQ29udGVudERpciwgYCR7c2x1Z1BhdGh9Lm1kYCk7XG4gIGlmIChmcy5leGlzdHNTeW5jKHVwc3RyZWFtUGF0aCkpIHtcbiAgICByZXR1cm4gbG9hZEZpbGUodXBzdHJlYW1QYXRoLCBzbHVnUGF0aCwgXCJ1cHN0cmVhbVwiKTtcbiAgfVxuXG4gIC8vIENoZWNrIGZvciBSU1RcbiAgdXBzdHJlYW1QYXRoID0gcGF0aC5qb2luKHVwc3RyZWFtQ29udGVudERpciwgYCR7c2x1Z1BhdGh9LnJzdGApO1xuICBpZiAoZnMuZXhpc3RzU3luYyh1cHN0cmVhbVBhdGgpKSB7XG4gICAgcmV0dXJuIGxvYWRGaWxlKHVwc3RyZWFtUGF0aCwgc2x1Z1BhdGgsIFwidXBzdHJlYW1cIik7XG4gIH1cblxuICAvLyBDaGVjayBmb3IgaW5kZXggKE1EIHRoZW4gUlNUKVxuICBjb25zdCB1cHN0cmVhbUluZGV4TWQgPSBwYXRoLmpvaW4odXBzdHJlYW1Db250ZW50RGlyLCBzbHVnUGF0aCwgXCJpbmRleC5tZFwiKTtcbiAgaWYgKGZzLmV4aXN0c1N5bmModXBzdHJlYW1JbmRleE1kKSkge1xuICAgIHJldHVybiBsb2FkRmlsZSh1cHN0cmVhbUluZGV4TWQsIHNsdWdQYXRoLCBcInVwc3RyZWFtXCIpO1xuICB9XG4gIGNvbnN0IHVwc3RyZWFtSW5kZXhSc3QgPSBwYXRoLmpvaW4odXBzdHJlYW1Db250ZW50RGlyLCBzbHVnUGF0aCwgXCJpbmRleC5yc3RcIik7XG4gIGlmIChmcy5leGlzdHNTeW5jKHVwc3RyZWFtSW5kZXhSc3QpKSB7XG4gICAgcmV0dXJuIGxvYWRGaWxlKHVwc3RyZWFtSW5kZXhSc3QsIHNsdWdQYXRoLCBcInVwc3RyZWFtXCIpO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGxvYWRGaWxlKFxuICBmaWxlUGF0aDogc3RyaW5nLFxuICBzbHVnOiBzdHJpbmcsXG4gIGxheWVyOiBcIm92ZXJyaWRlXCIgfCBcImRlcGxveWVkXCIgfCBcInVwc3RyZWFtXCIsXG4pOiBEb2NQYWdlIHtcbiAgY29uc3QgZmlsZUNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsIFwidXRmOFwiKTtcbiAgY29uc3QgeyBkYXRhLCBjb250ZW50IH0gPSBtYXR0ZXIoZmlsZUNvbnRlbnQpO1xuXG4gIC8vIENhbm9uaWNhbCBJRDoga2I6Ly9vZG9vMTkvPHNsdWc+XG4gIC8vIFRoaXMgSUQgaXMgc3RhYmxlIHJlZ2FyZGxlc3Mgb2Ygd2hpY2ggbGF5ZXIgc2VydmVzIHRoZSBjb250ZW50LlxuICBjb25zdCBjYW5vbmljYWxJZCA9IGBrYjovL29kb28xOS8ke3NsdWd9YDtcblxuICAvLyBGb3IgdXBzdHJlYW0sIHdlIGNvdWxkIHJlYWQgUElOIGZpbGUsIGJ1dCB0aGF0IG1pZ2h0IGRpZmZlciBpZiB2ZXJpZnlpbmcgcGluLlxuICAvLyBXZSdsbCBsZWF2ZSBwaW5uZWRTaGEgdW5kZWZpbmVkIGZvciBub3cgb3IgaW5qZWN0IGl0IGlmIG5lZWRlZCBieSBVSS5cblxuICBjb25zdCBtZXRhOiBEb2NNZXRhZGF0YSA9IHtcbiAgICAuLi5kYXRhLFxuICAgIGxheWVyLFxuICAgIHNvdXJjZVBhdGg6IGZpbGVQYXRoLFxuICAgIGNhbm9uaWNhbElkLFxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgc2x1ZyxcbiAgICB0aXRsZTogZGF0YS50aXRsZSB8fCBzbHVnLnNwbGl0KFwiL1wiKS5wb3AoKSB8fCBcIlVudGl0bGVkXCIsXG4gICAgY29udGVudCxcbiAgICBtZXRhLFxuICB9O1xufVxuIl0sIm5hbWVzIjpbImdldERvY1BhZ2UiLCJSRVBPX1JPT1QiLCJwYXRoIiwicmVzb2x2ZSIsInByb2Nlc3MiLCJjd2QiLCJPVkVSUklERVNfRElSIiwiam9pbiIsIkRFUExPWUVEX0RJUiIsIlVQU1RSRUFNX0RJUiIsInNsdWdQYXJ0cyIsInNsdWdQYXRoIiwib3ZlcnJpZGVQYXRoIiwiZnMiLCJleGlzdHNTeW5jIiwibG9hZEZpbGUiLCJvdmVycmlkZUluZGV4UGF0aCIsImRlcGxveWVkUGF0aCIsInVwc3RyZWFtQ29udGVudERpciIsInVwc3RyZWFtUGF0aCIsInVwc3RyZWFtSW5kZXhNZCIsInVwc3RyZWFtSW5kZXhSc3QiLCJmaWxlUGF0aCIsInNsdWciLCJsYXllciIsImZpbGVDb250ZW50IiwicmVhZEZpbGVTeW5jIiwiZGF0YSIsImNvbnRlbnQiLCJtYXR0ZXIiLCJjYW5vbmljYWxJZCIsIm1ldGEiLCJzb3VyY2VQYXRoIiwidGl0bGUiLCJzcGxpdCIsInBvcCJdLCJtYXBwaW5ncyI6Ijs7OzsrQkE2QnNCQTs7O2VBQUFBOzs7MkRBN0JQOzZEQUNFO21FQUNFOzs7Ozs7QUFFbkIsUUFBUTtBQUNSLFFBQVE7QUFDUixNQUFNQyxZQUFZQyxhQUFJLENBQUNDLE9BQU8sQ0FBQ0MsUUFBUUMsR0FBRyxJQUFJLFVBQVUsa0RBQWtEO0FBQzFHLE1BQU1DLGdCQUFnQkosYUFBSSxDQUFDSyxJQUFJLENBQzdCSCxRQUFRQyxHQUFHLElBQ1g7QUFFRixNQUFNRyxlQUFlTixhQUFJLENBQUNLLElBQUksQ0FBQ0gsUUFBUUMsR0FBRyxJQUFJO0FBQzlDLE1BQU1JLGVBQWVQLGFBQUksQ0FBQ0MsT0FBTyxDQUFDRixXQUFXO0FBaUJ0QyxlQUFlRCxXQUFXVSxTQUFtQjtJQUNsRCxNQUFNQyxXQUFXRCxVQUFVSCxJQUFJLENBQUM7SUFFaEMsd0NBQXdDO0lBQ3hDLE1BQU1LLGVBQWVWLGFBQUksQ0FBQ0ssSUFBSSxDQUFDRCxlQUFlLEdBQUdLLFNBQVMsR0FBRyxDQUFDO0lBQzlELElBQUlFLFdBQUUsQ0FBQ0MsVUFBVSxDQUFDRixlQUFlO1FBQy9CLE9BQU9HLFNBQVNILGNBQWNELFVBQVU7SUFDMUMsT0FBTztRQUNMLG9DQUFvQztRQUNwQyxNQUFNSyxvQkFBb0JkLGFBQUksQ0FBQ0ssSUFBSSxDQUFDRCxlQUFlSyxVQUFVO1FBQzdELElBQUlFLFdBQUUsQ0FBQ0MsVUFBVSxDQUFDRSxvQkFBb0I7WUFDcEMsT0FBT0QsU0FBU0MsbUJBQW1CTCxVQUFVO1FBQy9DO0lBQ0Y7SUFFQSw0Q0FBNEM7SUFDNUMsTUFBTU0sZUFBZWYsYUFBSSxDQUFDSyxJQUFJLENBQUNDLGNBQWMsR0FBR0csU0FBUyxHQUFHLENBQUM7SUFDN0QsSUFBSUUsV0FBRSxDQUFDQyxVQUFVLENBQUNHLGVBQWU7UUFDL0IsT0FBT0YsU0FBU0UsY0FBY04sVUFBVTtJQUMxQztJQUVBLHNDQUFzQztJQUN0QyxNQUFNTyxxQkFBcUJoQixhQUFJLENBQUNLLElBQUksQ0FBQ0UsY0FBYztJQUVuRCx5QkFBeUI7SUFDekIsSUFBSVUsZUFBZWpCLGFBQUksQ0FBQ0ssSUFBSSxDQUFDVyxvQkFBb0IsR0FBR1AsU0FBUyxHQUFHLENBQUM7SUFDakUsSUFBSUUsV0FBRSxDQUFDQyxVQUFVLENBQUNLLGVBQWU7UUFDL0IsT0FBT0osU0FBU0ksY0FBY1IsVUFBVTtJQUMxQztJQUVBLGdCQUFnQjtJQUNoQlEsZUFBZWpCLGFBQUksQ0FBQ0ssSUFBSSxDQUFDVyxvQkFBb0IsR0FBR1AsU0FBUyxJQUFJLENBQUM7SUFDOUQsSUFBSUUsV0FBRSxDQUFDQyxVQUFVLENBQUNLLGVBQWU7UUFDL0IsT0FBT0osU0FBU0ksY0FBY1IsVUFBVTtJQUMxQztJQUVBLGdDQUFnQztJQUNoQyxNQUFNUyxrQkFBa0JsQixhQUFJLENBQUNLLElBQUksQ0FBQ1csb0JBQW9CUCxVQUFVO0lBQ2hFLElBQUlFLFdBQUUsQ0FBQ0MsVUFBVSxDQUFDTSxrQkFBa0I7UUFDbEMsT0FBT0wsU0FBU0ssaUJBQWlCVCxVQUFVO0lBQzdDO0lBQ0EsTUFBTVUsbUJBQW1CbkIsYUFBSSxDQUFDSyxJQUFJLENBQUNXLG9CQUFvQlAsVUFBVTtJQUNqRSxJQUFJRSxXQUFFLENBQUNDLFVBQVUsQ0FBQ08sbUJBQW1CO1FBQ25DLE9BQU9OLFNBQVNNLGtCQUFrQlYsVUFBVTtJQUM5QztJQUVBLE9BQU87QUFDVDtBQUVBLFNBQVNJLFNBQ1BPLFFBQWdCLEVBQ2hCQyxJQUFZLEVBQ1pDLEtBQTJDO0lBRTNDLE1BQU1DLGNBQWNaLFdBQUUsQ0FBQ2EsWUFBWSxDQUFDSixVQUFVO0lBQzlDLE1BQU0sRUFBRUssSUFBSSxFQUFFQyxPQUFPLEVBQUUsR0FBR0MsSUFBQUEsbUJBQU0sRUFBQ0o7SUFFakMsbUNBQW1DO0lBQ25DLGtFQUFrRTtJQUNsRSxNQUFNSyxjQUFjLENBQUMsWUFBWSxFQUFFUCxNQUFNO0lBRXpDLGdGQUFnRjtJQUNoRix3RUFBd0U7SUFFeEUsTUFBTVEsT0FBb0I7UUFDeEIsR0FBR0osSUFBSTtRQUNQSDtRQUNBUSxZQUFZVjtRQUNaUTtJQUNGO0lBRUEsT0FBTztRQUNMUDtRQUNBVSxPQUFPTixLQUFLTSxLQUFLLElBQUlWLEtBQUtXLEtBQUssQ0FBQyxLQUFLQyxHQUFHLE1BQU07UUFDOUNQO1FBQ0FHO0lBQ0Y7QUFDRiJ9
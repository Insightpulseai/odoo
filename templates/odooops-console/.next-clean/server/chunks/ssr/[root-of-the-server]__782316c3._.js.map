{"version":3,"sources":["../../../../../../../../../../Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/app/app/close/audit/page.tsx"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\n\ninterface AuditEvent {\n  id: string;\n  timestamp: string;\n  actor: string;\n  action: string;\n  target: string;\n  metadata: Record<string, any>;\n  level: \"info\" | \"warning\" | \"critical\";\n}\n\nexport default async function AuditTrailPage() {\n  const supabase = await createClient();\n\n  // In production, call audit.ui_events(p_org_id, p_from, p_to)\n  const events: AuditEvent[] = [\n    {\n      id: \"1\",\n      timestamp: \"2026-02-12 14:45:23\",\n      actor: \"Finance Ops\",\n      action: \"month_close.task.completed\",\n      target: \"Process employee payroll\",\n      metadata: {\n        workstream: \"Payroll & Benefits\",\n        evidence_count: 3,\n        duration_minutes: 45,\n      },\n      level: \"info\",\n    },\n    {\n      id: \"2\",\n      timestamp: \"2026-02-12 13:30:15\",\n      actor: \"Finance Ops\",\n      action: \"tax.form.filed\",\n      target: \"BIR Form 1601-C\",\n      metadata: {\n        form_code: \"1601-C\",\n        period: \"2026-02\",\n        payable_amount: 45230,\n        filing_method: \"eBIRForms\",\n      },\n      level: \"info\",\n    },\n    {\n      id: \"3\",\n      timestamp: \"2026-02-12 12:15:00\",\n      actor: \"System\",\n      action: \"month_close.sync_tasks.completed\",\n      target: \"Close Run Feb 2026\",\n      metadata: {\n        tasks_created: 12,\n        tasks_updated: 53,\n        run_id: \"run-2026-02\",\n      },\n      level: \"info\",\n    },\n    {\n      id: \"4\",\n      timestamp: \"2026-02-12 10:00:00\",\n      actor: \"Finance Ops\",\n      action: \"month_close.task.blocked\",\n      target: \"Verify inventory count accuracy\",\n      metadata: {\n        workstream: \"AP/AR Management\",\n        blocker: \"Warehouse system unavailable\",\n        priority: \"high\",\n      },\n      level: \"warning\",\n    },\n    {\n      id: \"5\",\n      timestamp: \"2026-02-11 16:45:00\",\n      actor: \"Finance Ops\",\n      action: \"tax.form.payment.confirmed\",\n      target: \"BIR Form 1601-C\",\n      metadata: {\n        form_code: \"1601-C\",\n        payment_ref: \"PAY-2026-02-001\",\n        amount: 45230,\n        bank: \"BDO\",\n      },\n      level: \"info\",\n    },\n    {\n      id: \"6\",\n      timestamp: \"2026-02-11 14:20:00\",\n      actor: \"System\",\n      action: \"month_close.kpi.computed\",\n      target: \"KPI Rollup\",\n      metadata: {\n        scope: \"local\",\n        metrics_computed: 15,\n        period: \"2026-02\",\n      },\n      level: \"info\",\n    },\n  ];\n\n  const levelColors = {\n    info: { bg: \"bg-blue-100\", text: \"text-blue-800\", icon: \"‚ÑπÔ∏è\" },\n    warning: { bg: \"bg-yellow-100\", text: \"text-yellow-800\", icon: \"‚ö†Ô∏è\" },\n    critical: { bg: \"bg-red-100\", text: \"text-red-800\", icon: \"üö®\" },\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">Audit Trail</h1>\n          <p className=\"text-sm text-gray-600 mt-1\">\n            Immutable event timeline for month-end close operations\n          </p>\n        </div>\n        <div className=\"flex gap-3\">\n          <select className=\"px-3 py-2 border border-gray-300 rounded\">\n            <option>All Events</option>\n            <option>Tasks</option>\n            <option>Tax Forms</option>\n            <option>System</option>\n          </select>\n          <select className=\"px-3 py-2 border border-gray-300 rounded\">\n            <option>Last 24 hours</option>\n            <option>Last 7 days</option>\n            <option>Last 30 days</option>\n          </select>\n        </div>\n      </div>\n\n      {/* Event Statistics */}\n      <div className=\"grid grid-cols-4 gap-6\">\n        {[\n          { label: \"Total Events\", value: \"243\", color: \"text-gray-900\" },\n          { label: \"Info\", value: \"225\", color: \"text-blue-600\" },\n          { label: \"Warnings\", value: \"15\", color: \"text-yellow-600\" },\n          { label: \"Critical\", value: \"3\", color: \"text-red-600\" },\n        ].map((stat) => (\n          <div\n            key={stat.label}\n            className=\"bg-white border border-gray-200 rounded-lg p-4\"\n          >\n            <div className=\"text-sm text-gray-600 mb-1\">{stat.label}</div>\n            <div className={`text-3xl font-bold ${stat.color}`}>\n              {stat.value}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Event Timeline */}\n      <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50\">\n          <h2 className=\"text-lg font-semibold\">Event Log</h2>\n        </div>\n\n        <div className=\"divide-y divide-gray-200\">\n          {events.map((event) => {\n            const levelConfig = levelColors[event.level];\n            return (\n              <div key={event.id} className=\"px-6 py-4 hover:bg-gray-50\">\n                <div className=\"flex items-start gap-4\">\n                  {/* Timestamp */}\n                  <div className=\"flex-shrink-0 w-40 text-sm text-gray-600 font-mono\">\n                    {event.timestamp}\n                  </div>\n\n                  {/* Level Badge */}\n                  <div className=\"flex-shrink-0\">\n                    <span\n                      className={`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${levelConfig.bg} ${levelConfig.text}`}\n                    >\n                      {levelConfig.icon} {event.level}\n                    </span>\n                  </div>\n\n                  {/* Event Details */}\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <div className=\"font-medium text-gray-900 mb-1\">\n                          {event.action}\n                        </div>\n                        <div className=\"text-sm text-gray-700 mb-2\">\n                          <span className=\"text-gray-500\">Target:</span>{\" \"}\n                          {event.target}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">\n                          <span className=\"text-gray-500\">Actor:</span>{\" \"}\n                          {event.actor}\n                        </div>\n\n                        {/* Metadata */}\n                        {Object.keys(event.metadata).length > 0 && (\n                          <details className=\"mt-3\">\n                            <summary className=\"text-sm text-blue-600 cursor-pointer hover:underline\">\n                              View metadata ({Object.keys(event.metadata).length}{\" \"}\n                              fields)\n                            </summary>\n                            <div className=\"mt-2 bg-gray-50 rounded p-3 text-sm\">\n                              <pre className=\"text-xs font-mono text-gray-700\">\n                                {JSON.stringify(event.metadata, null, 2)}\n                              </pre>\n                            </div>\n                          </details>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Audit Info */}\n      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n        <div className=\"flex items-start gap-3\">\n          <svg\n            className=\"w-5 h-5 text-blue-600 mt-0.5\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n            />\n          </svg>\n          <div>\n            <h3 className=\"text-sm font-semibold text-blue-900\">\n              Audit Trail Features\n            </h3>\n            <ul className=\"list-disc list-inside space-y-1 text-sm text-blue-800 mt-2\">\n              <li>Immutable event log stored in Supabase audit.events table</li>\n              <li>Every close step writes one deterministic audit row</li>\n              <li>\n                Metadata includes evidence refs, Odoo IDs, and operational context\n              </li>\n              <li>\n                Full traceability from task execution to tax filing to payment\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}
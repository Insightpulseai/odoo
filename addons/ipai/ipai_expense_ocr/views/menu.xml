<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- OCR Run List View -->
    <record id="view_ipai_expense_ocr_run_tree" model="ir.ui.view">
        <field name="name">ipai.expense.ocr.run.tree</field>
        <field name="model">ipai.expense.ocr.run</field>
        <field name="arch" type="xml">
            <list string="OCR Runs">
                <field name="create_date"/>
                <field name="expense_id"/>
                <field name="merchant"/>
                <field name="receipt_date"/>
                <field name="total"/>
                <field name="confidence" widget="progressbar"/>
                <field name="status" widget="badge"
                       decoration-success="status == 'ok'"
                       decoration-danger="status == 'error'"/>
            </list>
        </field>
    </record>

    <!-- OCR Run Form View -->
    <record id="view_ipai_expense_ocr_run_form" model="ir.ui.view">
        <field name="name">ipai.expense.ocr.run.form</field>
        <field name="model">ipai.expense.ocr.run</field>
        <field name="arch" type="xml">
            <form string="OCR Run">
                <sheet>
                    <group>
                        <group string="Reference">
                            <field name="expense_id"/>
                            <field name="attachment_id"/>
                            <field name="status"/>
                        </group>
                        <group string="Extracted Data">
                            <field name="merchant"/>
                            <field name="receipt_date"/>
                            <field name="total"/>
                            <field name="currency_id"/>
                            <field name="confidence" widget="progressbar"/>
                        </group>
                    </group>
                    <group string="Raw Data" invisible="not raw_json">
                        <field name="raw_json"/>
                    </group>
                    <group string="Error" invisible="status != 'error'">
                        <field name="error"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_ipai_expense_ocr_runs" model="ir.actions.act_window">
        <field name="name">OCR Runs</field>
        <field name="res_model">ipai.expense.ocr.run</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No OCR runs yet
            </p>
            <p>
                OCR runs are created when receipts are processed through the OCR pipeline.
            </p>
        </field>
    </record>

    <!-- Menu -->
    <menuitem id="menu_ipai_expense_ocr_root" name="Expense OCR"
              parent="hr_expense.menu_hr_expense_root" sequence="95"/>
    <menuitem id="menu_ipai_expense_ocr_runs" name="OCR Runs"
              parent="menu_ipai_expense_ocr_root"
              action="action_ipai_expense_ocr_runs" sequence="10"/>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Participant Form View -->
    <record id="view_marketing_journey_participant_form" model="ir.ui.view">
        <field name="name">marketing.journey.participant.form</field>
        <field name="model">marketing.journey.participant</field>
        <field name="arch" type="xml">
            <form string="Journey Participant">
                <header>
                    <button name="action_move_to_next" string="Process Now" type="object"
                            class="btn-primary"
                            invisible="state not in ('enrolled', 'in_progress', 'waiting')"/>
                    <button name="action_retry" string="Retry" type="object"
                            invisible="state != 'error'"/>
                    <button name="action_exit" string="Exit Journey" type="object"
                            class="btn-danger"
                            invisible="state in ('completed', 'exited')"
                            confirm="Are you sure you want to exit this participant from the journey?"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="enrolled,in_progress,completed"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="journey_id"/>
                            <field name="name"/>
                            <field name="email"/>
                            <field name="current_node_id"/>
                        </group>
                        <group>
                            <field name="res_model" readonly="1"/>
                            <field name="res_id" readonly="1"/>
                            <field name="enrolled_date"/>
                            <field name="last_action_date"/>
                        </group>
                    </group>
                    <group invisible="state != 'waiting'">
                        <group>
                            <field name="wait_until"/>
                        </group>
                    </group>
                    <group invisible="state != 'error'">
                        <group>
                            <field name="error_message"/>
                            <field name="retry_count"/>
                        </group>
                    </group>
                    <group invisible="state != 'completed'">
                        <group>
                            <field name="completed_date"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Execution History" name="history">
                            <field name="execution_log_ids">
                                <tree>
                                    <field name="execution_date"/>
                                    <field name="node_id"/>
                                    <field name="node_type" widget="badge"/>
                                    <field name="state" widget="badge"
                                           decoration-success="state == 'success'"
                                           decoration-danger="state == 'error'"/>
                                    <field name="message"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Participant Tree View -->
    <record id="view_marketing_journey_participant_tree" model="ir.ui.view">
        <field name="name">marketing.journey.participant.tree</field>
        <field name="model">marketing.journey.participant</field>
        <field name="arch" type="xml">
            <tree string="Journey Participants"
                  decoration-muted="state in ('completed', 'exited')"
                  decoration-danger="state == 'error'">
                <field name="display_name"/>
                <field name="email"/>
                <field name="journey_id"/>
                <field name="current_node_id"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'completed'"
                       decoration-info="state in ('enrolled', 'in_progress')"
                       decoration-warning="state == 'waiting'"
                       decoration-danger="state == 'error'"/>
                <field name="enrolled_date"/>
                <field name="wait_until"/>
            </tree>
        </field>
    </record>

    <!-- Participant Search View -->
    <record id="view_marketing_journey_participant_search" model="ir.ui.view">
        <field name="name">marketing.journey.participant.search</field>
        <field name="model">marketing.journey.participant</field>
        <field name="arch" type="xml">
            <search string="Search Participants">
                <field name="name"/>
                <field name="email"/>
                <field name="journey_id"/>
                <filter name="filter_enrolled" string="Enrolled" domain="[('state', '=', 'enrolled')]"/>
                <filter name="filter_in_progress" string="In Progress" domain="[('state', '=', 'in_progress')]"/>
                <filter name="filter_waiting" string="Waiting" domain="[('state', '=', 'waiting')]"/>
                <filter name="filter_completed" string="Completed" domain="[('state', '=', 'completed')]"/>
                <filter name="filter_error" string="Error" domain="[('state', '=', 'error')]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="group_journey" string="Journey" context="{'group_by': 'journey_id'}"/>
                    <filter name="group_state" string="State" context="{'group_by': 'state'}"/>
                    <filter name="group_node" string="Current Node" context="{'group_by': 'current_node_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Participant Action -->
    <record id="action_marketing_journey_participant" model="ir.actions.act_window">
        <field name="name">Participants</field>
        <field name="res_model">marketing.journey.participant</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_marketing_journey_participant_search"/>
    </record>

    <!-- Execution Log Tree View -->
    <record id="view_marketing_journey_execution_log_tree" model="ir.ui.view">
        <field name="name">marketing.journey.execution.log.tree</field>
        <field name="model">marketing.journey.execution.log</field>
        <field name="arch" type="xml">
            <tree string="Execution Logs">
                <field name="execution_date"/>
                <field name="journey_id"/>
                <field name="participant_id"/>
                <field name="node_id"/>
                <field name="node_type" widget="badge"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'success'"
                       decoration-danger="state == 'error'"
                       decoration-warning="state == 'skipped'"/>
                <field name="message"/>
            </tree>
        </field>
    </record>

    <!-- Execution Log Action -->
    <record id="action_marketing_journey_execution_log" model="ir.actions.act_window">
        <field name="name">Execution Logs</field>
        <field name="res_model">marketing.journey.execution.log</field>
        <field name="view_mode">tree</field>
    </record>
</odoo>

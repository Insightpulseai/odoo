<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Command Center Dashboard Action -->
    <record id="action_command_center_dashboard" model="ir.actions.client">
        <field name="name">Command Center</field>
        <field name="tag">ipai_command_center_dashboard</field>
    </record>

    <!-- Alert Tree View -->
    <record id="view_command_center_alert_tree" model="ir.ui.view">
        <field name="name">ipai.command.center.alert.tree</field>
        <field name="model">ipai.command.center.alert</field>
        <field name="arch" type="xml">
            <list decoration-danger="alert_type == 'critical'"
                  decoration-warning="alert_type == 'error'"
                  decoration-info="alert_type == 'warning'">
                <field name="create_date" string="Time"/>
                <field name="name"/>
                <field name="alert_type" widget="badge"
                       decoration-danger="alert_type == 'critical'"
                       decoration-warning="alert_type in ('error', 'warning')"
                       decoration-info="alert_type == 'info'"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'resolved'"
                       decoration-warning="state == 'acknowledged'"
                       decoration-danger="state == 'active'"/>
                <field name="run_id" optional="show"/>
                <field name="user_id" optional="show"/>
            </list>
        </field>
    </record>

    <!-- Alert Form View -->
    <record id="view_command_center_alert_form" model="ir.ui.view">
        <field name="name">ipai.command.center.alert.form</field>
        <field name="model">ipai.command.center.alert</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_acknowledge" type="object"
                            string="Acknowledge" class="btn-primary"
                            invisible="state != 'active'"/>
                    <button name="action_resolve" type="object"
                            string="Resolve" class="btn-success"
                            invisible="state == 'resolved'"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="active,acknowledged,resolved"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1><field name="name" placeholder="Alert title..."/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="alert_type"/>
                            <field name="run_id"/>
                            <field name="user_id"/>
                        </group>
                        <group>
                            <field name="create_date"/>
                            <field name="acknowledged_date" invisible="not acknowledged_date"/>
                            <field name="acknowledged_by" invisible="not acknowledged_by"/>
                            <field name="resolved_date" invisible="not resolved_date"/>
                            <field name="resolved_by" invisible="not resolved_by"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Message" name="message">
                            <field name="message" nolabel="1" placeholder="Alert details..."/>
                        </page>
                        <page string="Source" name="source">
                            <group>
                                <field name="source_model"/>
                                <field name="source_res_id"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Alert Search View -->
    <record id="view_command_center_alert_search" model="ir.ui.view">
        <field name="name">ipai.command.center.alert.search</field>
        <field name="model">ipai.command.center.alert</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="message"/>
                <filter name="active" string="Active" domain="[('state', '=', 'active')]"/>
                <filter name="acknowledged" string="Acknowledged" domain="[('state', '=', 'acknowledged')]"/>
                <filter name="resolved" string="Resolved" domain="[('state', '=', 'resolved')]"/>
                <separator/>
                <filter name="critical" string="Critical" domain="[('alert_type', '=', 'critical')]"/>
                <filter name="error" string="Errors" domain="[('alert_type', '=', 'error')]"/>
                <filter name="warning" string="Warnings" domain="[('alert_type', '=', 'warning')]"/>
                <group expand="0" string="Group By">
                    <filter name="group_type" string="Type" context="{'group_by': 'alert_type'}"/>
                    <filter name="group_state" string="State" context="{'group_by': 'state'}"/>
                    <filter name="group_date" string="Date" context="{'group_by': 'create_date:day'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Alert Action -->
    <record id="action_command_center_alerts" model="ir.actions.act_window">
        <field name="name">Alerts</field>
        <field name="res_model">ipai.command.center.alert</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_active': 1}</field>
    </record>

</odoo>

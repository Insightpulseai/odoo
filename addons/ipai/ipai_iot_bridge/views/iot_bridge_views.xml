<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- IoT Device Tree View -->
    <record id="view_ipai_iot_device_tree" model="ir.ui.view">
        <field name="name">ipai.iot.device.tree</field>
        <field name="model">ipai.iot.device</field>
        <field name="arch" type="xml">
            <tree string="IoT Devices">
                <field name="name"/>
                <field name="device_code"/>
                <field name="device_type"/>
                <field name="protocol"/>
                <field name="state" decoration-success="state == 'active'" decoration-warning="state == 'maintenance'" decoration-danger="state == 'error'"/>
                <field name="last_seen"/>
                <field name="location"/>
            </tree>
        </field>
    </record>

    <!-- IoT Device Form View -->
    <record id="view_ipai_iot_device_form" model="ir.ui.view">
        <field name="name">ipai.iot.device.form</field>
        <field name="model">ipai.iot.device</field>
        <field name="arch" type="xml">
            <form string="IoT Device">
                <header>
                    <button name="action_activate" type="object" string="Activate" class="btn-primary" invisible="state != 'draft'"/>
                    <button name="action_test_connection" type="object" string="Test Connection" class="btn-secondary"/>
                    <button name="action_set_maintenance" type="object" string="Maintenance" invisible="state not in ('active', 'error')"/>
                    <button name="action_deactivate" type="object" string="Deactivate" invisible="state == 'draft'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,active"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_readings" type="object" class="oe_stat_button" icon="fa-line-chart">
                            <field name="reading_count" string="Readings" widget="statinfo"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Device Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="device_code"/>
                            <field name="device_type"/>
                            <field name="protocol"/>
                        </group>
                        <group>
                            <field name="location"/>
                            <field name="last_seen"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Connection" name="connection">
                            <group>
                                <group string="Network">
                                    <field name="host"/>
                                    <field name="port"/>
                                    <field name="endpoint" invisible="protocol != 'http'"/>
                                </group>
                                <group string="Authentication">
                                    <field name="api_key" password="True"/>
                                    <field name="username"/>
                                    <field name="password" password="True"/>
                                </group>
                            </group>
                            <group string="MQTT Configuration" invisible="protocol != 'mqtt'">
                                <group>
                                    <field name="mqtt_topic_subscribe"/>
                                    <field name="mqtt_topic_publish"/>
                                    <field name="mqtt_qos"/>
                                </group>
                            </group>
                        </page>
                        <page string="Device Info" name="info">
                            <group>
                                <group>
                                    <field name="manufacturer"/>
                                    <field name="model"/>
                                </group>
                                <group>
                                    <field name="serial_number"/>
                                    <field name="firmware_version"/>
                                </group>
                            </group>
                            <group string="Location">
                                <group>
                                    <field name="latitude"/>
                                    <field name="longitude"/>
                                </group>
                            </group>
                        </page>
                        <page string="Errors" name="errors" invisible="not last_error">
                            <field name="last_error" readonly="1"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- IoT Reading Tree View -->
    <record id="view_ipai_iot_reading_tree" model="ir.ui.view">
        <field name="name">ipai.iot.reading.tree</field>
        <field name="model">ipai.iot.reading</field>
        <field name="arch" type="xml">
            <tree string="IoT Readings">
                <field name="timestamp"/>
                <field name="device_id"/>
                <field name="reading_type"/>
                <field name="value_float"/>
                <field name="value_string"/>
                <field name="unit"/>
                <field name="is_alert" decoration-danger="is_alert"/>
                <field name="alert_level"/>
            </tree>
        </field>
    </record>

    <!-- IoT Alert Tree View -->
    <record id="view_ipai_iot_alert_tree" model="ir.ui.view">
        <field name="name">ipai.iot.alert.tree</field>
        <field name="model">ipai.iot.alert</field>
        <field name="arch" type="xml">
            <tree string="Alert Rules">
                <field name="name"/>
                <field name="device_id"/>
                <field name="reading_type"/>
                <field name="condition"/>
                <field name="threshold"/>
                <field name="alert_level"/>
                <field name="is_active"/>
            </tree>
        </field>
    </record>

    <!-- IoT Alert Form View -->
    <record id="view_ipai_iot_alert_form" model="ir.ui.view">
        <field name="name">ipai.iot.alert.form</field>
        <field name="model">ipai.iot.alert</field>
        <field name="arch" type="xml">
            <form string="Alert Rule">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Alert Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="device_id"/>
                            <field name="reading_type"/>
                            <field name="is_active"/>
                        </group>
                        <group>
                            <field name="condition"/>
                            <field name="threshold"/>
                            <field name="alert_level"/>
                        </group>
                    </group>
                    <group>
                        <field name="message_template"/>
                        <field name="notify_user_ids" widget="many2many_tags"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_ipai_iot_device" model="ir.actions.act_window">
        <field name="name">IoT Devices</field>
        <field name="res_model">ipai.iot.device</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Register your first IoT device
            </p>
            <p>
                Connect sensors, printers, scanners, and other devices directly
                without Enterprise IoT box.
            </p>
        </field>
    </record>

    <record id="action_ipai_iot_reading" model="ir.actions.act_window">
        <field name="name">IoT Readings</field>
        <field name="res_model">ipai.iot.reading</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="action_ipai_iot_alert" model="ir.actions.act_window">
        <field name="name">Alert Rules</field>
        <field name="res_model">ipai.iot.alert</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Menu Items -->
    <menuitem
        id="menu_ipai_iot_root"
        name="IoT Bridge"
        parent="base.menu_administration"
        sequence="102"/>

    <menuitem
        id="menu_ipai_iot_devices"
        name="Devices"
        parent="menu_ipai_iot_root"
        action="action_ipai_iot_device"
        sequence="10"/>

    <menuitem
        id="menu_ipai_iot_readings"
        name="Readings"
        parent="menu_ipai_iot_root"
        action="action_ipai_iot_reading"
        sequence="20"/>

    <menuitem
        id="menu_ipai_iot_alerts"
        name="Alert Rules"
        parent="menu_ipai_iot_root"
        action="action_ipai_iot_alert"
        sequence="30"/>

</odoo>

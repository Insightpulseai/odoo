<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>
    <!-- Recommendation List View -->
    <record id="view_advisor_recommendation_list" model="ir.ui.view">
      <field name="name">advisor.recommendation.list</field>
      <field name="model">advisor.recommendation</field>
      <field name="arch" type="xml">
        <list string="Recommendations" decoration-danger="severity in ('critical', 'high') and status == 'open'" decoration-warning="severity == 'medium' and status == 'open'" multi_edit="1">
          <field name="name"/>
          <field name="category_id"/>
          <field name="severity" widget="badge" decoration-danger="severity in ('critical', 'high')" decoration-warning="severity == 'medium'" decoration-info="severity == 'low'"/>
          <field name="impact_score" widget="progressbar" optional="show"/>
          <field name="resource_type" optional="show"/>
          <field name="resource_ref" optional="hide"/>
          <field name="source"/>
          <field name="owner_id" widget="many2one_avatar_user"/>
          <field name="date_due" optional="show"/>
          <field name="status" widget="badge" decoration-success="status == 'resolved'" decoration-muted="status in ('snoozed', 'dismissed')"/>
          <field name="playbook_id" optional="show"/>
        </list>
      </field>
    </record>

    <!-- Recommendation Form View -->
    <record id="view_advisor_recommendation_form" model="ir.ui.view">
      <field name="name">advisor.recommendation.form</field>
      <field name="model">advisor.recommendation</field>
      <field name="arch" type="xml">
        <form string="Recommendation">
          <header>
            <button name="action_acknowledge" string="Acknowledge" type="object" invisible="status != 'open'" class="btn-secondary"/>
            <button name="action_start" string="Start Work" type="object" invisible="status not in ('open', 'acknowledged')" class="btn-primary"/>
            <button name="action_resolve" string="Resolve" type="object" invisible="status in ('resolved', 'dismissed')" class="btn-success"/>
            <button name="action_snooze" string="Snooze" type="object" invisible="status in ('resolved', 'dismissed', 'snoozed')" class="btn-secondary"/>
            <button name="action_dismiss" string="Dismiss" type="object" invisible="status in ('resolved', 'dismissed')" class="btn-secondary"/>
            <button name="action_reopen" string="Reopen" type="object" invisible="status not in ('resolved', 'dismissed', 'snoozed')" class="btn-secondary"/>
            <field name="status" widget="statusbar" options="{'clickable': '1'}"/>
          </header>
          <sheet>
            <div class="oe_title">
              <label for="name"/>
              <h1><field name="name" placeholder="Recommendation Title"/></h1>
            </div>
            <group>
              <group string="Classification">
                <field name="category_id"/>
                <field name="severity"/>
                <field name="source"/>
              </group>
              <group string="Impact">
                <field name="impact_score" widget="progressbar"/>
                <field name="estimated_savings"/>
                <field name="confidence" widget="percentage"/>
                <field name="currency_id" invisible="1"/>
              </group>
            </group>
            <group>
              <group string="Resource">
                <field name="resource_type"/>
                <field name="resource_ref"/>
              </group>
              <group string="Ownership">
                <field name="owner_id" widget="many2one_avatar_user"/>
                <field name="date_due"/>
                <field name="date_resolved"/>
                <field name="snooze_until"/>
              </group>
            </group>
            <notebook>
              <page string="Description" name="description">
                <field name="description" placeholder="Detailed explanation..."/>
              </page>
              <page string="Evidence" name="evidence">
                <field name="evidence" widget="ace" options="{'mode': 'json'}"/>
              </page>
              <page string="Remediation" name="remediation">
                <group>
                  <field name="playbook_id"/>
                  <field name="external_link" widget="url"/>
                </group>
                <field name="remediation_steps" placeholder="Quick remediation steps..."/>
              </page>
              <page string="Tags" name="tags">
                <field name="tag_ids" widget="many2many_tags"/>
              </page>
            </notebook>
          </sheet>
          <chatter/>
        </form>
      </field>
    </record>

    <!-- Recommendation Search View -->
    <record id="view_advisor_recommendation_search" model="ir.ui.view">
      <field name="name">advisor.recommendation.search</field>
      <field name="model">advisor.recommendation</field>
      <field name="arch" type="xml">
        <search string="Search Recommendations">
          <field name="name"/>
          <field name="category_id"/>
          <field name="resource_type"/>
          <field name="resource_ref"/>
          <field name="owner_id"/>
          <separator/>
          <filter name="filter_open" string="Open" domain="[('status', '=', 'open')]"/>
          <filter name="filter_critical" string="Critical" domain="[('severity', '=', 'critical')]"/>
          <filter name="filter_high" string="High" domain="[('severity', '=', 'high')]"/>
          <filter name="filter_my" string="My Recommendations" domain="[('owner_id', '=', uid)]"/>
          <separator/>
          <group expand="0" string="Group By">
            <filter name="groupby_category" string="Category" context="{'group_by': 'category_id'}"/>
            <filter name="groupby_severity" string="Severity" context="{'group_by': 'severity'}"/>
            <filter name="groupby_status" string="Status" context="{'group_by': 'status'}"/>
            <filter name="groupby_source" string="Source" context="{'group_by': 'source'}"/>
            <filter name="groupby_owner" string="Owner" context="{'group_by': 'owner_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- Recommendation Action -->
    <record id="action_advisor_recommendation" model="ir.actions.act_window">
      <field name="name">Recommendations</field>
      <field name="res_model">advisor.recommendation</field>
      <field name="view_mode">list,form</field>
      <field name="search_view_id" ref="view_advisor_recommendation_search"/>
      <field name="context">{'search_default_filter_open': 1}</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          No recommendations yet
        </p>
        <p>
          Recommendations are created automatically by the Advisor engine
          or manually by users.
        </p>
      </field>
    </record>
  </data>
</odoo>

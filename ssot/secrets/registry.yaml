# =============================================================================
# Secret Identifier Registry — insightpulseai/odoo
# =============================================================================
# SSOT for secret names/identifiers across all deployment contexts.
# This file tracks WHAT secrets exist and WHO consumes them.
#
# NEVER store secret values here. Store values in:
#   Local dev:  OS keychain/keyring (macOS Keychain, GNOME Keyring)
#   CI:         GitHub Actions Secrets (repo or org level)
#   Platform:   Supabase Vault  (project: spdtwktxdalcfigzeqrz)
#
# Runbook:  docs/runbooks/SECRETS_SSOT.md
# Policy:   CLAUDE.md § Secrets Policy
# =============================================================================

secrets:

  # ─── Cloudflare ────────────────────────────────────────────────────────────

  cf_dns_read_token:
    purpose: "Cloudflare DNS Zone:Read — used by drift gate CI"
    approved_stores: [github_actions]
    github_secret_name: CF_DNS_READ_TOKEN
    consumers:
      - .github/workflows/cloudflare-dns-drift.yml
      - scripts/ci/verify_cloudflare_dns_drift.py
    notes: "Read-only. Do not grant Zone:Edit to this token."

  cf_dns_edit_token:
    purpose: "Cloudflare DNS Zone:Edit — used by Terraform apply"
    approved_stores: [github_actions]
    github_secret_name: CF_DNS_EDIT_TOKEN
    consumers:
      - infra/cloudflare/envs/prod/
    notes: "Edit scope. Used only in deploy pipelines, never in drift-check."

  # ─── Zoho Mail API ─────────────────────────────────────────────────────────

  zoho_client_id:
    purpose: "Zoho Mail API OAuth2 client ID"
    approved_stores: [os_keychain, supabase_vault]
    vault_secret_name: zoho_client_id
    odoo_config_param: ipai.zoho.client_id
    consumers:
      - addons/ipai/ipai_zoho_mail_api/
      - scripts/setup_zoho_mail_api.sh

  zoho_client_secret:
    purpose: "Zoho Mail API OAuth2 client secret"
    approved_stores: [os_keychain, supabase_vault]
    vault_secret_name: zoho_client_secret
    odoo_config_param: ipai.zoho.client_secret
    consumers:
      - addons/ipai/ipai_zoho_mail_api/

  zoho_refresh_token:
    purpose: "Zoho Mail API OAuth2 refresh token (long-lived, rotates on use)"
    approved_stores: [os_keychain, supabase_vault]
    vault_secret_name: zoho_refresh_token
    odoo_config_param: ipai.zoho.refresh_token
    consumers:
      - addons/ipai/ipai_zoho_mail_api/
    notes: "Zoho rotates this on each token refresh. Update store after each rotation."

  zoho_account_id:
    purpose: "Zoho Mail accountId for the sending account (non-secret, but tracked)"
    approved_stores: [os_keychain, supabase_vault]
    vault_secret_name: zoho_account_id
    odoo_config_param: ipai.zoho.account_id
    consumers:
      - addons/ipai/ipai_zoho_mail_api/
    notes: "Numeric. Low sensitivity but kept out of repo for consistency."

  # ─── Mailgun ───────────────────────────────────────────────────────────────

  mailgun_api_key:
    purpose: "Mailgun API key for mg.insightpulseai.com outbound sending"
    approved_stores: [os_keychain, github_actions]
    github_secret_name: MAILGUN_API_KEY
    consumers:
      - scripts/mail/
      - scripts/verify_mailgun_e2e_text_email.py
    notes: "Private key (starts with 'key-'). Not the public validation key."

  # ─── Supabase ──────────────────────────────────────────────────────────────

  supabase_service_role_key:
    purpose: "Supabase service role key — bypasses RLS, full schema access"
    approved_stores: [os_keychain, github_actions]
    github_secret_name: SUPABASE_SERVICE_ROLE_KEY
    consumers:
      - supabase/functions/
      - scripts/supabase_check.py
      - scripts/supabase_check_data.py
    notes: "Never expose in browser/client context. Server-side / CI only."

  supabase_anon_key:
    purpose: "Supabase anonymous (public) key — respects RLS"
    approved_stores: [os_keychain]
    github_secret_name: SUPABASE_ANON_KEY
    consumers:
      - web/
      - templates/
    notes: "Low sensitivity — safe for client-side use when RLS is correct."

  # ─── n8n ───────────────────────────────────────────────────────────────────

  n8n_api_key:
    purpose: "n8n public-API JWT for programmatic workflow management"
    approved_stores: [os_keychain, supabase_vault]
    vault_secret_name: n8n_api_key
    consumers:
      - scripts/automations/
    notes: "Stored in Supabase Vault on droplet 178.128.112.214. See MEMORY.md."

  # ─── GitHub ────────────────────────────────────────────────────────────────

  github_pat:
    purpose: "GitHub PAT for repo operations (jgtolentino account)"
    approved_stores: [os_keychain]
    notes: >
      Use GITHUB_TOKEN="" prefix to force keyring over env var when gh CLI
      picks up wrong account. See MEMORY.md § Git & CLI Patterns.

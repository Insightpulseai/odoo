{"version":3,"sources":["../../../../../../../../../../Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/app/%28app%29/projects/%5BprojectId%5D/builds/page.tsx"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\nimport Link from \"next/link\";\n\ninterface Build {\n  id: string;\n  branchName: string;\n  commitSha: string;\n  status: \"success\" | \"building\" | \"failed\";\n  createdAt: string;\n  duration?: string;\n}\n\nfunction formatRelativeTime(date: string | null): string {\n  if (!date) return \"Never\";\n  const ms = Date.now() - new Date(date).getTime();\n  const minutes = Math.floor(ms / 60000);\n  const hours = Math.floor(ms / 3600000);\n  const days = Math.floor(ms / 86400000);\n\n  if (days > 0) return `${days}d ago`;\n  if (hours > 0) return `${hours}h ago`;\n  if (minutes > 0) return `${minutes}m ago`;\n  return \"Just now\";\n}\n\nfunction formatDuration(seconds: number | null): string {\n  if (!seconds) return \"—\";\n  const mins = Math.floor(seconds / 60);\n  const secs = seconds % 60;\n  return `${mins}m ${secs}s`;\n}\n\nexport default async function BuildsPage({\n  params,\n}: {\n  params: Promise<{ projectId: string }>;\n}) {\n  const { projectId } = await params;\n\n  const supabase = await createClient();\n\n  // Get all branches for this project\n  const { data: branches, error: branchesError } = await supabase.rpc(\n    \"ops.project_branches\",\n    { p_project_id: projectId }\n  );\n\n  if (branchesError) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">Builds</h1>\n        </div>\n        <div className=\"rounded-md bg-red-50 p-4\">\n          <h3 className=\"text-sm font-medium text-red-800\">\n            Error loading builds\n          </h3>\n          <p className=\"mt-2 text-sm text-red-700\">{branchesError.message}</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!branches || branches.length === 0) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">Builds</h1>\n        </div>\n        <div className=\"rounded-lg border-2 border-dashed border-gray-300 p-12 text-center\">\n          <h3 className=\"text-lg font-medium text-gray-900\">No branches yet</h3>\n          <p className=\"mt-2 text-sm text-gray-500\">\n            Create a branch to start building.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  // Fetch builds for all branches\n  const branchBuildsPromises = branches.map((branch: any) =>\n    supabase\n      .rpc(\"ops.branch_builds\", { p_branch_id: branch.id })\n      .then((res) => ({\n        branchId: branch.id,\n        branchName: branch.name,\n        builds: res.data || [],\n      }))\n  );\n\n  const branchBuildsResults = await Promise.all(branchBuildsPromises);\n  const buildsByBranch: Record<string, any[]> = {};\n  branchBuildsResults.forEach((result) => {\n    buildsByBranch[result.branchName] = result.builds;\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold\">Builds</h1>\n        <p className=\"text-sm text-gray-600 mt-1\">\n          Build history grid (rows = branches, cells = builds)\n        </p>\n      </div>\n\n      {/* Builds Grid */}\n      <div className=\"space-y-4\">\n        {branches.map((branch: any) => (\n          <div key={branch.id} className=\"border border-gray-200 rounded-lg\">\n            {/* Branch Header */}\n            <div className=\"bg-gray-50 px-4 py-3 border-b border-gray-200\">\n              <h3 className=\"font-semibold text-sm\">\n                {branch.name}\n                <span className=\"ml-2 text-xs text-gray-500\">\n                  ({branch.stage})\n                </span>\n              </h3>\n            </div>\n\n            {/* Build Cells */}\n            <div className=\"p-4\">\n              <div className=\"flex gap-3 overflow-x-auto\">\n                {(buildsByBranch[branch.name] || []).length > 0 ? (\n                  (buildsByBranch[branch.name] || []).map((build: any) => (\n                    <BuildCell\n                      key={build.id}\n                      build={{\n                        id: build.id,\n                        branchName: branch.name,\n                        commitSha:\n                          build.commit_sha?.substring(0, 7) || \"unknown\",\n                        status: build.status,\n                        createdAt: formatRelativeTime(build.created_at),\n                        duration: formatDuration(build.duration_seconds),\n                      }}\n                      projectId={projectId}\n                    />\n                  ))\n                ) : (\n                  <div className=\"text-sm text-gray-500\">\n                    No builds for this branch\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction BuildCell({\n  build,\n  projectId,\n}: {\n  build: Build;\n  projectId: string;\n}) {\n  const statusColors: Record<string, string> = {\n    success: \"border-green-500 bg-green-50\",\n    running: \"border-yellow-500 bg-yellow-50 animate-pulse\",\n    building: \"border-yellow-500 bg-yellow-50 animate-pulse\",\n    failed: \"border-red-500 bg-red-50\",\n    queued: \"border-gray-300 bg-gray-50\",\n    cancelled: \"border-gray-400 bg-gray-100\",\n  };\n\n  const statusIcons: Record<string, string> = {\n    success: \"✓\",\n    running: \"⟳\",\n    building: \"⟳\",\n    failed: \"✗\",\n    queued: \"⏳\",\n    cancelled: \"⊘\",\n  };\n\n  return (\n    <Link\n      href={`/app/projects/${projectId}/builds/${build.id}/logs`}\n      className={`flex-shrink-0 w-32 border-2 rounded-lg p-3 hover:shadow-md transition ${\n        statusColors[build.status] || \"border-gray-300 bg-gray-50\"\n      }`}\n    >\n      <div className=\"space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-lg font-bold\">\n            {statusIcons[build.status] || \"?\"}\n          </span>\n          <span className=\"text-xs text-gray-600\">{build.createdAt}</span>\n        </div>\n        <div className=\"space-y-1\">\n          <div className=\"text-xs font-mono truncate\">{build.commitSha}</div>\n          {build.duration && build.duration !== \"—\" && (\n            <div className=\"text-xs text-gray-600\">{build.duration}</div>\n          )}\n          {build.status === \"building\" && (\n            <div className=\"text-xs text-gray-600\">In progress...</div>\n          )}\n        </div>\n      </div>\n    </Link>\n  );\n}\n"],"names":[],"mappings":"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"}
# =============================================================================
# Cloudflare DNS Records — insightpulseai.com
# =============================================================================
# SSOT for all Cloudflare zone records for the insightpulseai.com zone.
# Edit this file, never edit Cloudflare UI directly.
#
# Drift check: scripts/ci/verify_cloudflare_dns_drift.py
# CI gate:     .github/workflows/cloudflare-dns-drift.yml
# Runbook:     docs/ops/CLOUDFLARE_DNS_SSOT.md
# =============================================================================

zone:
  name: insightpulseai.com
  id: 73f587aee652fc24fd643aec00dcca81
  account_id: dadf50a41a8bb4c0d0bbbb15681a53af

records:
  # ─── A Records (Proxied → 178.128.112.214) ─────────────────────────────────
  # Cloudflare proxy ("orange cloud") — HTTP/HTTPS termination at Cloudflare edge.
  # All traffic goes through Cloudflare before reaching origin (178.128.112.214).
  # Apps behind proxy MUST be configured for reverse-proxy mode (see runbook).

  - type: A
    name: "@"
    content: 178.128.112.214
    proxied: true
    ttl: 1           # "1" = Auto (Cloudflare proxied records ignore TTL)
    comment: "Apex — insightpulseai.com (proxied)"

  - type: A
    name: www
    content: 178.128.112.214
    proxied: true
    ttl: 1
    comment: "www.insightpulseai.com (proxied)"

  - type: A
    name: erp
    content: 178.128.112.214
    proxied: true
    ttl: 1
    comment: "erp.insightpulseai.com → Odoo ERP (proxied)"

  - type: A
    name: n8n
    content: 178.128.112.214
    proxied: true
    ttl: 1
    comment: "n8n.insightpulseai.com → n8n automation (proxied)"

  - type: A
    name: mcp
    content: 178.128.112.214
    proxied: true
    ttl: 1
    comment: "mcp.insightpulseai.com → MCP coordination (proxied)"

  - type: A
    name: auth
    content: 178.128.112.214
    proxied: true
    ttl: 1
    comment: "auth.insightpulseai.com → Authentication service (proxied)"

  - type: A
    name: superset
    content: 178.128.112.214
    proxied: true
    ttl: 1
    comment: "superset.insightpulseai.com → Apache Superset BI (proxied)"

  # ─── MX Records (DNS-only) ─────────────────────────────────────────────────
  # Email records MUST be DNS-only (no proxy). Cloudflare does not proxy SMTP.

  - type: MX
    name: "@"
    content: mx.zoho.com
    priority: 10
    proxied: false
    ttl: 3600
    comment: "Zoho Mail primary MX"

  - type: MX
    name: "@"
    content: mx2.zoho.com
    priority: 20
    proxied: false
    ttl: 3600
    comment: "Zoho Mail secondary MX"

  - type: MX
    name: "@"
    content: mx3.zoho.com
    priority: 50
    proxied: false
    ttl: 3600
    comment: "Zoho Mail tertiary MX"

  # ─── TXT Records (DNS-only) ────────────────────────────────────────────────

  - type: TXT
    name: "@"
    content: "v=spf1 include:zohomail.com ~all"
    proxied: false
    ttl: 3600
    comment: "SPF — authorize Zoho to send for insightpulseai.com"

  - type: TXT
    name: "_dmarc"
    content: "v=DMARC1; p=quarantine; rua=mailto:dmarc-reports@insightpulseai.com"
    proxied: false
    ttl: 3600
    comment: "DMARC — quarantine failures; aggregate reports to dmarc-reports@"

  - type: TXT
    name: "zoho._domainkey"
    content: "v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmFj2PpxreN9r4Dv8DGdNpqc7VPsbAlDQh64jyTl78NCuXU4bAPHC2JCgeQkSnoxBH19Keewr62iRcsBNnHrz8HwgkbTg8ZwooC+Bd18Z9M4ZSwBD1IK53/lUKPMHmBAPoamo2COYKG+hmRvtxeJa3ZuX1Z9Hc2hYULEXg3pus9Su34FfD/GYb43ZaqSFqth4Qt14jOfBbX4lqAZJop2iwKRQCX00CBKugVHs/heVGnsBNKIqYMVgM9gtI0P2H81gxDlvisygCQVuuEHLHVmsx0UGBL+z3b4bMvaReWY66Otv2tUKP2rOssZCx9ZbtMrPJgx2xYv/tvtoQDi9A2pGBQIDAQAB"
    proxied: false
    ttl: 3600
    comment: "Zoho DKIM public key — zoho._domainkey.insightpulseai.com"

  # ─── Mailgun mg.* Records (DNS-only, outbound-only) ────────────────────────
  # Mailgun outbound auth for mg.insightpulseai.com subdomain.
  # Zoho Mail is primary for inbound and @insightpulseai.com outbound.
  # Mailgun records are retained for outbound continuity (mg.* subdomain only).
  # Source: infra/dns/mailgun_mg_insightpulseai_com.yaml
  # These records MUST remain DNS-only — Cloudflare cannot proxy email/DNS auth.

  - type: TXT
    name: mg
    content: "v=spf1 include:mailgun.org ~all"
    proxied: false
    ttl: 3600
    comment: "Mailgun SPF for mg.insightpulseai.com (outbound-only)"

  - type: TXT
    name: "mx._domainkey.mg"
    content: "k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC59AXS0WKSDfH3HaKlpa1a3dusQWC7PECyywHd2mntae8jiwJ9++tHgu+YFNRVwXTmCFfUIsUdQpmxhYyVsYVLis/xagryklQ/wU3SF0E3Qso796fV9x1ShYb/W9rqpiW8jVD78LSppRquyYwTNLuP2+5hWFLxxVqPJYWZBHE2CQIDAQAB"
    proxied: false
    ttl: 3600
    comment: "Mailgun DKIM for mx._domainkey.mg.insightpulseai.com"

  - type: CNAME
    name: email.mg
    content: "mailgun.org"
    proxied: false
    ttl: 3600
    comment: "Mailgun tracking CNAME — email.mg.insightpulseai.com"

  - type: TXT
    name: "_dmarc.mg"
    content: "v=DMARC1; p=none; pct=100; fo=1; ri=3600; rua=mailto:3651085@dmarc.mailgun.org,mailto:682ce2a3@inbox.ondmarc.com; ruf=mailto:3651085@dmarc.mailgun.org,mailto:682ce2a3@inbox.ondmarc.com;"
    proxied: false
    ttl: 3600
    comment: "DMARC monitoring for _dmarc.mg.insightpulseai.com (Mailgun, p=none)"

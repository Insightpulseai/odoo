<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- IPAI AI Settings Dashboard -->
    <record id="res_config_settings_view_form_ipai_ai_dashboard" model="ir.ui.view">
        <field name="name">res.config.settings.ipai.ai.dashboard</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="priority">50</field>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('settings')]" position="inside">
                <div class="app_settings_block o_ipai_settings_dashboard"
                     data-string="IPAI AI Settings"
                     string="IPAI AI Settings"
                     data-key="ipai_ai_settings">

                    <!-- Header with TBWA branding -->
                    <div class="o_ipai_settings_header">
                        <h2 class="o_ipai_title">
                            <i class="fa fa-robot me-2"/>
                            AI Provider Settings
                        </h2>
                        <p class="text-muted">
                            Configure AI providers for chat, RAG, and document processing.
                        </p>
                    </div>

                    <!-- Default Provider Selection -->
                    <div class="row mt16 o_settings_container">
                        <div class="col-12 o_setting_box o_ipai_primary_setting">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-star fa-2x text-warning"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_default_provider" string="Default AI Provider"/>
                                <div class="text-muted mb-2">
                                    Select the primary AI provider for all IPAI features
                                </div>
                                <field name="ipai_default_provider" widget="radio"
                                       options="{'horizontal': true}"/>
                                <div class="mt-3">
                                    <button name="action_sync_providers" type="object"
                                            string="Sync Provider Records"
                                            class="btn btn-secondary btn-sm"
                                            icon="fa-refresh"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="o_ipai_divider"/>

                    <!-- ============================================================ -->
                    <!-- OpenAI / ChatGPT Configuration -->
                    <!-- ============================================================ -->
                    <h3 class="o_ipai_section_title">
                        <img src="/ipai_settings_dashboard/static/src/img/openai-logo.svg"
                             alt="OpenAI" height="24" class="me-2"
                             onerror="this.style.display='none'"/>
                        <span>OpenAI / ChatGPT</span>
                    </h3>

                    <div class="row mt8 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="ipai_openai_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_openai_enabled" string="Enable OpenAI"/>
                                <div class="text-muted">
                                    Use GPT-4, GPT-4o, and other OpenAI models
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_openai_enabled">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-key"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_openai_api_key" string="API Key"/>
                                <field name="ipai_openai_api_key"
                                       placeholder="sk-..."
                                       password="True"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-building"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_openai_org_id" string="Organization ID"/>
                                <field name="ipai_openai_org_id"
                                       placeholder="org-... (optional)"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_openai_enabled">
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-microchip"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_openai_model" string="Model"/>
                                <field name="ipai_openai_model" class="w-100"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-thermometer-half"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_openai_temperature" string="Temperature"/>
                                <field name="ipai_openai_temperature" class="w-50"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-text-width"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_openai_max_tokens" string="Max Tokens"/>
                                <field name="ipai_openai_max_tokens" class="w-50"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8" invisible="not ipai_openai_enabled">
                        <div class="col-12">
                            <button name="action_test_openai_connection" type="object"
                                    string="Test Connection"
                                    class="btn btn-outline-primary btn-sm"
                                    icon="fa-plug"/>
                        </div>
                    </div>

                    <div class="o_ipai_divider"/>

                    <!-- ============================================================ -->
                    <!-- Google Gemini Configuration -->
                    <!-- ============================================================ -->
                    <h3 class="o_ipai_section_title">
                        <i class="fa fa-google me-2 text-primary"/>
                        <span>Google Gemini</span>
                    </h3>

                    <div class="row mt8 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="ipai_gemini_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_gemini_enabled" string="Enable Gemini"/>
                                <div class="text-muted">
                                    Use Gemini Pro, Flash, and Vision models
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_gemini_enabled">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-key"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_gemini_api_key" string="API Key"/>
                                <field name="ipai_gemini_api_key"
                                       placeholder="AIza..."
                                       password="True"
                                       class="o_light_label w-100"/>
                                <div class="text-muted small">
                                    Get your key from
                                    <a href="https://aistudio.google.com/apikey"
                                       target="_blank">Google AI Studio</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_gemini_enabled">
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-microchip"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_gemini_model" string="Model"/>
                                <field name="ipai_gemini_model" class="w-100"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-thermometer-half"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_gemini_temperature" string="Temperature"/>
                                <field name="ipai_gemini_temperature" class="w-50"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-text-width"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_gemini_max_tokens" string="Max Tokens"/>
                                <field name="ipai_gemini_max_tokens" class="w-50"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8" invisible="not ipai_gemini_enabled">
                        <div class="col-12">
                            <button name="action_test_gemini_connection" type="object"
                                    string="Test Connection"
                                    class="btn btn-outline-primary btn-sm"
                                    icon="fa-plug"/>
                        </div>
                    </div>

                    <div class="o_ipai_divider"/>

                    <!-- ============================================================ -->
                    <!-- Kapa RAG Configuration -->
                    <!-- ============================================================ -->
                    <h3 class="o_ipai_section_title">
                        <i class="fa fa-book me-2 text-info"/>
                        <span>Kapa RAG (Knowledge Base)</span>
                    </h3>

                    <div class="row mt8 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="ipai_kapa_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_kapa_enabled" string="Enable Kapa RAG"/>
                                <div class="text-muted">
                                    Retrieval-augmented generation from your knowledge base
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_kapa_enabled">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-globe"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_kapa_base_url" string="API URL"/>
                                <field name="ipai_kapa_base_url"
                                       placeholder="https://api.kapa.ai"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-folder"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_kapa_project_id" string="Project ID"/>
                                <field name="ipai_kapa_project_id"
                                       placeholder="your-project-id"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_kapa_enabled">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-key"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_kapa_api_key" string="API Key"/>
                                <field name="ipai_kapa_api_key"
                                       password="True"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-microchip"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_kapa_model" string="Backend Model"/>
                                <field name="ipai_kapa_model" class="w-100"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_kapa_enabled">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-list-ol"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_kapa_max_sources" string="Max Sources"/>
                                <field name="ipai_kapa_max_sources" class="w-25"/>
                                <span class="text-muted ms-2">sources per query</span>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8" invisible="not ipai_kapa_enabled">
                        <div class="col-12">
                            <button name="action_test_kapa_connection" type="object"
                                    string="Test Connection"
                                    class="btn btn-outline-primary btn-sm"
                                    icon="fa-plug"/>
                        </div>
                    </div>

                    <div class="o_ipai_divider"/>

                    <!-- ============================================================ -->
                    <!-- Ollama (Local) Configuration -->
                    <!-- ============================================================ -->
                    <h3 class="o_ipai_section_title">
                        <i class="fa fa-server me-2 text-secondary"/>
                        <span>Ollama (Local LLM)</span>
                    </h3>

                    <div class="row mt8 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="ipai_ollama_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_ollama_enabled" string="Enable Ollama"/>
                                <div class="text-muted">
                                    Use locally-hosted LLMs (Llama 3, Mistral, etc.)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_ollama_enabled">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-globe"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_ollama_base_url" string="Server URL"/>
                                <field name="ipai_ollama_base_url"
                                       placeholder="http://localhost:11434"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-microchip"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_ollama_model" string="Model"/>
                                <field name="ipai_ollama_model"
                                       placeholder="llama3.1"
                                       class="o_light_label w-100"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8" invisible="not ipai_ollama_enabled">
                        <div class="col-12">
                            <button name="action_test_ollama_connection" type="object"
                                    string="Test Connection"
                                    class="btn btn-outline-primary btn-sm"
                                    icon="fa-plug"/>
                        </div>
                    </div>

                    <div class="o_ipai_divider"/>

                    <!-- ============================================================ -->
                    <!-- RAG Settings -->
                    <!-- ============================================================ -->
                    <h3 class="o_ipai_section_title">
                        <i class="fa fa-database me-2 text-success"/>
                        <span>RAG Settings</span>
                    </h3>

                    <div class="row mt8 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="ipai_rag_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_rag_enabled" string="Enable RAG Features"/>
                                <div class="text-muted">
                                    Context-aware responses using document retrieval
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt8 o_settings_container"
                         invisible="not ipai_rag_enabled">
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-cut"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_rag_chunk_size" string="Chunk Size"/>
                                <field name="ipai_rag_chunk_size" class="w-50"/>
                                <span class="text-muted ms-2">characters</span>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-exchange"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_rag_overlap" string="Chunk Overlap"/>
                                <field name="ipai_rag_overlap" class="w-50"/>
                                <span class="text-muted ms-2">characters</span>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 o_setting_box">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-sort-numeric-asc"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_rag_top_k" string="Top-K Results"/>
                                <field name="ipai_rag_top_k" class="w-50"/>
                            </div>
                        </div>
                    </div>

                    <div class="o_ipai_divider"/>

                    <!-- ============================================================ -->
                    <!-- Email / Notifications -->
                    <!-- ============================================================ -->
                    <h3 class="o_ipai_section_title">
                        <i class="fa fa-envelope me-2 text-danger"/>
                        <span>Email &amp; Notifications</span>
                    </h3>

                    <div class="row mt8 o_settings_container">
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="ipai_email_notifications"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_email_notifications"
                                       string="AI Task Notifications"/>
                                <div class="text-muted">
                                    Send email when AI tasks complete
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 o_setting_box"
                             invisible="not ipai_email_notifications">
                            <div class="o_setting_left_pane">
                                <i class="fa fa-clock-o"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="ipai_email_digest_frequency" string="Frequency"/>
                                <field name="ipai_email_digest_frequency" class="w-100"/>
                            </div>
                        </div>
                    </div>

                    <div class="row mt16">
                        <div class="col-12">
                            <button name="action_open_email_servers" type="object"
                                    string="Configure Email Servers"
                                    class="btn btn-link ps-0"
                                    icon="fa-cog"/>
                        </div>
                    </div>

                </div>
            </xpath>
        </field>
    </record>
</odoo>

# schema: ssot.secrets.v1
# Single source of truth for secret IDENTIFIERS used by InsightPulse AI.
#
# This file tracks:
#   - Secret names (not values)
#   - Purpose and scope
#   - Approved storage locations
#   - Which files/services consume each secret
#
# NEVER include secret values in this file.
# Values live in: macOS Keychain, GitHub Actions Secrets, Supabase Vault, Vercel env vars
#
# Workflow: docs/runbooks/SECRETS_SSOT.md

version: "1.0.0"
schema: ssot.secrets.v1
last_reviewed: "2026-02-27"

schema_rules:
  required_fields:
    - purpose
    - approved_stores
    - consumers
  consumer_format: "store:identifier"
  consumer_stores:
    - github_actions
    - vercel_env
    - supabase_vault
    - os_keychain
    - odoo_config_parameter

secrets:
  cf_dns_read_token:
    purpose: "Cloudflare DNS Zone:Read — CI drift gate"
    approved_stores:
      - github_actions
    github_secret_name: CF_DNS_READ_TOKEN
    consumers:
      - github_actions:.github/workflows/cloudflare-dns-drift.yml
      - github_actions:.github/workflows/domain-lint.yml
    rotation_policy: "Annually or on team member offboarding"
    notes: "Read-only token. Minimal blast radius."

  cf_dns_edit_token:
    purpose: "Cloudflare DNS Zone:Edit — Terraform apply via CI"
    approved_stores:
      - github_actions
    github_secret_name: CF_DNS_EDIT_TOKEN
    consumers:
      - github_actions:infra/cloudflare/envs/prod/
      - github_actions:.github/workflows/dns-ssot-apply.yml
    rotation_policy: "Annually or on team member offboarding"
    notes: "Edit-scoped token. Only used by Terraform apply workflow."

  zoho_client_id:
    purpose: "Zoho Mail API OAuth2 client ID"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: zoho_client_id
    consumers:
      - supabase_vault:zoho_client_id
      - odoo_config_parameter:addons/ipai/ipai_zoho_mail_api/
    rotation_policy: "On Zoho app credential reset"
    notes: "Pair with zoho_client_secret and zoho_refresh_token."

  zoho_client_secret:
    purpose: "Zoho Mail API OAuth2 client secret"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: zoho_client_secret
    consumers:
      - supabase_vault:zoho_client_secret
      - odoo_config_parameter:addons/ipai/ipai_zoho_mail_api/
    rotation_policy: "On Zoho app credential reset"
    notes: "Pair with zoho_client_id and zoho_refresh_token."

  zoho_refresh_token:
    purpose: "Zoho Mail API OAuth2 long-lived refresh token"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: zoho_refresh_token
    consumers:
      - supabase_vault:zoho_refresh_token
      - odoo_config_parameter:addons/ipai/ipai_zoho_mail_api/
    rotation_policy: "Every 6 months or when access is revoked"
    notes: "Used to obtain short-lived access tokens. Rotate proactively."

  supabase_service_role_key:
    purpose: "Supabase service role key (full RLS bypass — use sparingly)"
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: SUPABASE_SERVICE_ROLE_KEY
    consumers:
      - github_actions:SUPABASE_SERVICE_ROLE_KEY
      - os_keychain:local-dev
    rotation_policy: "Quarterly or on team member offboarding"
    notes: "Bypasses all RLS. Scope usage to CI/migration scripts only."

  supabase_anon_key:
    purpose: "Supabase anonymous key (public — safe to expose client-side)"
    approved_stores:
      - os_keychain
      - vercel_env
    vercel_env_name: NEXT_PUBLIC_SUPABASE_ANON_KEY
    consumers:
      - vercel_env:apps/ops-console
      - os_keychain:local-dev
    rotation_policy: "On Supabase project reset only"
    notes: "Public key — low sensitivity. Subject to RLS policies."

  gemini_api_key:
    purpose: "Google Gemini API key — Ops Console AI route (/api/ai/gemini)"
    approved_stores:
      - github_actions
      - vercel_env
    github_secret_name: GEMINI_API_KEY
    vercel_env_name: GEMINI_API_KEY
    consumers:
      - vercel_env:apps/ops-console
      - vercel_env:platform/ai/providers/gemini
      - github_actions:GEMINI_API_KEY
    rotation_policy: "Annually or on security incident"
    notes: "Required for Gemini bridge. Set in Vercel env vars for ops-console deployment."

  slack_bot_token:
    purpose: "Slack bot token for ipai_slack_connector notifications"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: slack_bot_token
    consumers:
      - supabase_vault:slack_bot_token
      - odoo_config_parameter:addons/ipai/ipai_slack_connector/
    rotation_policy: "On Slack app reinstallation or security incident"
    notes: "xoxb- prefix token. Scopes: chat:write, channels:read."

  slack_signing_secret:
    purpose: "Slack signing secret for webhook verification"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: slack_signing_secret
    consumers:
      - supabase_vault:slack_signing_secret
      - odoo_config_parameter:addons/ipai/ipai_slack_connector/
    rotation_policy: "On Slack app reinstallation or security incident"
    notes: "Used to verify that webhook payloads come from Slack."

  github_token:
    purpose: "GitHub PAT for API access (repo operations, workflow triggers)"
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: GITHUB_TOKEN
    consumers:
      - github_actions:GITHUB_TOKEN
      - os_keychain:local-dev
    rotation_policy: "Annually or on team member offboarding"
    notes: "Use fine-grained PAT scoped to this repo only."

  do_access_token:
    purpose: "DigitalOcean API token — App Platform + Droplet management"
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: DO_ACCESS_TOKEN
    consumers:
      - github_actions:DO_ACCESS_TOKEN
      - os_keychain:local-dev
    rotation_policy: "Annually or on team member offboarding"
    notes: "Scoped to fin-workspace project where possible."

<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Security Groups -->
    <record id="module_category_saas" model="ir.module.category">
        <field name="name">SaaS Multi-Tenant</field>
        <field name="description">SaaS multi-tenant platform management</field>
        <field name="sequence">50</field>
    </record>

    <record id="group_saas_user" model="res.groups">
        <field name="name">SaaS User</field>
        <field name="category_id" ref="module_category_saas"/>
        <field name="comment">Basic access to SaaS tenant features</field>
    </record>

    <record id="group_saas_manager" model="res.groups">
        <field name="name">SaaS Manager</field>
        <field name="category_id" ref="module_category_saas"/>
        <field name="implied_ids" eval="[(4, ref('group_saas_user'))]"/>
        <field name="comment">Manage subscriptions and services for an account</field>
    </record>

    <record id="group_saas_admin" model="res.groups">
        <field name="name">SaaS Administrator</field>
        <field name="category_id" ref="module_category_saas"/>
        <field name="implied_ids" eval="[(4, ref('group_saas_manager'))]"/>
        <field name="comment">Full access to SaaS platform administration</field>
    </record>

    <!-- Record Rules -->

    <!-- Users can only see their own account's data -->
    <record id="saas_account_rule_user" model="ir.rule">
        <field name="name">SaaS Account: User sees own company's account</field>
        <field name="model_id" ref="model_saas_account"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_saas_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="saas_account_rule_manager" model="ir.rule">
        <field name="name">SaaS Account: Manager can manage own account</field>
        <field name="model_id" ref="model_saas_account"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('group_saas_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="saas_account_rule_admin" model="ir.rule">
        <field name="name">SaaS Account: Admin has full access</field>
        <field name="model_id" ref="model_saas_account"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_saas_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Subscription rules -->
    <record id="saas_subscription_rule_user" model="ir.rule">
        <field name="name">SaaS Subscription: User sees own subscriptions</field>
        <field name="model_id" ref="model_saas_subscription"/>
        <field name="domain_force">['|',
            ('tenant_account_id.company_id', 'in', company_ids),
            ('provider_account_id.company_id', 'in', company_ids)
        ]</field>
        <field name="groups" eval="[(4, ref('group_saas_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Service rules - public services visible to all -->
    <record id="saas_service_rule_public" model="ir.rule">
        <field name="name">SaaS Service: Public services visible to all</field>
        <field name="model_id" ref="model_saas_service"/>
        <field name="domain_force">['|',
            ('is_public', '=', True),
            ('provider_account_id.company_id', 'in', company_ids)
        ]</field>
        <field name="groups" eval="[(4, ref('group_saas_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

</odoo>

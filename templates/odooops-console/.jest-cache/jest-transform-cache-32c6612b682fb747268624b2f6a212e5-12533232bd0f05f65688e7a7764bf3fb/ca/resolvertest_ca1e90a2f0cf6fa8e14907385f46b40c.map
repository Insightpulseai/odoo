{"version":3,"sources":["/Users/tbwa/Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/src/lib/docs/resolver.test.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { getDocPage } from \"./loader\";\n\n// Mocks\njest.mock(\"fs\");\njest.mock(\"path\", () => {\n  const actual = jest.requireActual(\"path\");\n  return {\n    ...actual,\n    resolve: jest.fn((...args) => actual.join(...args)), // Simplified resolve for testing\n  };\n});\n\ndescribe(\"Docs Resolver Precedence\", () => {\n  const MOCK_CWD = \"/mock/app\";\n  const MOCK_REPO_ROOT = \"/mock\";\n\n  beforeAll(() => {\n    jest.spyOn(process, \"cwd\").mockReturnValue(MOCK_CWD);\n    // Mock paths in loader.ts will derive from this CWD\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"should prefer OVERRIDE over deployed and upstream\", async () => {\n    // Setup: File exists in all 3 layers\n    (fs.existsSync as jest.Mock).mockImplementation((p) => {\n      if (p.includes(\"upstream_overrides/foo.md\")) return true;\n      if (p.includes(\"stack/foo.md\")) return true;\n      if (p.includes(\"upstream/foo.md\")) return true;\n      return false;\n    });\n    (fs.readFileSync as jest.Mock).mockReturnValue(\n      \"---\\ntitle: Override\\n---\\nContent\",\n    );\n\n    const result = await getDocPage([\"foo\"]);\n\n    expect(result).not.toBeNull();\n    expect(result?.meta.layer).toBe(\"override\");\n    expect(result?.title).toBe(\"Override\");\n  });\n\n  it(\"should prefer DEPLOYED over upstream if override is missing\", async () => {\n    // Setup: File exists in deployed and upstream, not override\n    (fs.existsSync as jest.Mock).mockImplementation((p) => {\n      if (p.includes(\"upstream_overrides/foo.md\")) return false;\n      if (p.includes(\"stack/foo.md\")) return true;\n      if (p.includes(\"upstream/foo.md\")) return true;\n      return false;\n    });\n    (fs.readFileSync as jest.Mock).mockReturnValue(\n      \"---\\ntitle: Deployed\\n---\\nContent\",\n    );\n\n    const result = await getDocPage([\"foo\"]);\n\n    expect(result).not.toBeNull();\n    expect(result?.meta.layer).toBe(\"deployed\");\n    expect(result?.title).toBe(\"Deployed\");\n  });\n\n  it(\"should fallback to UPSTREAM (RST) if others are missing\", async () => {\n    // Setup: File exists only in upstream as RST\n    (fs.existsSync as jest.Mock).mockImplementation((p) => {\n      // Create a simplified check that matches the loader logic\n      if (p.includes(\"upstream_overrides\")) return false;\n      if (p.includes(\"stack\")) return false;\n      // Loader checks: MD -> RST -> Index MD -> Index RST\n      if (p.endsWith(\"content/foo.md\")) return false;\n      if (p.endsWith(\"content/foo.rst\")) return true;\n      return false;\n    });\n\n    (fs.readFileSync as jest.Mock).mockImplementation(\n      () => \"RST Title\\n=========\\nContent\",\n    );\n\n    const result = await getDocPage([\"foo\"]);\n\n    expect(result).not.toBeNull();\n    expect(result?.meta.layer).toBe(\"upstream\");\n  });\n\n  it(\"should return null if not found anywhere\", async () => {\n    (fs.existsSync as jest.Mock).mockReturnValue(false);\n\n    const result = await getDocPage([\"missing\"]);\n\n    expect(result).toBeNull();\n  });\n});\n"],"names":["jest","mock","actual","requireActual","resolve","fn","args","join","describe","MOCK_CWD","MOCK_REPO_ROOT","beforeAll","spyOn","process","mockReturnValue","afterEach","clearAllMocks","it","fs","existsSync","mockImplementation","p","includes","readFileSync","result","getDocPage","expect","not","toBeNull","meta","layer","toBe","title","endsWith"],"mappings":";AAIA,QAAQ;AACRA,KAAKC,IAAI,CAAC;AACVD,KAAKC,IAAI,CAAC,QAAQ;IAChB,MAAMC,SAASF,KAAKG,aAAa,CAAC;IAClC,OAAO;QACL,GAAGD,MAAM;QACTE,SAASJ,KAAKK,EAAE,CAAC,CAAC,GAAGC,OAASJ,OAAOK,IAAI,IAAID;IAC/C;AACF;;;;2DAZe;wBAEY;;;;;;AAY3BE,SAAS,4BAA4B;IACnC,MAAMC,WAAW;IACjB,MAAMC,iBAAiB;IAEvBC,UAAU;QACRX,KAAKY,KAAK,CAACC,SAAS,OAAOC,eAAe,CAACL;IAC3C,oDAAoD;IACtD;IAEAM,UAAU;QACRf,KAAKgB,aAAa;IACpB;IAEAC,GAAG,qDAAqD;QACtD,qCAAqC;QACpCC,WAAE,CAACC,UAAU,CAAeC,kBAAkB,CAAC,CAACC;YAC/C,IAAIA,EAAEC,QAAQ,CAAC,8BAA8B,OAAO;YACpD,IAAID,EAAEC,QAAQ,CAAC,iBAAiB,OAAO;YACvC,IAAID,EAAEC,QAAQ,CAAC,oBAAoB,OAAO;YAC1C,OAAO;QACT;QACCJ,WAAE,CAACK,YAAY,CAAeT,eAAe,CAC5C;QAGF,MAAMU,SAAS,MAAMC,IAAAA,kBAAU,EAAC;YAAC;SAAM;QAEvCC,OAAOF,QAAQG,GAAG,CAACC,QAAQ;QAC3BF,OAAOF,QAAQK,KAAKC,OAAOC,IAAI,CAAC;QAChCL,OAAOF,QAAQQ,OAAOD,IAAI,CAAC;IAC7B;IAEAd,GAAG,+DAA+D;QAChE,4DAA4D;QAC3DC,WAAE,CAACC,UAAU,CAAeC,kBAAkB,CAAC,CAACC;YAC/C,IAAIA,EAAEC,QAAQ,CAAC,8BAA8B,OAAO;YACpD,IAAID,EAAEC,QAAQ,CAAC,iBAAiB,OAAO;YACvC,IAAID,EAAEC,QAAQ,CAAC,oBAAoB,OAAO;YAC1C,OAAO;QACT;QACCJ,WAAE,CAACK,YAAY,CAAeT,eAAe,CAC5C;QAGF,MAAMU,SAAS,MAAMC,IAAAA,kBAAU,EAAC;YAAC;SAAM;QAEvCC,OAAOF,QAAQG,GAAG,CAACC,QAAQ;QAC3BF,OAAOF,QAAQK,KAAKC,OAAOC,IAAI,CAAC;QAChCL,OAAOF,QAAQQ,OAAOD,IAAI,CAAC;IAC7B;IAEAd,GAAG,2DAA2D;QAC5D,6CAA6C;QAC5CC,WAAE,CAACC,UAAU,CAAeC,kBAAkB,CAAC,CAACC;YAC/C,0DAA0D;YAC1D,IAAIA,EAAEC,QAAQ,CAAC,uBAAuB,OAAO;YAC7C,IAAID,EAAEC,QAAQ,CAAC,UAAU,OAAO;YAChC,oDAAoD;YACpD,IAAID,EAAEY,QAAQ,CAAC,mBAAmB,OAAO;YACzC,IAAIZ,EAAEY,QAAQ,CAAC,oBAAoB,OAAO;YAC1C,OAAO;QACT;QAECf,WAAE,CAACK,YAAY,CAAeH,kBAAkB,CAC/C,IAAM;QAGR,MAAMI,SAAS,MAAMC,IAAAA,kBAAU,EAAC;YAAC;SAAM;QAEvCC,OAAOF,QAAQG,GAAG,CAACC,QAAQ;QAC3BF,OAAOF,QAAQK,KAAKC,OAAOC,IAAI,CAAC;IAClC;IAEAd,GAAG,4CAA4C;QAC5CC,WAAE,CAACC,UAAU,CAAeL,eAAe,CAAC;QAE7C,MAAMU,SAAS,MAAMC,IAAAA,kBAAU,EAAC;YAAC;SAAU;QAE3CC,OAAOF,QAAQI,QAAQ;IACzB;AACF"}
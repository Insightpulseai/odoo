{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "locale_overlay.schema.json",
  "title": "Locale Overlay Schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "locale", "extends", "overlay"],
  "properties": {
    "version": { "type": "string", "minLength": 3 },
    "locale": {
      "type": "object",
      "additionalProperties": false,
      "required": ["code", "name", "jurisdiction"],
      "properties": {
        "code": { "type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$" },
        "name": { "type": "string", "minLength": 2 },
        "jurisdiction": { "type": "string", "minLength": 2 },
        "currency": { "type": "string", "minLength": 3, "maxLength": 3 },
        "timezone": { "type": "string", "minLength": 3 }
      }
    },
    "extends": {
      "type": "object",
      "additionalProperties": false,
      "required": ["taxonomy_id", "taxonomy_version"],
      "properties": {
        "taxonomy_id": { "type": "string", "minLength": 3 },
        "taxonomy_version": { "type": "string", "minLength": 1 }
      }
    },
    "overlay": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "competency_boards",
        "tax_compliance",
        "month_end_close",
        "forms_catalog",
        "mappings",
        "evidence"
      ],
      "properties": {
        "competency_boards": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/competency_board" }
        },
        "tax_compliance": { "$ref": "#/$defs/process_pack" },
        "month_end_close": { "$ref": "#/$defs/process_pack" },
        "forms_catalog": {
          "type": "array",
          "items": { "$ref": "#/$defs/form_item" }
        },
        "mappings": {
          "type": "object",
          "additionalProperties": false,
          "required": ["capability_atoms", "skills_taxonomy"],
          "properties": {
            "capability_atoms": {
              "type": "array",
              "items": { "$ref": "#/$defs/mapping_item" }
            },
            "skills_taxonomy": {
              "type": "array",
              "items": { "$ref": "#/$defs/mapping_item" }
            }
          }
        },
        "evidence": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/evidence_ref" }
        }
      }
    }
  },
  "$defs": {
    "evidence_ref": {
      "type": "object",
      "additionalProperties": false,
      "required": ["ref"],
      "properties": {
        "ref": { "type": "string", "minLength": 1 },
        "hint": { "type": "string" },
        "url": { "type": "string" }
      }
    },
    "competency_board": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "name", "scope", "competencies", "evidence"],
      "properties": {
        "id": { "type": "string", "minLength": 4 },
        "name": { "type": "string", "minLength": 3 },
        "scope": {
          "type": "object",
          "additionalProperties": false,
          "required": ["domain", "locale_code"],
          "properties": {
            "domain": { "type": "string", "minLength": 3 },
            "locale_code": {
              "type": "string",
              "pattern": "^[a-z]{2}(-[A-Z]{2})?$"
            }
          }
        },
        "competencies": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/competency_item" }
        },
        "evidence": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/evidence_ref" }
        }
      }
    },
    "competency_item": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "name", "levels"],
      "properties": {
        "id": { "type": "string", "minLength": 4 },
        "name": { "type": "string", "minLength": 3 },
        "levels": {
          "type": "array",
          "minItems": 3,
          "maxItems": 6,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["level", "label", "behaviors"],
            "properties": {
              "level": { "type": "integer", "minimum": 1, "maximum": 6 },
              "label": { "type": "string", "minLength": 2 },
              "behaviors": {
                "type": "array",
                "minItems": 1,
                "items": { "type": "string", "minLength": 3 }
              }
            }
          }
        }
      }
    },
    "process_pack": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "name", "steps", "outputs", "controls", "evidence"],
      "properties": {
        "id": { "type": "string", "minLength": 4 },
        "name": { "type": "string", "minLength": 3 },
        "steps": {
          "type": "array",
          "minItems": 3,
          "items": { "$ref": "#/$defs/process_step" }
        },
        "outputs": {
          "type": "array",
          "items": { "type": "string", "minLength": 3 }
        },
        "controls": {
          "type": "array",
          "items": { "type": "string", "minLength": 3 }
        },
        "evidence": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/evidence_ref" }
        }
      }
    },
    "process_step": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "title", "description", "artifacts"],
      "properties": {
        "id": { "type": "string", "minLength": 4 },
        "title": { "type": "string", "minLength": 3 },
        "description": { "type": "string", "minLength": 10 },
        "artifacts": {
          "type": "array",
          "items": { "type": "string", "minLength": 3 }
        },
        "depends_on": {
          "type": "array",
          "items": { "type": "string", "minLength": 4 }
        }
      }
    },
    "form_item": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "name",
        "authority",
        "purpose",
        "frequency",
        "evidence"
      ],
      "properties": {
        "id": { "type": "string", "minLength": 4 },
        "name": { "type": "string", "minLength": 3 },
        "authority": { "type": "string", "minLength": 2 },
        "purpose": { "type": "string", "minLength": 5 },
        "frequency": {
          "type": "string",
          "enum": ["monthly", "quarterly", "annual", "ad_hoc"]
        },
        "links": {
          "type": "array",
          "items": { "type": "string" }
        },
        "evidence": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/evidence_ref" }
        }
      }
    },
    "mapping_item": {
      "type": "object",
      "additionalProperties": false,
      "required": ["from_id", "to_id", "rule"],
      "properties": {
        "from_id": { "type": "string", "minLength": 3 },
        "to_id": { "type": "string", "minLength": 3 },
        "rule": { "type": "string", "minLength": 5 },
        "notes": { "type": "string" },
        "evidence": {
          "type": "array",
          "items": { "$ref": "#/$defs/evidence_ref" }
        }
      }
    }
  }
}

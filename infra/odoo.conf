[options]
# ============================================================================
# TBWA\SMP Production Odoo Configuration
# Droplet: 178.128.112.214 (odoo-erp-prod)
# Managed DB: odoo-db-sgp1 (DigitalOcean PostgreSQL 16)
# ============================================================================

# Database Connection (Managed PostgreSQL)
# Override via environment variables: HOST, PORT, USER, PASSWORD
db_host = ${ODOO_DB_HOST}
db_port = ${ODOO_DB_PORT}
db_user = ${ODOO_DB_USER}
db_password = ${ODOO_DB_PASSWORD}

# Database Filtering (enforce single canonical database)
dbfilter = ^odoo$

# Database Manager Settings
list_db = False
admin_passwd = ${ODOO_ADMIN_PASSWORD:-admin}

# Addon Paths
addons_path = /usr/lib/python3/dist-packages/odoo/addons,/mnt/extra-addons

# Logging
log_level = info
logfile = None  # Log to stdout for Docker logs

# Reverse Proxy Configuration (nginx)
proxy_mode = True

# Performance Tuning (4GB RAM droplet)
# Formula: workers = (CPU cores * 2) + 1 = (2 * 2) + 1 = 5
# Conservative: 4 workers for stability
workers = 4
max_cron_threads = 2

# Memory Limits (per worker)
# Hard limit: 2.5 GB (80% of 3GB available after OS overhead)
# Soft limit: 2 GB (triggers graceful restart before hard limit)
limit_memory_hard = 2684354560
limit_memory_soft = 2147483648

# Request Limits (prevent runaway requests)
limit_request = 8192
limit_time_cpu = 600
limit_time_real = 1200

# Session Storage (default: filesystem)
# [ASSUMPTION] For multi-worker production, consider Redis for session store
# Uncomment and configure if implementing Redis:
# session_store = redis
# session_redis_host = localhost
# session_redis_port = 6379
# session_redis_db = 0

# Timeouts
db_maxconn = 64
db_template = template0

# Security
# [ASSUMPTION] List allowed database patterns if dbfilter is too restrictive
# server_wide_modules = base,web

# Gevent mode (optional, for better concurrency)
# workers = 0
# gevent_port = 8072

# ssot/policy/branch_hygiene.yaml
#
# Branch hygiene policy — canonical source of truth for automated pruning.
# Consumed by: .github/workflows/branch-hygiene.yml
#              scripts/ci/branch_hygiene.py
#
# Safety model (two locks):
#   Lock 1 (workflow): scheduled runs always force dry_run=true
#   Lock 2 (script):   --dry-run=false requires --confirm=YES
#
# A branch with ANY open PR (draft or review-ready) is ALWAYS kept,
# regardless of all rules below.
#
# To add a new auto-delete prefix:
#   1. Add to auto_delete_prefixes
#   2. Confirm prefix is NOT in protected_prefixes
#   3. Open a PR — effective on next nightly run
#
# To exempt a specific branch permanently:
#   Add to excluded_branches (exact name) or protected_prefixes (prefix match)

---
schema: ssot.policy.branch_hygiene.v1
updated: "2026-02-27"
policy_ref: "CLAUDE.md#git-workflow"

retention:
  # Branches with NO open PR older than this are candidates for deletion
  default_days: 14

  # Per-prefix overrides (key = prefix string, value = days)
  prefix_overrides:
    "bot/": 7
    "claude/": 7
    "codex/": 7

# Only branches matching these prefixes are auto-delete eligible
auto_delete_prefixes:
  - "claude/"       # Claude Code agent branches
  - "codex/"        # OpenAI Codex branches
  - "bot/"          # GitHub App / bot branches (e.g. bot/sync-anthropic-skills)
  - "dependabot/"   # Dependabot — closed-PR orphan branches
  - "renovate/"     # Renovate Bot

# Exact branch names that are NEVER deleted
protected_exact:
  - main
  - master
  - develop
  - gh-pages

# Prefix anchors — branches starting with these are NEVER deleted
protected_prefixes:
  - "release/"
  - "hotfix/"
  - "prod/"
  - "staging/"
  - "chore/"
  - "feat/"
  - "fix/"
  - "docs/"
  - "test/"
  - "refactor/"

# Explicit full-name exclusions (edge cases not covered by prefix rules)
excluded_branches:
  - "gh-pages"

# Scheduled runs are ALWAYS dry_run=true regardless of this value (workflow lock 1).
# This controls the CLI default when running the script manually with no --dry-run flag.
dry_run_default: true

report:
  artifact_name: branch-hygiene-report
  path: reports/ci/branch_hygiene_report.json
  retention_days: 30

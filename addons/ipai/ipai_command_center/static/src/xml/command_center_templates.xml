<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="ipai_command_center.Dashboard">
        <div class="o_command_center_dashboard ipai-app">
            <!-- Header -->
            <div class="cc-header">
                <div>
                    <h1 class="cc-header-title">Command Center</h1>
                    <p class="cc-header-subtitle">Platform operations dashboard</p>
                </div>
                <div class="cc-quick-actions">
                    <button class="cc-action-btn secondary" t-on-click="refresh">
                        <i class="fa fa-refresh"/>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div t-if="state.loading" class="text-center py-5">
                <i class="fa fa-spinner fa-spin fa-3x text-muted"/>
                <p class="mt-3 text-muted">Loading dashboard...</p>
            </div>

            <!-- Dashboard Content -->
            <div t-else="">
                <!-- Stats Grid -->
                <div class="cc-stats-grid">
                    <div class="cc-stat-card info" t-on-click="openRuns" style="cursor: pointer;">
                        <div class="cc-stat-label">Runs Today</div>
                        <div class="cc-stat-value" t-esc="state.stats.runs_today"/>
                    </div>

                    <div class="cc-stat-card warning">
                        <div class="cc-stat-label">Pending</div>
                        <div class="cc-stat-value" t-esc="state.stats.runs_pending"/>
                    </div>

                    <div class="cc-stat-card danger" t-on-click="openFailedRuns" style="cursor: pointer;">
                        <div class="cc-stat-label">Failed (24h)</div>
                        <div class="cc-stat-value" t-esc="state.stats.runs_failed_24h"/>
                    </div>

                    <div class="cc-stat-card success">
                        <div class="cc-stat-label">Avg Duration</div>
                        <div class="cc-stat-value" t-esc="formatDuration(state.stats.avg_duration_ms)"/>
                    </div>
                </div>

                <!-- Alerts Summary -->
                <div class="cc-section" t-if="state.alerts.critical > 0 || state.alerts.error > 0 || state.alerts.warning > 0">
                    <div class="cc-section-header">
                        <h3 class="cc-section-title">Active Alerts</h3>
                        <button class="btn btn-sm btn-link" t-on-click="openAlerts">View All</button>
                    </div>
                    <div class="cc-section-body">
                        <div class="d-flex gap-3 flex-wrap">
                            <span t-if="state.alerts.critical > 0" class="cc-alert-badge critical">
                                <t t-esc="state.alerts.critical"/> Critical
                            </span>
                            <span t-if="state.alerts.error > 0" class="cc-alert-badge error">
                                <t t-esc="state.alerts.error"/> Errors
                            </span>
                            <span t-if="state.alerts.warning > 0" class="cc-alert-badge warning">
                                <t t-esc="state.alerts.warning"/> Warnings
                            </span>
                            <span t-if="state.alerts.info > 0" class="cc-alert-badge info">
                                <t t-esc="state.alerts.info"/> Info
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Recent Runs -->
                <div class="cc-section">
                    <div class="cc-section-header">
                        <h3 class="cc-section-title">Recent Runs</h3>
                        <button class="btn btn-sm btn-link" t-on-click="openRuns">View All</button>
                    </div>
                    <div class="cc-section-body p-0">
                        <div class="cc-run-timeline">
                            <t t-foreach="state.recent_runs" t-as="run" t-key="run.id">
                                <div class="cc-run-item px-3">
                                    <div t-attf-class="cc-run-icon #{getStateClass(run.state)}">
                                        <i t-attf-class="fa #{getStateIcon(run.state)}"/>
                                    </div>
                                    <div class="cc-run-content">
                                        <div class="cc-run-name" t-esc="run.name"/>
                                        <div class="cc-run-meta">
                                            <span t-esc="run.run_type"/> â€¢
                                            <span t-if="run.user_id" t-esc="run.user_id[1]"/>
                                        </div>
                                    </div>
                                    <div class="cc-run-status">
                                        <span t-attf-class="badge #{run.state === 'done' ? 'bg-success' : run.state === 'failed' ? 'bg-danger' : run.state === 'running' ? 'bg-warning' : 'bg-secondary'}">
                                            <t t-esc="run.state"/>
                                        </span>
                                    </div>
                                </div>
                            </t>
                            <div t-if="!state.recent_runs.length" class="text-center text-muted py-4">
                                <i class="fa fa-inbox fa-2x mb-2"/>
                                <p>No runs yet</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="cc-section">
                    <div class="cc-section-header">
                        <h3 class="cc-section-title">Quick Actions</h3>
                    </div>
                    <div class="cc-section-body">
                        <div class="cc-quick-actions">
                            <button class="cc-action-btn primary">
                                <i class="fa fa-robot"/>
                                Ask AI
                            </button>
                            <button class="cc-action-btn secondary" t-on-click="openRuns">
                                <i class="fa fa-play"/>
                                View All Runs
                            </button>
                            <button class="cc-action-btn secondary" t-on-click="openAlerts">
                                <i class="fa fa-bell"/>
                                Manage Alerts
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>

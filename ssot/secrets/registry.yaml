# schema: ssot.secrets.v1
# Single source of truth for secret IDENTIFIERS used by InsightPulse AI.
#
# This file tracks:
#   - Secret names (not values)
#   - Purpose and scope
#   - Approved storage locations
#   - Which files/services consume each secret
#
# NEVER include secret values in this file.
# Values live in: macOS Keychain, GitHub Actions Secrets, Supabase Vault, Vercel env vars
#
# Workflow: docs/runbooks/SECRETS_SSOT.md

version: "1.0.0"
schema: ssot.secrets.v1
last_reviewed: "2026-02-27"

schema_rules:
  required_fields:
    - purpose
    - approved_stores
    - consumers
  consumer_format: "store:identifier"
  consumer_stores:
    - github_actions
    - vercel_env
    - supabase_vault
    - os_keychain
    - odoo_config_parameter
    - terraform          # infra/cloudflare/** Terraform configs
    - scripts            # scripts/infra/** automation scripts
    - acme_sh            # acme.sh DNS-01 cert issuance (reads CF_Key + CF_Email)

secrets:
  cf_dns_read_token:
    purpose: "Cloudflare DNS Zone:Read — CI drift gate"
    approved_stores:
      - github_actions
    github_secret_name: CF_DNS_READ_TOKEN
    consumers:
      - github_actions:.github/workflows/cloudflare-dns-drift.yml
      - github_actions:.github/workflows/domain-lint.yml
    rotation_policy: "Annually or on team member offboarding"
    notes: "Read-only token. Minimal blast radius."

  cf_dns_edit_token:
    purpose: "Cloudflare DNS Zone:Edit — Terraform apply via CI"
    approved_stores:
      - github_actions
    github_secret_name: CF_DNS_EDIT_TOKEN
    consumers:
      - github_actions:infra/cloudflare/envs/prod/
      - github_actions:.github/workflows/dns-ssot-apply.yml
    rotation_policy: "Annually or on team member offboarding"
    notes: "Edit-scoped token. Only used by Terraform apply workflow."

  zoho_client_id:
    purpose: "Zoho Mail API OAuth2 client ID"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: zoho_client_id
    consumers:
      - supabase_vault:zoho_client_id
      - odoo_config_parameter:addons/ipai/ipai_zoho_mail_api/
    rotation_policy: "On Zoho app credential reset"
    notes: "Pair with zoho_client_secret and zoho_refresh_token."

  zoho_client_secret:
    purpose: "Zoho Mail API OAuth2 client secret"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: zoho_client_secret
    consumers:
      - supabase_vault:zoho_client_secret
      - odoo_config_parameter:addons/ipai/ipai_zoho_mail_api/
    rotation_policy: "On Zoho app credential reset"
    notes: "Pair with zoho_client_id and zoho_refresh_token."

  zoho_refresh_token:
    purpose: "Zoho Mail API OAuth2 long-lived refresh token"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: zoho_refresh_token
    consumers:
      - supabase_vault:zoho_refresh_token
      - odoo_config_parameter:addons/ipai/ipai_zoho_mail_api/
    rotation_policy: "Every 6 months or when access is revoked"
    notes: "Used to obtain short-lived access tokens. Rotate proactively."

  supabase_service_role_key:
    purpose: "Supabase service role key (full RLS bypass — use sparingly)"
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: SUPABASE_SERVICE_ROLE_KEY
    consumers:
      - github_actions:SUPABASE_SERVICE_ROLE_KEY
      - os_keychain:local-dev
    rotation_policy: "Quarterly or on team member offboarding"
    notes: "Bypasses all RLS. Scope usage to CI/migration scripts only."

  supabase_anon_key:
    purpose: >
      Supabase project anon key (public-safe) for edge runtimes (Cloudflare Workers,
      browser clients, Next.js apps). RLS enforced — no service-role operations.
      This is the PUBLIC key; safe to expose in browser via NEXT_PUBLIC_ prefix.
    approved_stores:
      - os_keychain
      - vercel_env
      - supabase_vault
    vercel_env_name: NEXT_PUBLIC_SUPABASE_ANON_KEY
    consumers:
      - vercel_env:apps/ops-console        # NEXT_PUBLIC_SUPABASE_ANON_KEY
      - vercel_env:apps/workspace          # NEXT_PUBLIC_SUPABASE_ANON_KEY
      - vercel_env:apps/slack-agent        # NEXT_PUBLIC_SUPABASE_ANON_KEY (if needed)
      - cloudflare_workers:edge            # injected via Cloudflare env var (wrangler)
      - os_keychain:local-dev
    rotation_policy: "On Supabase project reset only"
    notes: >
      Public key — low sensitivity. Subject to RLS policies at all times.
      Consumers: cloudflare_workers (edge runtime via Cloudflare env vars),
      vercel apps (NEXT_PUBLIC_SUPABASE_ANON_KEY).
      See: ssot/integrations/cloudflare_workers.yaml, ssot/integrations/vercel_hosting.yaml

  gemini_api_key:
    purpose: "Google Gemini API key — Ops Console AI route (/api/ai/gemini)"
    approved_stores:
      - github_actions
      - vercel_env
    github_secret_name: GEMINI_API_KEY
    vercel_env_name: GEMINI_API_KEY
    consumers:
      - vercel_env:apps/ops-console
      - vercel_env:platform/ai/providers/gemini
      - github_actions:GEMINI_API_KEY
    rotation_policy: "Annually or on security incident"
    notes: "Required for Gemini bridge. Set in Vercel env vars for ops-console deployment."

  slack_bot_token:
    purpose: "Slack bot token for ipai_slack_connector notifications"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: slack_bot_token
    consumers:
      - supabase_vault:slack_bot_token
      - odoo_config_parameter:addons/ipai/ipai_slack_connector/
    rotation_policy: "On Slack app reinstallation or security incident"
    notes: "xoxb- prefix token. Scopes: chat:write, channels:read."

  slack_signing_secret:
    purpose: "Slack signing secret for webhook verification"
    approved_stores:
      - os_keychain
      - supabase_vault
    vault_secret_name: slack_signing_secret
    consumers:
      - supabase_vault:slack_signing_secret
      - odoo_config_parameter:addons/ipai/ipai_slack_connector/
    rotation_policy: "On Slack app reinstallation or security incident"
    notes: "Used to verify that webhook payloads come from Slack."

  github_token:
    purpose: "GitHub PAT for API access (repo operations, workflow triggers)"
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: GITHUB_TOKEN
    consumers:
      - github_actions:GITHUB_TOKEN
      - os_keychain:local-dev
    rotation_policy: "Annually or on team member offboarding"
    notes: "Use fine-grained PAT scoped to this repo only."

  do_access_token:
    purpose: "DigitalOcean API token — App Platform + Droplet management"
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: DO_ACCESS_TOKEN
    consumers:
      - github_actions:DO_ACCESS_TOKEN
      - os_keychain:local-dev
    rotation_policy: "Annually or on team member offboarding"
    notes: "Scoped to fin-workspace project where possible."

  anthropic_api_key:
    purpose: "Anthropic Claude API key — Odoo LLM provider + SoW workspace-ask-docs Edge Function"
    approved_stores:
      - odoo_config_parameter
      - supabase_vault
      - os_keychain
    consumers:
      - odoo_config_parameter:anthropic.api_key
      - supabase_vault:ANTHROPIC_API_KEY          # workspace-ask-docs Edge Function (primary LLM)
      - os_keychain:local-dev
    rotation_policy: "Annually or on API key compromise"
    notes: >
      Used by:
        1. llm_anthropic Odoo provider module (Apexive, ported to 19.0) — Odoo Settings → LLM → Providers.
        2. supabase/functions/workspace-ask-docs — SoW RAG answer generation (preferred provider).
           Returns 503 KEY_MISSING if absent and OPENAI_API_KEY is also absent.
      Key must support Claude 4.5/4.6 family (claude-sonnet-4-6, claude-opus-4-6).
      Never commit to git; never inject via Dockerfile ENV in tracked compose files.
      SSOT ref: ssot/secrets/registry.yaml#anthropic_api_key
      See: spec/ipai-llm-supabase-bridge/, docs/architecture/SOW_BOUNDARY.md

  openai_api_key:
    purpose: "OpenAI API key — workspace embedding (text-embedding-3-small) + LLM fallback"
    approved_stores:
      - supabase_vault
    consumers:
      - supabase_vault:OPENAI_API_KEY
    rotation_policy: "Annually or on API key compromise"
    notes: >
      Single Vault secret consumed by two SoW Edge Functions:
        1. supabase/functions/workspace-indexer — generates text-embedding-3-small vectors
           (1536 dims) for work.search_index. Indexing proceeds without vectors if key absent.
        2. supabase/functions/workspace-ask-docs — pgvector similarity search + GPT-4o-mini fallback
           if ANTHROPIC_API_KEY is absent. If both keys absent, function returns 503 KEY_MISSING.
      Embedding model: text-embedding-3-small (1536 dims, matches work.search_index.embedding column).
      NOT consumed by apps/workspace (Vercel) — workspace app routes through the Edge Function proxy.
      SSOT ref: ssot/secrets/registry.yaml#openai_api_key
      See: docs/architecture/SOW_BOUNDARY.md

  llm_bridge_webhook_secret:
    purpose: "HMAC-SHA256 shared secret for ipai_llm_supabase_bridge webhook signing"
    approved_stores:
      - supabase_vault
      - odoo_config_parameter
    consumers:
      - supabase_vault:LLM_BRIDGE_WEBHOOK_SECRET
      - odoo_config_parameter:ipai_llm_supabase_bridge.webhook_secret
    rotation_policy: "Rotate on team member offboarding or suspected exposure"
    notes: >
      Must be identical on both sides: Supabase Edge Function reads from Vault;
      Odoo bridge reads from ir.config_parameter (set via Settings UI).
      Minimum 32 random bytes (base64 or hex). Generate with:
        python3 -c "import secrets; print(secrets.token_hex(32))"
      See: spec/ipai-llm-supabase-bridge/

  # ---------------------------------------------------------------------------
  # Cloudflare infra credentials (DNS automation, cert issuance)
  # scope: infra — NOT for runtime app use. See storage_policy below.
  # ---------------------------------------------------------------------------
  cloudflare_global_api_key:
    purpose: >
      Cloudflare Global API Key (37-char hex, email+key auth) used for
      acme.sh DNS-01 cert issuance and ad-hoc Cloudflare API operations.
      Used as CF_Key (acme.sh) and TF_VAR_cloudflare_api_token (Terraform local).
    scope: infra
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: CF_GLOBAL_API_KEY
    os_keychain_service: cloudflare-global-api-key
    os_keychain_account: default
    storage_policy:
      local: os_keychain   # load via scripts/infra/load_cloudflare_env.sh
      ci: github_actions_secret
      runtime: prohibited
    prohibited_consumers:
      - supabase_vault     # infra key — not for runtime Edge Function use
      - odoo_config_parameter  # Odoo must never call CF DNS APIs directly
      - vercel_env         # not a runtime secret
    consumers:
      - os_keychain:local-dev  # loaded by scripts/infra/load_cloudflare_env.sh
      - github_actions:CF_GLOBAL_API_KEY
      - scripts:scripts/infra/load_cloudflare_env.sh
      - acme_sh:CF_Key  # acme.sh reads CF_Key + CF_Email env vars for DNS-01
    rotation_policy: "Annually or on team member offboarding"
    notes: >
      Pair with CF_Email (Jgtolentino.rn@gmail.com) when authenticating via
      X-Auth-Key / X-Auth-Email headers. For new tooling prefer a scoped
      API token (cf_dns_edit_token) over the global key where possible.
      Load locally with:
        source scripts/infra/load_cloudflare_env.sh

  cloudflare_zone_id:
    purpose: >
      Cloudflare Zone ID for insightpulseai.com (73f587aee652fc24fd643aec00dcca81).
      Not a secret per se, but stored alongside API credentials to keep infra
      config out of source code.
    scope: infra
    approved_stores:
      - os_keychain
      - github_actions
    github_secret_name: CF_DNS_ZONE_ID
    os_keychain_service: cloudflare-zone-id
    os_keychain_account: insightpulseai.com
    storage_policy:
      local: os_keychain
      ci: github_actions_secret
      runtime: prohibited
    prohibited_consumers:
      - supabase_vault
      - odoo_config_parameter
    consumers:
      - github_actions:.github/workflows/cloudflare-dns-apply.yml
      - github_actions:.github/workflows/dns-ssot-apply.yml
      - terraform:infra/cloudflare/envs/prod/
      - scripts:scripts/infra/load_cloudflare_env.sh
    rotation_policy: "Static — only changes if domain is moved to a new CF account"
    notes: >
      Zone ID is readable from the Cloudflare dashboard Overview page.
      Treat as semi-sensitive: not a credential but uniquely identifies
      the zone and should not appear in public PR descriptions or logs.

  # ---------------------------------------------------------------------------
  # Email SMTP credentials (Zoho Mail bridge)
  # scope: runtime — consumed by Odoo SMTP configuration and ipai_mail_bridge_zoho
  # ---------------------------------------------------------------------------
  zoho_smtp_user:
    purpose: "Zoho Mail SMTP username (e.g. noreply@insightpulseai.com) for Odoo outbound email"
    scope: runtime
    approved_stores:
      - odoo_config_parameter
      - os_keychain
    consumers:
      - odoo_config_parameter:ir.mail_server.smtp_user
      - os_keychain:local-dev
    rotation_policy: "On Zoho mail account change or security incident"
    notes: >
      Used by the ipai_mail_bridge_zoho module to authenticate outbound SMTP.
      Pair with zoho_smtp_app_password.
      Set in Odoo Settings → Technical → Outgoing Mail Servers.
      Referenced in ssot/runtime/prod_settings.yaml.

  zoho_smtp_app_password:
    purpose: "Zoho Mail SMTP app-specific password for Odoo outbound email (not the account password)"
    scope: runtime
    approved_stores:
      - odoo_config_parameter
      - os_keychain
    consumers:
      - odoo_config_parameter:ir.mail_server.smtp_pass
      - os_keychain:local-dev
    rotation_policy: "Annually or on security incident — generate from Zoho Security → App Passwords"
    notes: >
      Must be an app-specific password, NOT the Zoho account login password.
      Generate in Zoho Mail → Settings → Security → App Passwords.
      Pair with zoho_smtp_user. Referenced in ssot/runtime/prod_settings.yaml.

  # ---------------------------------------------------------------------------
  # OCR microservice credentials
  # scope: runtime — consumed by Odoo OCR bridge module
  # ---------------------------------------------------------------------------
  supabase_management_token:
    purpose: "Supabase Management API Personal Access Token (PAT) — used by CI to verify runtime auth config (MFA state, project settings)"
    scope: infra
    approved_stores:
      - github_actions
      - os_keychain
    github_secret_name: SUPABASE_MANAGEMENT_TOKEN
    os_keychain_service: supabase-management-token
    storage_policy:
      local: os_keychain
      ci: github_actions_secret
      runtime: prohibited
    prohibited_consumers:
      - odoo_config_parameter
      - supabase_vault
    consumers:
      - github_actions:.github/workflows/prod-mfa-runtime-gate.yml
      - os_keychain:local-dev
    rotation_policy: "Annually or on team member offboarding"
    notes: >
      sbp_... format PAT. Used exclusively for read-only Management API calls
      (GET /v1/projects/{ref}/config/auth). Requires project ref SUPABASE_PROJECT_REF.
      Generate in Supabase Dashboard → Account → Access Tokens.
      Distinct from supabase_service_role_key (project-level key vs account-level PAT).

  stripe_secret_key:
    purpose: "Stripe secret API key for server-side use (Supabase Stripe FDW + Edge Functions). ROTATE if exposed."
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: stripe_secret_key
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - odoo_config_parameter  # Odoo does not call Stripe directly
      - github_actions          # Never inject Stripe secret keys into CI env
    consumers:
      - supabase_vault:stripe_secret_key   # consumed by Stripe FDW server (api_key_id)
    rotation_policy: "Immediately on exposure; quarterly for live keys; on team member offboarding"
    notes: >
      sk_test_... (test) | sk_live_... (prod — required when payments.stripe.mode=live).
      Store in Supabase Vault; FDW references via api_key_id (UUID), never the raw key.
      Rotate in Stripe Dashboard → API Keys → Roll key. Update Vault secret after rotation.
      See: ssot/runtime/prod_settings.yaml payments.stripe.secrets.secret_key

  stripe_webhook_signing_secret:
    purpose: "Stripe webhook signing secret (whsec_...) for Edge Function signature verification"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: stripe_webhook_signing_secret
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - odoo_config_parameter
      - github_actions
    consumers:
      - supabase_vault:stripe_webhook_signing_secret   # consumed by supabase/functions/stripe-webhook/
    rotation_policy: "On webhook endpoint rotation or signing secret regeneration in Stripe Dashboard"
    notes: >
      whsec_... format. Obtained from: Stripe Dashboard → Webhooks → endpoint → Signing secret.
      Used by Supabase Edge Function to verify Stripe event signatures via
      stripe.webhooks.constructEvent. Separate from stripe_secret_key — rotate independently.
      See: ssot/runtime/prod_settings.yaml payments.stripe.secrets.webhook_signing_secret

  stripe_publishable_key:
    purpose: "Stripe publishable key (pk_live_... or pk_test_...) for client-side Stripe.js / checkout"
    scope: runtime
    approved_stores:
      - supabase_vault
      - vercel_env
      - os_keychain
    vault_secret_name: stripe_publishable_key
    vercel_env_name: NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
    storage_policy:
      local: os_keychain
      ci: vercel_env
      runtime: vercel_env   # safe to expose to browser; still centralized via Vault/env
    prohibited_consumers:
      - odoo_config_parameter
    consumers:
      - vercel_env:apps/ops-console
      - supabase_vault:stripe_publishable_key
    rotation_policy: "On Stripe account compromise or key rollover"
    notes: >
      pk_test_... (test) | pk_live_... (prod). Safe to expose in browser / client-side JS.
      Must match the mode of stripe_secret_key (both test or both live — never mix).
      Set as NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY in Vercel for ops-console.
      See: ssot/runtime/prod_settings.yaml payments.stripe.public.publishable_key_ref

  slack_signing_secret:
    purpose: "Slack App signing secret — HMAC-SHA256 endpoint signature verification (apps/slack-agent)"
    scope: runtime
    approved_stores:
      - supabase_vault
      - vercel_env
      - os_keychain
    vault_secret_name: slack_signing_secret
    vercel_env_name: SLACK_SIGNING_SECRET
    storage_policy:
      local: os_keychain
      ci: vercel_env
      runtime: vercel_env
    prohibited_consumers:
      - odoo_config_parameter
      - github_actions
    consumers:
      - vercel_env:apps/slack-agent
      - supabase_vault:slack_signing_secret
    rotation_policy: "On Slack App credential reset or team member offboarding"
    notes: >
      Obtained from: Slack App → Basic Information → App Credentials → Signing Secret.
      Used by apps/slack-agent/server/lib/verify.ts to verify X-Slack-Signature headers.
      Mapped to runtimeConfig.slackSigningSecret via nitro.config.ts.
      NEVER log or echo this value; rotate immediately on exposure.
      See: ssot/integrations/slack_agent.yaml, docs/architecture/SLACK_AGENT_CONTRACT.md §6

  slack_bot_token:
    purpose: "Slack Bot OAuth token (xoxb-...) for posting run results via chat.postMessage"
    scope: runtime
    approved_stores:
      - supabase_vault
      - vercel_env
      - os_keychain
    vault_secret_name: slack_bot_token
    vercel_env_name: SLACK_BOT_TOKEN
    storage_policy:
      local: os_keychain
      ci: vercel_env
      runtime: vercel_env
    prohibited_consumers:
      - odoo_config_parameter
      - github_actions
    consumers:
      - vercel_env:apps/slack-agent
      - supabase_vault:slack_bot_token
    rotation_policy: "On Slack App reinstall or token revocation"
    notes: >
      Obtained from: Slack App → OAuth & Permissions → Bot User OAuth Token (xoxb-...).
      Used by apps/slack-agent/server/lib/notify.ts (@slack/web-api WebClient).
      Mapped to runtimeConfig.slackBotToken via nitro.config.ts.
      Required OAuth scopes: chat:write, chat:write.public.
      See: ssot/integrations/slack_agent.yaml, docs/architecture/SLACK_AGENT_CONTRACT.md §6

  ocr_bridge_token:
    purpose: "Shared bearer token for Odoo → PaddleOCR microservice authentication"
    scope: runtime
    approved_stores:
      - odoo_config_parameter
      - os_keychain
    consumers:
      - odoo_config_parameter:ipai_ocr_bridge.bridge_token
      - os_keychain:local-dev
    rotation_policy: "Rotate on team member offboarding or suspected exposure"
    notes: >
      Used by the OCR bridge module to authenticate requests to ocr.insightpulseai.com.
      Minimum 32 random bytes. Generate with:
        python3 -c "import secrets; print(secrets.token_hex(32))"
      Set as BEARER_TOKEN env var on the ocr-prod container and as
      ir.config_parameter in Odoo. Referenced in ssot/runtime/prod_settings.yaml.

  # ---------------------------------------------------------------------------
  # Plane.so integration credentials
  # scope: runtime — consumed by supabase/functions/plane-sync and plane-webhook
  # See: ssot/integrations/plane_webhooks.yaml, docs/architecture/PLANE_APP_CONNECTOR.md
  # ---------------------------------------------------------------------------
  plane_api_key:
    purpose: "Plane.so API key (X-API-Key) for server-side sync worker"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: plane_api_key
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions
      - vercel_env    # server-only; never expose to browser
    consumers:
      - supabase_vault:plane_api_key   # consumed by supabase/functions/plane-sync
    rotation_policy: "On team member offboarding or Plane workspace credential reset"
    notes: >
      Plane API key (X-API-Key header). Server-side only.
      Obtain from: Plane workspace → Settings → API Tokens.
      See: ssot/integrations/plane_webhooks.yaml

  plane_oauth_client_id:
    purpose: "Plane OAuth2 app client ID for user-scoped access"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: plane_oauth_client_id
    prohibited_consumers:
      - github_actions
    consumers:
      - supabase_vault:plane_oauth_client_id
    rotation_policy: "On Plane app re-registration"
    notes: "Pair with plane_oauth_client_secret. See: docs/architecture/PLANE_APP_CONNECTOR.md"

  plane_oauth_client_secret:
    purpose: "Plane OAuth2 app client secret for token exchange"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: plane_oauth_client_secret
    prohibited_consumers:
      - github_actions
      - vercel_env
    consumers:
      - supabase_vault:plane_oauth_client_secret
    rotation_policy: "On Plane app re-registration or exposure"
    notes: "Pair with plane_oauth_client_id. NEVER expose in browser or logs."

  plane_workspace_id:
    purpose: "Plane.so workspace slug — injected into all API paths, MCP tool calls, and sync workers"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: plane_workspace_id
    prohibited_consumers:
      - github_actions
      - vercel_env
    consumers:
      - supabase_vault:plane_workspace_id
    rotation_policy: "On workspace rename or access revocation"
    notes: >
      Workspace slug (not UUID) used in Plane REST API paths: /api/v1/workspaces/{slug}/...
      Obtain from: Plane → Settings → General → Workspace Slug.
      See: ssot/integrations/plane.yaml, ssot/integrations/plane_mcp.yaml

  plane_webhook_secret:
    purpose: "Shared secret for validating inbound Plane webhook payloads"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: plane_webhook_secret
    prohibited_consumers:
      - github_actions
      - vercel_env
    consumers:
      - supabase_vault:plane_webhook_secret
    rotation_policy: "On team member offboarding or exposure"
    notes: >
      Embedded as X-Plane-Webhook-Secret header or in webhook URL path.
      Generate: python3 -c "import secrets; print(secrets.token_hex(32))"
      See: ssot/integrations/plane_webhooks.yaml §risk_flags.webhook_no_signature

  # ---------------------------------------------------------------------------
  # n8n automation runner credentials
  # scope: runtime — consumed by n8n self-hosted instance and CI automation
  # See: ssot/integrations/n8n.yaml, docs/architecture/N8N_AUTOMATION_CONTRACT.md
  # ---------------------------------------------------------------------------
  n8n_api_key:
    purpose: "n8n REST API key for external triggering (CI scripts, agents, GitHub Actions)"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: n8n_api_key
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions   # n8n API key must not be injected into CI env directly
      - vercel_env       # server-side only
    consumers:
      - supabase_vault:n8n_api_key
      - os_keychain:local-dev
    rotation_policy: "On team member offboarding or n8n credential reset"
    notes: >
      Used to trigger n8n workflows programmatically via the REST API
      (e.g., POST /api/v1/workflows/{id}/execute).
      Set as the value of the X-N8N-API-KEY header.
      Obtain from: n8n → Settings → API → Create API key.
      See: ssot/integrations/n8n.yaml, docs/architecture/N8N_AUTOMATION_CONTRACT.md §6

  n8n_webhook_secret:
    purpose: "Shared HMAC/Header-Auth secret for n8n webhook node authentication"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: n8n_webhook_secret
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions
      - vercel_env
    consumers:
      - supabase_vault:n8n_webhook_secret
      - os_keychain:local-dev
    rotation_policy: "Rotate on team member offboarding or webhook endpoint leak"
    notes: >
      Used as the secret value in n8n Header Auth credentials attached to
      webhook trigger nodes. Callers must include the header X-N8N-Webhook-Secret
      (or the credential-specific header name) in every webhook POST.
      Minimum 32 random bytes. Generate with:
        python3 -c "import secrets; print(secrets.token_hex(32))"
      Also configure as the corresponding caller-side header in:
        apps/slack-agent (for Slack → n8n callback paths, if any)
        GitHub webhook payloads via X-Hub-Signature-256 (separate secret)
      See: automations/n8n/CREDENTIALS.md

  # ---------------------------------------------------------------------------
  # Supabase partner integrations secrets
  # scope: runtime/infra — Cloudflare Workers edge runtime, Vercel hosting
  # See: ssot/integrations/cloudflare_workers.yaml, ssot/integrations/vercel_hosting.yaml
  # ---------------------------------------------------------------------------
  vercel_token:
    purpose: >
      Vercel API token for CI automation (only if needed for programmatic deploys
      via Vercel REST API). Omit entirely if Vercel deploys are manual or
      GitHub-linked (push-to-deploy) only.
    scope: infra
    approved_stores:
      - github_actions
      - os_keychain
    github_secret_name: VERCEL_TOKEN
    storage_policy:
      local: os_keychain
      ci: github_actions_secret
      runtime: prohibited    # Vercel token must not be injected into Vercel env vars (recursive)
    prohibited_consumers:
      - vercel_env           # Recursive — do not inject the Vercel token into Vercel itself
      - supabase_vault       # Not needed at runtime; infra-only
    consumers:
      - github_actions:.github/workflows/deploy-vercel.yml
      - os_keychain:local-dev
    rotation_policy: "Annually or on team member offboarding"
    notes: >
      Omit entirely if Vercel deploys are manual/GitHub-linked only (push-to-deploy).
      Only provision this token when CI needs to trigger or manage Vercel deployments
      programmatically (e.g., via `vercel deploy --token`).
      Obtain from: Vercel Dashboard → Settings → Tokens.
      See: ssot/integrations/vercel_hosting.yaml

  # ---------------------------------------------------------------------------
  # Figma design platform credentials
  # scope: runtime — consumed by supabase/functions/figma-*, CI variables sync,
  #   MCP agent bridge, Code Connect publish
  # See: ssot/integrations/figma.yaml, docs/architecture/FIGMA_INTEGRATION_SURFACE.md
  # ---------------------------------------------------------------------------
  figma_oauth_client_id:
    purpose: "Figma OAuth2 app client ID for user-scoped REST API access"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: figma_oauth_client_id
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions   # inject via Vault read, not direct env injection
      - vercel_env       # browser-facing; must not reach browser
    consumers:
      - supabase_vault:figma_oauth_client_id   # consumed by supabase/functions/figma-api
      - os_keychain:local-dev
    rotation_policy: "On Figma app credential reset or team member offboarding"
    notes: >
      Pair with figma_oauth_client_secret.
      Obtain from: Figma → Settings → Apps → OAuth2 app registration.
      Use OAuth2 for user-scoped access (design team CI, workspace reads).
      For internal tooling (CI, MCP, agents) prefer figma_personal_access_token.
      See: ssot/integrations/figma.yaml, docs/architecture/FIGMA_INTEGRATION_SURFACE.md §3

  figma_oauth_client_secret:
    purpose: "Figma OAuth2 app client secret for token exchange (server-only)"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: figma_oauth_client_secret
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions   # server-only; must not appear in CI env vars
      - vercel_env       # must never reach browser
    consumers:
      - supabase_vault:figma_oauth_client_secret   # consumed by supabase/functions/figma-api
      - os_keychain:local-dev
    rotation_policy: "On Figma app credential reset or team member offboarding"
    notes: >
      Server-only. Token exchange must happen in supabase/functions/figma-api/ only.
      NEVER log or echo this value; rotate immediately on exposure.
      Pair with figma_oauth_client_id.
      See: ssot/integrations/figma.yaml, docs/architecture/FIGMA_INTEGRATION_SURFACE.md §3

  figma_personal_access_token:
    purpose: "Figma PAT for internal automation (CI, MCP server bridge, agent tooling)"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: figma_personal_access_token
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions   # inject via Vault read at runtime, not as CI env var directly
      - vercel_env       # server-only; must not reach browser
    consumers:
      - supabase_vault:figma_personal_access_token   # consumed by MCP bridge + figma-api
      - os_keychain:local-dev
    rotation_policy: "On team member offboarding or suspected exposure"
    notes: >
      PAT has no built-in expiry — rotate proactively on offboarding.
      Prefer OAuth2 for user-scoped access; use PAT only for internal tooling
      (CI variables sync, MCP agent bridge, Code Connect publish).
      Obtain from: Figma → Account Settings → Personal access tokens.
      Used by agents/mcp/figma.json as FIGMA_PERSONAL_ACCESS_TOKEN env var.
      See: ssot/integrations/figma.yaml, docs/architecture/FIGMA_INTEGRATION_SURFACE.md §3, §7

  figma_webhook_secret:
    purpose: "Shared secret for Figma webhook signature verification (x-figma-signature HMAC-SHA256)"
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: figma_webhook_secret
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - github_actions   # server-only; must not be in CI env
      - vercel_env       # must never reach browser
    consumers:
      - supabase_vault:figma_webhook_secret   # consumed by supabase/functions/figma-webhook
      - os_keychain:local-dev
    rotation_policy: "On webhook endpoint compromise or team member offboarding"
    notes: >
      Must be set BEFORE registering any Figma webhook via the API.
      supabase/functions/figma-webhook/ verifies x-figma-signature on every request.
      Function refuses to start if this secret is absent from Vault (cold-start guard).
      Minimum 32 random bytes. Generate with:
        python3 -c "import secrets; print(secrets.token_hex(32))"
      Set as the 'passcode' field in the webhook registration payload.
      See: ssot/integrations/figma.yaml, docs/architecture/FIGMA_INTEGRATION_SURFACE.md §4

# ── DigitalOcean automation credentials ───────────────────────────────────────

  digitalocean_api_token:
    purpose: "DigitalOcean API token for doctl/PyDo automation and Ops Advisor DO scan adapter."
    scope: runtime
    approved_stores:
      - supabase_vault
      - os_keychain
    vault_secret_name: digitalocean_api_token
    storage_policy:
      local: os_keychain
      ci: supabase_vault
      runtime: supabase_vault
    prohibited_consumers:
      - vercel_env       # must never reach browser
      - github_actions   # use Supabase Vault for scan adapter; avoid in CI unless absolutely required
    consumers:
      - supabase_vault:digitalocean_api_token   # consumed by Ops Advisor DO scan adapter
      - os_keychain:local-dev
    rotation_policy: "On team member offboarding or token compromise."
    notes: >
      Read/write scopes required for scan adapter: droplets (read), monitoring (read),
      databases (read), volumes (read), snapshots (read).
      Prefer read-only scopes where possible.
      See: ssot/infra/digitalocean/automation.yaml, ssot/infra/digitalocean/monitoring.yaml

# ── Vercel AI Gateway credentials ─────────────────────────────────────────────

  vercel_ai_gateway_api_key:
    purpose: "Vercel AI Gateway API key — unified LLM provider routing + observability/billing."
    scope: runtime
    approved_stores:
      - supabase_vault
      - vercel_env        # server-side only (process.env, never client-side)
    vault_secret_name: vercel_ai_gateway_api_key
    storage_policy:
      local: vercel_env (pulled via `vercel env pull`)
      ci: supabase_vault
      runtime: vercel_env (server-side only)
    prohibited_consumers:
      - browser_bundle    # must never reach client-side bundle
      - github_actions    # route through Supabase Vault
    consumers:
      - apps/workspace:vercel_env        # RAG endpoint LLM calls
      - apps/slack-agent:vercel_env      # agent LLM calls
      - apps/odooops-console:vercel_env  # Advisor AI explanations
    rotation_policy: "On suspected key exposure or quarterly review."
    notes: >
      Single endpoint for many LLM providers (OpenAI, Anthropic, etc.) with unified
      billing and observability. Use to route model calls instead of calling providers directly.
      Log each call to ops.run_events with provider/model/cost metadata.
      See: ssot/integrations/vercel_ai_gateway.yaml, docs/architecture/VERCEL_AI_SURFACES.md

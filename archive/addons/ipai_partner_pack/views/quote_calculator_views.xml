<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Quote Calculator Config Tree View -->
    <record id="view_quote_calculator_config_tree" model="ir.ui.view">
        <field name="name">ipai.quote.calculator.config.tree</field>
        <field name="model">ipai.quote.calculator.config</field>
        <field name="arch" type="xml">
            <list string="Calculator Configurations">
                <field name="sequence" widget="handle"/>
                <field name="code"/>
                <field name="name"/>
                <field name="base_hourly_rate"/>
                <field name="currency_id"/>
                <field name="active" optional="hide"/>
            </list>
        </field>
    </record>

    <!-- Quote Calculator Config Form View -->
    <record id="view_quote_calculator_config_form" model="ir.ui.view">
        <field name="name">ipai.quote.calculator.config.form</field>
        <field name="model">ipai.quote.calculator.config</field>
        <field name="arch" type="xml">
            <form string="Calculator Configuration">
                <sheet>
                    <widget name="web_ribbon" title="Archived" bg_color="text-bg-danger" invisible="active"/>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1><field name="name" placeholder="Configuration Name..."/></h1>
                    </div>
                    <group>
                        <group string="Basic Settings">
                            <field name="code"/>
                            <field name="sequence"/>
                            <field name="active" invisible="1"/>
                        </group>
                        <group string="Pricing">
                            <field name="base_hourly_rate"/>
                            <field name="currency_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Pricing Rules" name="pricing">
                            <field name="pricing_rules" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="User Count Bands" name="user_bands">
                            <field name="user_count_bands" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="App Bundle Rules" name="app_bundles">
                            <field name="app_bundle_rules" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Description" name="description">
                            <field name="description"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Quote Calculator Config Action -->
    <record id="action_quote_calculator_config" model="ir.actions.act_window">
        <field name="name">Calculator Configurations</field>
        <field name="res_model">ipai.quote.calculator.config</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_filter_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first calculator configuration
            </p>
            <p>
                Calculator configurations define pricing rules, user bands,
                and app bundle discounts for quote generation.
            </p>
        </field>
    </record>

    <!-- Quote Calculator Run Tree View -->
    <record id="view_quote_calculator_run_tree" model="ir.ui.view">
        <field name="name">ipai.quote.calculator.run.tree</field>
        <field name="model">ipai.quote.calculator.run</field>
        <field name="arch" type="xml">
            <list string="Quote Calculator Runs" decoration-muted="state == 'cancelled'" decoration-success="state == 'quoted'">
                <field name="name"/>
                <field name="lead_id"/>
                <field name="partner_id"/>
                <field name="user_count"/>
                <field name="app_count"/>
                <field name="complexity" widget="badge"/>
                <field name="estimated_hours"/>
                <field name="estimated_amount" widget="monetary"/>
                <field name="state" widget="badge" decoration-info="state == 'draft'" decoration-success="state == 'quoted'" decoration-warning="state == 'calculated'" decoration-danger="state == 'cancelled'"/>
                <field name="currency_id" column_invisible="True"/>
            </list>
        </field>
    </record>

    <!-- Quote Calculator Run Form View -->
    <record id="view_quote_calculator_run_form" model="ir.ui.view">
        <field name="name">ipai.quote.calculator.run.form</field>
        <field name="model">ipai.quote.calculator.run</field>
        <field name="arch" type="xml">
            <form string="Quote Calculator Run">
                <header>
                    <button name="action_calculate" string="Calculate" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                    <button name="action_create_quote" string="Create Quote" type="object" class="oe_highlight" invisible="state != 'calculated'"/>
                    <button name="action_cancel" string="Cancel" type="object" invisible="state in ('cancelled', 'quoted')"/>
                    <button name="action_reset_draft" string="Reset to Draft" type="object" invisible="state != 'cancelled'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,calculated,quoted"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="action_create_quote" icon="fa-file-text-o" invisible="not sale_order_id">
                            <field name="sale_order_id" widget="statinfo" string="Quote"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1><field name="name" readonly="1"/></h1>
                    </div>
                    <group>
                        <group string="Configuration">
                            <field name="config_id"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                        <group string="Customer">
                            <field name="lead_id"/>
                            <field name="partner_id"/>
                        </group>
                    </group>
                    <group>
                        <group string="Calculator Inputs">
                            <field name="user_count"/>
                            <field name="app_count"/>
                            <field name="complexity" widget="radio"/>
                        </group>
                        <group string="Results">
                            <field name="recommended_pack_id"/>
                            <field name="estimated_hours"/>
                            <field name="estimated_amount" widget="monetary"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Computed Lines" name="computed">
                            <field name="computed_lines" widget="ace" options="{'mode': 'json'}" readonly="1"/>
                        </page>
                        <page string="Raw Inputs" name="inputs">
                            <field name="inputs_json" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Notes" name="notes">
                            <field name="notes"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Quote Calculator Run Search View -->
    <record id="view_quote_calculator_run_search" model="ir.ui.view">
        <field name="name">ipai.quote.calculator.run.search</field>
        <field name="model">ipai.quote.calculator.run</field>
        <field name="arch" type="xml">
            <search string="Search Calculator Runs">
                <field name="name"/>
                <field name="lead_id"/>
                <field name="partner_id"/>
                <separator/>
                <filter string="Draft" name="filter_draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Calculated" name="filter_calculated" domain="[('state', '=', 'calculated')]"/>
                <filter string="Quoted" name="filter_quoted" domain="[('state', '=', 'quoted')]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter string="State" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Complexity" name="group_complexity" context="{'group_by': 'complexity'}"/>
                    <filter string="Customer" name="group_partner" context="{'group_by': 'partner_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Quote Calculator Run Action -->
    <record id="action_quote_calculator_run" model="ir.actions.act_window">
        <field name="name">Quote Calculator</field>
        <field name="res_model">ipai.quote.calculator.run</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Run a new quote calculation
            </p>
            <p>
                Use the quote calculator to estimate implementation scope
                and generate sales quotations automatically.
            </p>
        </field>
    </record>

    <!-- Sequence for Quote Calculator Run -->
    <record id="sequence_quote_calculator_run" model="ir.sequence">
        <field name="name">Quote Calculator Run</field>
        <field name="code">ipai.quote.calculator.run</field>
        <field name="prefix">QC-</field>
        <field name="padding">5</field>
    </record>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ==================== Security Groups ==================== -->

    <record id="module_category_control_room" model="ir.module.category">
        <field name="name">Control Room</field>
        <field name="description">Control Room application access</field>
        <field name="sequence">50</field>
    </record>

    <!-- User: Can view and trigger pipelines, view DQ issues -->
    <record id="group_control_room_user" model="res.groups">
        <field name="name">User</field>
        <field name="category_id" ref="module_category_control_room"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Operator: Can manage pipelines, rules, resolve issues -->
    <record id="group_control_room_operator" model="res.groups">
        <field name="name">Operator</field>
        <field name="category_id" ref="module_category_control_room"/>
        <field name="implied_ids" eval="[(4, ref('group_control_room_user'))]"/>
    </record>

    <!-- Admin: Full access including settings -->
    <record id="group_control_room_admin" model="res.groups">
        <field name="name">Administrator</field>
        <field name="category_id" ref="module_category_control_room"/>
        <field name="implied_ids" eval="[(4, ref('group_control_room_operator'))]"/>
        <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
    </record>

    <!-- ==================== Record Rules ==================== -->

    <!-- Company-based record rules for multi-company support -->

    <record id="rule_control_pipeline_company" model="ir.rule">
        <field name="name">Control Pipeline: Company</field>
        <field name="model_id" ref="model_control_pipeline"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_run_company" model="ir.rule">
        <field name="name">Control Run: Company</field>
        <field name="model_id" ref="model_control_run"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_dq_rule_company" model="ir.rule">
        <field name="name">Control DQ Rule: Company</field>
        <field name="model_id" ref="model_control_dq_rule"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_connector_company" model="ir.rule">
        <field name="name">Control Connector: Company</field>
        <field name="model_id" ref="model_control_connector"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_advice_company" model="ir.rule">
        <field name="name">Control Advice: Company</field>
        <field name="model_id" ref="model_control_advice"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_playbook_company" model="ir.rule">
        <field name="name">Control Playbook: Company</field>
        <field name="model_id" ref="model_control_playbook"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_feature_flag_company" model="ir.rule">
        <field name="name">Control Feature Flag: Company</field>
        <field name="model_id" ref="model_control_feature_flag"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_notification_channel_company" model="ir.rule">
        <field name="name">Control Notification Channel: Company</field>
        <field name="model_id" ref="model_control_notification_channel"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="rule_control_secret_ref_company" model="ir.rule">
        <field name="name">Control Secret Reference: Company</field>
        <field name="model_id" ref="model_control_secret_ref"/>
        <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>
</odoo>

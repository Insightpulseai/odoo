{"version":3,"sources":["/Users/tbwa/Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/src/lib/docs/loader.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport matter from \"gray-matter\";\n\n// Paths\nconst REPO_ROOT = path.resolve(process.cwd(), \"../..\"); // Assuming running from templates/odooops-console\nconst OVERRIDES_DIR = path.join(\n  process.cwd(),\n  \"src/content/docs/upstream_overrides\",\n);\nconst DEPLOYED_DIR = path.join(process.cwd(), \"src/content/docs/stack\");\nconst UPSTREAM_DIR = path.resolve(REPO_ROOT, \"docs/kb/odoo19/upstream\");\n\nexport interface DocPage {\n  slug: string;\n  title: string;\n  content: string;\n  sourceLayer: \"override\" | \"deployed\" | \"upstream\";\n  meta: Record<string, any>;\n}\n\nexport async function getDocPage(slugParts: string[]): Promise<DocPage | null> {\n  const slugPath = slugParts.join(\"/\");\n\n  // 1. Check Overrides (Highest Priority)\n  // Logic: Overrides mirror upstream structure.\n  const overridePath = path.join(OVERRIDES_DIR, `${slugPath}.md`);\n  if (fs.existsSync(overridePath)) {\n    return loadFile(overridePath, slugPath, \"override\");\n  } else {\n    // Check for index file in directory\n    const overrideIndexPath = path.join(OVERRIDES_DIR, slugPath, \"index.md\");\n    if (fs.existsSync(overrideIndexPath)) {\n      return loadFile(overrideIndexPath, slugPath, \"override\");\n    }\n  }\n\n  // 2. Check Deployed Stack (Middle Priority)\n  // Logic: 'stack' prefix usually maps to deployed/ folder, but user said \"deployed > upstream\"\n  // If the slug matches a file in src/content/docs/stack, serve it.\n  // Note: Stack docs usually have their own namespace, e.g., /docs/stack/runtime.\n  // The resolver usually handles \"if path exists in multiple, who wins?\"\n\n  // We assume 'stack' docs might collide if we flatten namespaces, but usually they are distinct.\n  // However, strict precedence means we check here.\n  const deployedPath = path.join(DEPLOYED_DIR, `${slugPath}.md`);\n  if (fs.existsSync(deployedPath)) {\n    return loadFile(deployedPath, slugPath, \"deployed\");\n  }\n\n  // 3. Check Upstream (Lowest Priority)\n  // Upstream docs are likely RST and located in `content/` subdirectory based on `find` output.\n  const upstreamContentDir = path.join(UPSTREAM_DIR, \"content\");\n\n  // Check for MD/MDX first (in case of conversion)\n  let upstreamPath = path.join(upstreamContentDir, `${slugPath}.md`);\n  if (fs.existsSync(upstreamPath)) {\n    return loadFile(upstreamPath, slugPath, \"upstream\");\n  }\n\n  // Check for RST\n  upstreamPath = path.join(upstreamContentDir, `${slugPath}.rst`);\n  if (fs.existsSync(upstreamPath)) {\n    return loadFile(upstreamPath, slugPath, \"upstream\");\n  }\n\n  // Check for index (MD then RST)\n  const upstreamIndexMd = path.join(upstreamContentDir, slugPath, \"index.md\");\n  if (fs.existsSync(upstreamIndexMd)) {\n    return loadFile(upstreamIndexMd, slugPath, \"upstream\");\n  }\n  const upstreamIndexRst = path.join(upstreamContentDir, slugPath, \"index.rst\");\n  if (fs.existsSync(upstreamIndexRst)) {\n    return loadFile(upstreamIndexRst, slugPath, \"upstream\");\n  }\n\n  return null;\n}\n\nfunction loadFile(\n  filePath: string,\n  slug: string,\n  layer: \"override\" | \"deployed\" | \"upstream\",\n): DocPage {\n  const fileContent = fs.readFileSync(filePath, \"utf8\");\n  const { data, content } = matter(fileContent);\n\n  return {\n    slug,\n    title: data.title || slug.split(\"/\").pop() || \"Untitled\",\n    content,\n    sourceLayer: layer,\n    meta: data,\n  };\n}\n"],"names":["getDocPage","REPO_ROOT","path","resolve","process","cwd","OVERRIDES_DIR","join","DEPLOYED_DIR","UPSTREAM_DIR","slugParts","slugPath","overridePath","fs","existsSync","loadFile","overrideIndexPath","deployedPath","upstreamContentDir","upstreamPath","upstreamIndexMd","upstreamIndexRst","filePath","slug","layer","fileContent","readFileSync","data","content","matter","title","split","pop","sourceLayer","meta"],"mappings":";;;;+BAqBsBA;;;eAAAA;;;2DArBP;6DACE;mEACE;;;;;;AAEnB,QAAQ;AACR,MAAMC,YAAYC,aAAI,CAACC,OAAO,CAACC,QAAQC,GAAG,IAAI,UAAU,kDAAkD;AAC1G,MAAMC,gBAAgBJ,aAAI,CAACK,IAAI,CAC7BH,QAAQC,GAAG,IACX;AAEF,MAAMG,eAAeN,aAAI,CAACK,IAAI,CAACH,QAAQC,GAAG,IAAI;AAC9C,MAAMI,eAAeP,aAAI,CAACC,OAAO,CAACF,WAAW;AAUtC,eAAeD,WAAWU,SAAmB;IAClD,MAAMC,WAAWD,UAAUH,IAAI,CAAC;IAEhC,wCAAwC;IACxC,8CAA8C;IAC9C,MAAMK,eAAeV,aAAI,CAACK,IAAI,CAACD,eAAe,GAAGK,SAAS,GAAG,CAAC;IAC9D,IAAIE,WAAE,CAACC,UAAU,CAACF,eAAe;QAC/B,OAAOG,SAASH,cAAcD,UAAU;IAC1C,OAAO;QACL,oCAAoC;QACpC,MAAMK,oBAAoBd,aAAI,CAACK,IAAI,CAACD,eAAeK,UAAU;QAC7D,IAAIE,WAAE,CAACC,UAAU,CAACE,oBAAoB;YACpC,OAAOD,SAASC,mBAAmBL,UAAU;QAC/C;IACF;IAEA,4CAA4C;IAC5C,8FAA8F;IAC9F,kEAAkE;IAClE,gFAAgF;IAChF,uEAAuE;IAEvE,gGAAgG;IAChG,kDAAkD;IAClD,MAAMM,eAAef,aAAI,CAACK,IAAI,CAACC,cAAc,GAAGG,SAAS,GAAG,CAAC;IAC7D,IAAIE,WAAE,CAACC,UAAU,CAACG,eAAe;QAC/B,OAAOF,SAASE,cAAcN,UAAU;IAC1C;IAEA,sCAAsC;IACtC,8FAA8F;IAC9F,MAAMO,qBAAqBhB,aAAI,CAACK,IAAI,CAACE,cAAc;IAEnD,iDAAiD;IACjD,IAAIU,eAAejB,aAAI,CAACK,IAAI,CAACW,oBAAoB,GAAGP,SAAS,GAAG,CAAC;IACjE,IAAIE,WAAE,CAACC,UAAU,CAACK,eAAe;QAC/B,OAAOJ,SAASI,cAAcR,UAAU;IAC1C;IAEA,gBAAgB;IAChBQ,eAAejB,aAAI,CAACK,IAAI,CAACW,oBAAoB,GAAGP,SAAS,IAAI,CAAC;IAC9D,IAAIE,WAAE,CAACC,UAAU,CAACK,eAAe;QAC/B,OAAOJ,SAASI,cAAcR,UAAU;IAC1C;IAEA,gCAAgC;IAChC,MAAMS,kBAAkBlB,aAAI,CAACK,IAAI,CAACW,oBAAoBP,UAAU;IAChE,IAAIE,WAAE,CAACC,UAAU,CAACM,kBAAkB;QAClC,OAAOL,SAASK,iBAAiBT,UAAU;IAC7C;IACA,MAAMU,mBAAmBnB,aAAI,CAACK,IAAI,CAACW,oBAAoBP,UAAU;IACjE,IAAIE,WAAE,CAACC,UAAU,CAACO,mBAAmB;QACnC,OAAON,SAASM,kBAAkBV,UAAU;IAC9C;IAEA,OAAO;AACT;AAEA,SAASI,SACPO,QAAgB,EAChBC,IAAY,EACZC,KAA2C;IAE3C,MAAMC,cAAcZ,WAAE,CAACa,YAAY,CAACJ,UAAU;IAC9C,MAAM,EAAEK,IAAI,EAAEC,OAAO,EAAE,GAAGC,IAAAA,mBAAM,EAACJ;IAEjC,OAAO;QACLF;QACAO,OAAOH,KAAKG,KAAK,IAAIP,KAAKQ,KAAK,CAAC,KAAKC,GAAG,MAAM;QAC9CJ;QACAK,aAAaT;QACbU,MAAMP;IACR;AACF"}
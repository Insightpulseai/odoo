# =============================================================================
# Lakehouse Pipeline Configuration
# =============================================================================
# Controls storage backend, Delta table locations, and Supabase mirroring.
#
# Backends:
#   supabase_only      - All data in Supabase PostgreSQL (simpler, lower scale)
#   delta_plus_supabase - Delta Lake for heavy ETL, mirror to Supabase for API
# =============================================================================

storage_backend: delta_plus_supabase  # supabase_only | delta_plus_supabase

delta:
  s3:
    endpoint: ${MINIO_ENDPOINT}          # e.g. http://minio:9000
    access_key: ${MINIO_ACCESS_KEY}
    secret_key: ${MINIO_SECRET_KEY}
    region: ${MINIO_REGION:-us-east-1}
    bucket: ${LAKEHOUSE_BUCKET:-lakehouse}
    path_style_access: true

  tables:
    bronze.raw_pages: s3://lakehouse/bronze/raw_pages/
    silver.normalized_docs: s3://lakehouse/silver/normalized_docs/
    gold.chunks: s3://lakehouse/gold/chunks/
    gold.embeddings: s3://lakehouse/gold/embeddings/

# Mirror Delta Gold tables to Supabase for fast API queries
mirror_to_supabase:
  enabled: true
  batch_size: 1000
  lookback_days: 7
  mappings:
    - from: gold.chunks
      to: rag.chunks
      mode: upsert
      key: chunk_id
    - from: gold.embeddings
      to: rag.embeddings
      mode: upsert
      key: embedding_id

# Trino connection for SQL queries over Delta
trino:
  host: ${TRINO_HOST:-trino}
  port: ${TRINO_PORT:-8080}
  user: ${TRINO_USER:-lakehouse}
  catalog: delta

# MLflow for experiment tracking
mlflow:
  tracking_uri: ${MLFLOW_TRACKING_URI:-http://mlflow:5000}
  experiment_prefix: lakehouse

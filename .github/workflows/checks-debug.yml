name: checks-debug

on:
  workflow_dispatch:
    inputs:
      sha:
        description: "Commit SHA to inspect"
        required: true

jobs:
  list-check-runs:
    runs-on: ubuntu-latest
    steps:
      - name: List check-runs for SHA
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: jgtolentino
          REPO: odoo-ce
          SHA: ${{ inputs.sha }}
        run: |
          curl -sS -H "Authorization: Bearer ${GH_TOKEN}" \
               -H "Accept: application/vnd.github+json" \
               "https://api.github.com/repos/${OWNER}/${REPO}/commits/${SHA}/check-runs" \
            | python - <<'PY'
          import json, sys

          data = json.load(sys.stdin)
          for run in data.get("check_runs", []):
            print(
              f'{run["name"]}\t{run["status"]}\t{run["conclusion"]}\t{run.get("details_url","")}'
            )
          PY

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================ -->
    <!-- Spectra CSV Export Templates -->
    <!-- ============================================ -->

    <!--
        Export Template Configuration

        These templates define the CSV format for exporting to Spectra.
        Each template specifies:
        - Export type (cash_advance, expense_report, journal_entry)
        - CSV column headers
        - Data mapping rules
        - Tax calculation methods

        Templates are used by tbwa.spectra.export.action_export_csv()
        method to generate CSV files for import into Spectra.
    -->

    <!-- Cash Advance Export Template -->
    <record id="export_template_cash_advance" model="tbwa.spectra.export">
        <field name="name">Cash Advance Export Template</field>
        <field name="export_type">cash_advance</field>
        <field name="state">draft</field>
        <field name="period_start" eval="(datetime.now().replace(day=1)).strftime('%Y-%m-%d')"/>
        <field name="period_end" eval="datetime.now().strftime('%Y-%m-%d')"/>
    </record>

    <!-- Expense Report Export Template -->
    <record id="export_template_expense_report" model="tbwa.spectra.export">
        <field name="name">Expense Report Export Template</field>
        <field name="export_type">expense_report</field>
        <field name="state">draft</field>
        <field name="period_start" eval="(datetime.now().replace(day=1)).strftime('%Y-%m-%d')"/>
        <field name="period_end" eval="datetime.now().strftime('%Y-%m-%d')"/>
    </record>

    <!-- Journal Entry Export Template -->
    <record id="export_template_journal_entry" model="tbwa.spectra.export">
        <field name="name">Journal Entry Export Template</field>
        <field name="export_type">journal_entry</field>
        <field name="state">draft</field>
        <field name="period_start" eval="(datetime.now().replace(day=1)).strftime('%Y-%m-%d')"/>
        <field name="period_end" eval="datetime.now().strftime('%Y-%m-%d')"/>
    </record>

    <!-- ============================================ -->
    <!-- CSV Column Definitions (Documentation) -->
    <!-- ============================================ -->

    <!--
        Cash Advance CSV Format:
        =========================
        Column 1: Reference Number (CA-YYYY-MM-NNNN)
        Column 2: Employee Code
        Column 3: Employee Name
        Column 4: Request Date (YYYY-MM-DD)
        Column 5: Approval Date (YYYY-MM-DD)
        Column 6: Payment Date (YYYY-MM-DD)
        Column 7: Amount (Decimal, 2 places)
        Column 8: Currency Code (PHP, USD)
        Column 9: Purpose/Description
        Column 10: GL Account Code (from mapping)
        Column 11: Cost Center/Department
        Column 12: Status (approved_l2, paid, liquidating, done)
        Column 13: Liquidation Deadline (YYYY-MM-DD)
        Column 14: Is Liquidated (True/False)

        Example:
        CA-2025-01-0001,EMP001,Juan Dela Cruz,2025-01-15,2025-01-16,2025-01-17,5000.00,PHP,Client meeting expenses,5030,Marketing,paid,2025-01-24,False

        Expense Report CSV Format:
        ===========================
        Column 1: Expense Report Number (ER-YYYY-MM-NNNN)
        Column 2: Employee Code
        Column 3: Employee Name
        Column 4: Report Date (YYYY-MM-DD)
        Column 5: Approval Date (YYYY-MM-DD)
        Column 6: Total Amount (Decimal, 2 places)
        Column 7: Currency Code
        Column 8: Number of Receipts
        Column 9: Department
        Column 10: Status
        Column 11: VAT Amount (Decimal, 2 places)
        Column 12: Withholding Tax Amount (Decimal, 2 places)
        Column 13: Net Payable (Decimal, 2 places)

        Expense Report Line Items:
        - Each line item follows same format with parent report reference
        - GL Account mapping applied per line item
        - VAT and withholding tax calculated per line

        Journal Entry CSV Format:
        ==========================
        Column 1: Entry Number (JE-YYYY-MM-NNNN)
        Column 2: Entry Date (YYYY-MM-DD)
        Column 3: GL Account Code
        Column 4: Account Name
        Column 5: Debit Amount (Decimal, 2 places)
        Column 6: Credit Amount (Decimal, 2 places)
        Column 7: Currency Code
        Column 8: Description/Memo
        Column 9: Cost Center/Department
        Column 10: Reference Document
        Column 11: Tax Code (VAT/WHT if applicable)
        Column 12: Tax Amount (Decimal, 2 places)
    -->

    <!-- ============================================ -->
    <!-- Tax Calculation Notes -->
    <!-- ============================================ -->

    <!--
        Philippine VAT Calculation:
        ===========================
        - Standard rate: 12%
        - VAT-inclusive amount: Amount / 1.12
        - VAT amount: (Amount / 1.12) * 0.12
        - Net amount: Amount - VAT amount

        Example: ₱5,600 gross
        - Net: ₱5,600 / 1.12 = ₱5,000
        - VAT: ₱5,000 * 0.12 = ₱600

        Withholding Tax Calculation:
        =============================
        Professional Fees (WC140):
        - Rate: 10% of gross amount
        - Example: ₱50,000 * 0.10 = ₱5,000 WHT
        - Net payable: ₱50,000 - ₱5,000 = ₱45,000

        Rent (WC150):
        - Rate: 5% of gross amount
        - Example: ₱100,000 * 0.05 = ₱5,000 WHT
        - Net payable: ₱100,000 - ₱5,000 = ₱95,000

        Combined VAT + Withholding:
        ===========================
        For VAT-inclusive amounts with withholding tax:
        1. Extract VAT: Amount / 1.12
        2. Calculate net: Amount - VAT
        3. Calculate WHT: Net * WHT rate
        4. Net payable: Net - WHT

        Example: ₱56,000 professional fee (VAT-inclusive)
        - Gross: ₱56,000
        - VAT: (₱56,000 / 1.12) * 0.12 = ₱6,000
        - Net: ₱56,000 - ₱6,000 = ₱50,000
        - WHT: ₱50,000 * 0.10 = ₱5,000
        - Net payable: ₱50,000 - ₱5,000 = ₱45,000
    -->

</odoo>

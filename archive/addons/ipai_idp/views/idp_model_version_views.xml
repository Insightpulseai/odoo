<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- IDP Model Version List View -->
    <record id="view_idp_model_version_list" model="ir.ui.view">
        <field name="name">idp.model.version.list</field>
        <field name="model">idp.model.version</field>
        <field name="arch" type="xml">
            <list string="Model Versions" decoration-muted="not active" decoration-info="is_default">
                <field name="name"/>
                <field name="version_code"/>
                <field name="doc_type"/>
                <field name="llm_model"/>
                <field name="is_default" widget="boolean"/>
                <field name="usage_count"/>
                <field name="success_rate" widget="progressbar"/>
                <field name="avg_confidence" widget="progressbar"/>
                <field name="active" widget="boolean"/>
            </list>
        </field>
    </record>

    <!-- IDP Model Version Form View -->
    <record id="view_idp_model_version_form" model="ir.ui.view">
        <field name="name">idp.model.version.form</field>
        <field name="model">idp.model.version</field>
        <field name="arch" type="xml">
            <form string="Model Version">
                <header>
                    <button name="action_set_as_default" type="object" string="Set as Default" class="btn-primary" invisible="is_default"/>
                    <field name="active" widget="boolean_button" options='{"terminology": "active"}'/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Version Name"/>
                        </h1>
                        <h4>
                            <field name="version_code"/>
                        </h4>
                    </div>
                    <group>
                        <group string="Configuration">
                            <field name="doc_type"/>
                            <field name="llm_model"/>
                            <field name="temperature"/>
                            <field name="max_tokens"/>
                            <field name="is_default"/>
                        </group>
                        <group string="Statistics">
                            <field name="usage_count"/>
                            <field name="success_rate" widget="progressbar"/>
                            <field name="avg_confidence" widget="progressbar"/>
                        </group>
                    </group>
                    <group string="Description">
                        <field name="description" nolabel="1" placeholder="What changed in this version..."/>
                    </group>
                    <notebook>
                        <page string="System Prompt" name="system">
                            <field name="system_prompt" widget="ace" options="{'mode': 'text'}"/>
                        </page>
                        <page string="Extraction Prompt" name="extraction">
                            <field name="extraction_prompt_template" widget="ace" options="{'mode': 'text'}"/>
                        </page>
                        <page string="Schema" name="schema">
                            <field name="extraction_schema" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Post-processing" name="postprocess">
                            <field name="postprocessing_rules" widget="ace" options="{'mode': 'json'}"/>
                        </page>
                        <page string="Validation Rules" name="validation">
                            <field name="validation_rule_ids" widget="many2many_tags"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- IDP Model Version Search View -->
    <record id="view_idp_model_version_search" model="ir.ui.view">
        <field name="name">idp.model.version.search</field>
        <field name="model">idp.model.version</field>
        <field name="arch" type="xml">
            <search string="Search Model Versions">
                <field name="name"/>
                <field name="version_code"/>
                <filter string="Active" name="filter_active" domain="[('active', '=', True)]"/>
                <filter string="Default" name="filter_default" domain="[('is_default', '=', True)]"/>
                <group expand="0" string="Group By">
                    <filter string="Document Type" name="group_doc_type" context="{'group_by': 'doc_type'}"/>
                    <filter string="LLM Model" name="group_llm" context="{'group_by': 'llm_model'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- IDP Model Version Action -->
    <record id="action_idp_model_version" model="ir.actions.act_window">
        <field name="name">Model Versions</field>
        <field name="res_model">idp.model.version</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_idp_model_version_search"/>
        <field name="context">{'search_default_filter_active': 1}</field>
    </record>

    <!-- IDP Validation Rule List View -->
    <record id="view_idp_validation_rule_list" model="ir.ui.view">
        <field name="name">idp.validation.rule.list</field>
        <field name="model">idp.validation.rule</field>
        <field name="arch" type="xml">
            <list string="Validation Rules" decoration-muted="not active">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="doc_type"/>
                <field name="rule_type"/>
                <field name="field_name"/>
                <field name="severity" widget="badge" decoration-danger="severity == 'error'" decoration-warning="severity == 'warning'" decoration-info="severity == 'info'"/>
                <field name="active" widget="boolean"/>
            </list>
        </field>
    </record>

    <!-- IDP Validation Rule Form View -->
    <record id="view_idp_validation_rule_form" model="ir.ui.view">
        <field name="name">idp.validation.rule.form</field>
        <field name="model">idp.validation.rule</field>
        <field name="arch" type="xml">
            <form string="Validation Rule">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="doc_type"/>
                            <field name="rule_type"/>
                            <field name="severity"/>
                            <field name="sequence"/>
                            <field name="active"/>
                        </group>
                        <group>
                            <field name="field_name" invisible="rule_type in ('sum_check', 'date_order', 'custom')"/>
                            <field name="regex_pattern" invisible="rule_type != 'format'"/>
                            <field name="min_value" invisible="rule_type != 'range'"/>
                            <field name="max_value" invisible="rule_type != 'range'"/>
                            <field name="allowed_values" invisible="rule_type != 'in_list'"/>
                        </group>
                    </group>
                    <group string="Sum Check" invisible="rule_type != 'sum_check'">
                        <field name="sum_fields"/>
                        <field name="total_field"/>
                    </group>
                    <group string="Date Comparison" invisible="rule_type != 'date_order'">
                        <field name="date_field_1"/>
                        <field name="date_field_2"/>
                        <field name="date_comparison"/>
                    </group>
                    <group string="Custom Expression" invisible="rule_type != 'custom'">
                        <field name="custom_expression" widget="ace" options="{'mode': 'python'}"/>
                    </group>
                    <group string="Error Message">
                        <field name="error_message"/>
                    </group>
                    <group string="Description">
                        <field name="description" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- IDP Validation Rule Action -->
    <record id="action_idp_validation_rule" model="ir.actions.act_window">
        <field name="name">Validation Rules</field>
        <field name="res_model">idp.validation.rule</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_filter_active': 1}</field>
    </record>
</odoo>

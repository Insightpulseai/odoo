# OCA Module Directory Structure

Sources:
- https://github.com/OCA/maintainer-tools/tree/master/template/module
- https://www.odoo.com/documentation/18.0/contributing/development/coding_guidelines.html

---

## Complete Directory Structure

```
MODULE_NAME/
|-- __init__.py                     # REQUIRED
|-- __manifest__.py                 # REQUIRED - module metadata
|
|-- readme/                         # Documentation fragments (oca-gen-addon-readme)
|   |-- DESCRIPTION.rst             # REQUIRED
|   |-- USAGE.rst                   # Highly recommended
|   |-- CONTRIBUTORS.rst            # Highly recommended
|   |-- INSTALL.rst                 # Optional
|   |-- CONFIGURE.rst               # Optional
|   |-- ROADMAP.rst                 # Optional
|   |-- HISTORY.rst                 # Optional (auto-generated by towncrier)
|   |-- CREDITS.rst                 # Optional (financing acknowledgments)
|   `-- newsfragments/              # Optional (towncrier fragments)
|
|-- models/                         # Python model classes
|   |-- __init__.py
|   |-- model_name.py               # One file per model (or logical group)
|   `-- res_partner.py              # Inherited models named after original
|
|-- views/                          # XML view definitions
|   |-- model_name_views.xml        # Form, tree/list, kanban views
|   |-- model_name_menus.xml        # Menu items (if many, separate file)
|   `-- model_name_templates.xml    # QWeb templates (portal/website)
|
|-- security/                       # Access control
|   |-- ir.model.access.csv         # REQUIRED if new models
|   |-- model_name_security.xml     # Record rules
|   `-- module_groups.xml           # Custom groups definition
|
|-- data/                           # Data files (loaded at install)
|   |-- model_name_data.xml         # Master data, sequences, mail templates
|   `-- module_name_demo.xml        # Demo data (loaded in demo mode only)
|
|-- wizard/                         # Transient models / wizards
|   |-- __init__.py
|   |-- wizard_name.py
|   `-- wizard_name_views.xml
|
|-- report/                         # Reports and templates
|   |-- __init__.py
|   |-- model_report.py             # Report model (AbstractModel)
|   |-- model_report_views.xml      # Report QWeb template
|   `-- model_reports.xml           # Report actions and paper formats
|
|-- controllers/                    # HTTP controllers (portal/website)
|   |-- __init__.py
|   `-- module_name.py
|
|-- tests/                          # Test suite
|   |-- __init__.py
|   |-- test_model_name.py          # One test file per model
|   `-- test_common.py              # Shared test fixtures
|
|-- static/                         # Frontend assets (NOT served by Python)
|   |-- description/
|   |   |-- icon.png                # Module icon: 128x128px
|   |   `-- index.html              # Screenshot/description for app store (optional)
|   |-- src/
|   |   |-- js/                     # JavaScript files
|   |   |-- scss/                   # SCSS/CSS files
|   |   `-- xml/                    # OWL/QWeb component templates
|   `-- img/                        # Images used in views (not icon)
|
|-- migrations/                     # ONLY if database migration needed
|   `-- {VERSION}/
|       |-- pre-migration.py        # Runs BEFORE Odoo migration
|       `-- post-migration.py       # Runs AFTER Odoo migration
|
`-- README.rst                      # AUTO-GENERATED by oca-gen-addon-readme
```

---

## ir.model.access.csv Format

```csv
id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
access_model_name_user,model.name user,model_model_name,base.group_user,1,0,0,0
access_model_name_manager,model.name manager,model_model_name,base.group_system,1,1,1,1
```

**Column descriptions**:
- `id`: External ID (must be unique, no dots)
- `name`: Human-readable description
- `model_id:id`: External ID of the model (format: `model_module_name`)
- `group_id:id`: External ID of user group (empty = all users)
- `perm_read/write/create/unlink`: 1=allowed, 0=denied

---

## File Naming Conventions

| File type | Naming pattern | Example |
|-----------|---------------|---------|
| Python models | `model_name.py` | `account_move.py` |
| Inherited models | Based on original module | `res_partner.py` |
| Views | `model_name_views.xml` | `account_move_views.xml` |
| Menu items | `model_name_menus.xml` | `account_menus.xml` |
| Templates | `model_name_templates.xml` | `account_templates.xml` |
| Security | `ir.model.access.csv` | (fixed name) |
| Groups | `module_groups.xml` | `account_groups.xml` |
| Data | `model_name_data.xml` | `account_move_data.xml` |
| Reports | `model_name_report.xml` | `account_move_report.xml` |
| Tests | `test_model_name.py` | `test_account_move.py` |

---

## views/ Split Guidelines

- Backend views (form, tree, kanban, search): `model_name_views.xml`
- Main menus NOT linked to specific actions: `module_name_menus.xml`
- QWeb pages for portal/website: `model_name_templates.xml`
- Report templates: `model_name_report_templates.xml`
- When many views: one file per model

---

## Static Asset Guidelines

- `static/description/icon.png`: Module icon, 128x128px (required for OCA App Store)
- `static/src/js/`: ES6+ JavaScript modules
- `static/src/scss/`: SCSS stylesheets
- `static/src/xml/`: OWL component templates and QWeb templates

Never put sensitive data in `static/` â€” it's publicly accessible without authentication.

---

## Migration Scripts (When Needed)

Only create `migrations/` when you need to transform existing database data:

```python
# migrations/19.0.1.0.0/pre-migration.py
import logging

_logger = logging.getLogger(__name__)

def migrate(cr, version):
    """Run BEFORE Odoo applies schema changes"""
    if not version:
        return
    _logger.info("Running pre-migration for module_name %s", version)
    cr.execute("UPDATE module_table SET new_col = old_col WHERE new_col IS NULL")

# migrations/19.0.1.0.0/post-migration.py
def migrate(cr, version):
    """Run AFTER Odoo applies schema changes"""
    if not version:
        return
    # Safe to use new schema here
```

**Rule**: Remove `migrations/` folder when porting to a new major version unless
the port itself introduces schema changes that need data transformation.

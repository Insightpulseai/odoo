version: 0.1
strict_evidence: false
probes:
  ci_build_pipeline:
    workflow_globs:
    - .github/workflows/*.yml
    - .github/workflows/*.yaml
    any_workflow_must_contain_regex:
    - (?i)pnpm\s+install|yarn\s+install|npm\s+ci
    - (?i)odoo-bin|odoo\s+bin|addons_path
    - (?i)docker\s+build|docker-compose|buildx
    preferred_workflow_name_regex:
    - (?i)build|ci|test|deploy|health|smoke
  env_separation:
    any_file_must_exist:
    - docs/architecture/PROD_RUNTIME_SNAPSHOT.md
    - docs/architecture/runtime_identifiers.json
    any_path_must_match_glob:
    - scripts/*stage*
    - scripts/*prod*
    - scripts/**/*deploy*
    - .github/workflows/*deploy*
    any_file_must_contain_regex:
    - (?i)odoo_stage|stage\.insightpulseai\.com|staging
    - (?i)prod|production|erp\.insightpulseai\.com
  remote_shell_access:
    any_path_must_match_glob:
    - scripts/**/ssh*.sh
    - scripts/**/tunnel*.sh
    - scripts/**/remote*.sh
    any_file_must_contain_regex:
    - (?i)ssh\s+.*@|ProxyJump|IdentityFile
    - (?i)docker\s+exec|kubectl\s+exec
  upgrade_rehearsal:
    any_path_must_match_glob:
    - scripts/**/*upgrade*
    - scripts/**/*migration*
    - docs/**/*upgrade*
    - docs/**/*migration*
    evidence_globs:
    - docs/evidence/**/upgrade*/*
    - docs/evidence/**/migration*/*
  upgrade_report:
    report_globs:
    - docs/evidence/**/upgrade*/**/*.json
    - docs/evidence/**/migration*/**/*.json
    - docs/evidence/**/upgrade*/**/*.md
    - docs/evidence/**/migration*/**/*.md
  upgrade_rollback_plan:
    any_path_must_match_glob:
    - docs/**/*rollback*
    - scripts/**/*rollback*
    any_file_must_contain_regex:
    - (?i)restore|snapshot|promote|rollback
  support_workflow:
    any_path_must_match_glob:
    - docs/**/*runbook*
    - docs/**/*support*
    - docs/**/*incident*
    - docs/**/*postmortem*
    any_file_must_contain_regex:
    - (?i)intake|triage|severity|sev|postmortem|rca
  runbooks_present:
    runbook_globs:
    - docs/**/*RUNBOOK*.md
    - docs/**/*runbook*.md
    - docs/**/*incident*.md
    min_count: 2
  sla_monitoring:
    any_path_must_match_glob:
    - .github/workflows/*health*
    - .github/workflows/*smoke*
    - scripts/**/*health*
    - scripts/**/*smoke*
    any_file_must_contain_regex:
    - (?i)curl\s+-sS|health|healthz|/api/.*health

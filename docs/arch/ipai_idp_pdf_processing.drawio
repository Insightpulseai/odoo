<mxfile host="app.diagrams.net" modified="2024-12-06T00:00:00.000Z" agent="Claude" version="21.0.0">
  <diagram name="IPAI IDP - PDF Processing Flow" id="ipai-pdf-flow">
    <mxGraphModel dx="1422" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="700" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="IPAI IDP – Automated PDF Invoice &amp; Receipt Processing" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#0078D4;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="40" as="geometry" />
        </mxCell>

        <!-- Step Numbers -->
        <mxCell id="step1-num" value="1" style="ellipse;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#0078D4;fontColor=#FFFFFF;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="70" y="75" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="step2-num" value="2" style="ellipse;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#0078D4;fontColor=#FFFFFF;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="260" y="75" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="step3-num" value="3" style="ellipse;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#0078D4;fontColor=#FFFFFF;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="460" y="75" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="step4-num" value="4" style="ellipse;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#0078D4;fontColor=#FFFFFF;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="660" y="75" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="step5-num" value="5" style="ellipse;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#0078D4;fontColor=#FFFFFF;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="860" y="75" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="step6-num" value="6" style="ellipse;whiteSpace=wrap;html=1;fillColor=#0078D4;strokeColor=#0078D4;fontColor=#FFFFFF;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1060" y="75" width="30" height="30" as="geometry" />
        </mxCell>

        <!-- Step Labels -->
        <mxCell id="step1-label" value="PDF Ingestion" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="110" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="step2-label" value="Document Creation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="215" y="110" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="step3-label" value="OCR Extraction" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="425" y="110" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="step4-label" value="LLM Extraction" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="625" y="110" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="step5-label" value="Validation &amp; Routing" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="815" y="110" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="step6-label" value="Export" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1040" y="110" width="70" height="20" as="geometry" />
        </mxCell>

        <!-- Step 1: PDF Ingestion -->
        <mxCell id="pdf-invoice" value="PDF Invoice" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#FFE6CC;strokeColor=#D79B00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="145" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="pdf-receipt" value="PDF Receipt" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#FFE6CC;strokeColor=#D79B00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="205" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="pdf-po" value="PDF PO" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#FFE6CC;strokeColor=#D79B00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="265" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="ingest-sources" value="Sources:&#xa;• Email (fetchmail)&#xa;• Upload (UI)&#xa;• API (/documents)&#xa;• Mobile capture" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#FFA000;fontSize=9;align=left;spacingLeft=5;" vertex="1" parent="1">
          <mxGeometry x="30" y="330" width="110" height="80" as="geometry" />
        </mxCell>

        <!-- Step 2: Document Creation -->
        <mxCell id="idp-doc" value="idp.document&#xa;&#xa;status: queued&#xa;source: email/api/upload&#xa;doc_type: unknown" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=10;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="210" y="145" width="140" height="90" as="geometry" />
        </mxCell>

        <mxCell id="hash-check" value="SHA256 hash check&#xa;(deduplication)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#388E3C;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="210" y="250" width="140" height="40" as="geometry" />
        </mxCell>

        <mxCell id="attachment" value="ir.attachment&#xa;(file storage)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="235" y="305" width="90" height="50" as="geometry" />
        </mxCell>

        <!-- Step 3: OCR Extraction -->
        <mxCell id="ocr-service" value="idp.service.ocr&#xa;&#xa;Providers:&#xa;• InsightPulse&#xa;• Google Vision&#xa;• Azure Form Rec&#xa;• Tesseract" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=10;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="410" y="145" width="130" height="110" as="geometry" />
        </mxCell>

        <mxCell id="ocr-result" value="idp.document.ocr&#xa;&#xa;raw_text: &quot;...&quot;&#xa;confidence: 0.95&#xa;bounding_boxes: [...]" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#E3F2FD;strokeColor=#1976D2;fontSize=9;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="410" y="270" width="130" height="85" as="geometry" />
        </mxCell>

        <!-- Step 4: LLM Extraction -->
        <mxCell id="llm-service" value="idp.service.extractor&#xa;&#xa;Models:&#xa;• Claude 3 Sonnet&#xa;• GPT-4o&#xa;&#xa;Versioned prompts&#xa;JSON schema output" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=10;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="610" y="145" width="130" height="120" as="geometry" />
        </mxCell>

        <mxCell id="extraction-result" value="idp.extraction&#xa;&#xa;{&#xa;  vendor: &quot;...&quot;,&#xa;  total: 1234.56,&#xa;  date: &quot;2024-12-06&quot;&#xa;}&#xa;confidence: 0.92" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#FFF3E0;strokeColor=#F57C00;fontSize=9;align=left;spacingLeft=10;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="600" y="280" width="150" height="110" as="geometry" />
        </mxCell>

        <!-- Step 5: Validation & Routing -->
        <mxCell id="validator" value="idp.service.validator&#xa;&#xa;Rules:&#xa;• Required fields&#xa;• Format checks&#xa;• Range validation&#xa;• Sum checks&#xa;• Custom expressions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#C62828;fontSize=10;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="145" width="130" height="130" as="geometry" />
        </mxCell>

        <mxCell id="decision" value="" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;" vertex="1" parent="1">
          <mxGeometry x="850" y="295" width="50" height="50" as="geometry" />
        </mxCell>
        <mxCell id="decision-label" value="conf ≥ 90%&#xa;&amp; valid?" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="835" y="350" width="80" height="30" as="geometry" />
        </mxCell>

        <mxCell id="approved-box" value="status: approved" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="920" y="305" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="review-box" value="status: review_needed&#xa;&#xa;idp.review created" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="810" y="400" width="130" height="55" as="geometry" />
        </mxCell>

        <!-- Decision arrows -->
        <mxCell id="arrow-yes" value="Yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#388E3C;fontStyle=1;fontSize=9;" edge="1" parent="1" source="decision" target="approved-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-no" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#C62828;fontStyle=1;fontSize=9;" edge="1" parent="1" source="decision" target="review-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Human Review -->
        <mxCell id="human-review" value="Human Review&#xa;(Corrections)" style="shape=actor;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="820" y="475" width="60" height="60" as="geometry" />
        </mxCell>

        <mxCell id="arrow-review-approve" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#7B1FA2;dashed=1;" edge="1" parent="1" source="human-review" target="approved-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="970" y="505" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Step 6: Export -->
        <mxCell id="export-invoice" value="account.move&#xa;(Vendor Bill)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="145" width="110" height="45" as="geometry" />
        </mxCell>
        <mxCell id="export-expense" value="hr.expense&#xa;(Expense)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="200" width="110" height="45" as="geometry" />
        </mxCell>
        <mxCell id="export-po" value="purchase.order&#xa;(PO Match)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="255" width="110" height="45" as="geometry" />
        </mxCell>

        <mxCell id="export-analytics" value="Analytics&#xa;(Superset / Power BI)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1C4E9;strokeColor=#512DA8;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="320" width="110" height="45" as="geometry" />
        </mxCell>

        <mxCell id="export-status" value="status: exported&#xa;exported_at: timestamp" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="1035" y="380" width="120" height="35" as="geometry" />
        </mxCell>

        <!-- Flow Arrows (main pipeline) -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="140" y="200" as="sourcePoint" />
            <mxPoint x="210" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="350" y="200" as="sourcePoint" />
            <mxPoint x="410" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="540" y="200" as="sourcePoint" />
            <mxPoint x="610" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="740" y="200" as="sourcePoint" />
            <mxPoint x="810" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="flow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1020" y="320" as="sourcePoint" />
            <mxPoint x="1040" y="220" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1020" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#9E9E9E;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="560" width="580" height="80" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="565" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="leg-doc" value="Document" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#FFE6CC;strokeColor=#D79B00;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="50" y="590" width="60" height="35" as="geometry" />
        </mxCell>
        <mxCell id="leg-model" value="Odoo Model" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="120" y="595" width="70" height="25" as="geometry" />
        </mxCell>
        <mxCell id="leg-service" value="Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="200" y="595" width="60" height="25" as="geometry" />
        </mxCell>
        <mxCell id="leg-store" value="Data Store" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=5;fillColor=#FFF3E0;strokeColor=#F57C00;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="270" y="590" width="60" height="35" as="geometry" />
        </mxCell>
        <mxCell id="leg-decision" value="Decision" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="340" y="590" width="50" height="35" as="geometry" />
        </mxCell>
        <mxCell id="leg-output" value="Output" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="400" y="595" width="60" height="25" as="geometry" />
        </mxCell>
        <mxCell id="leg-human" value="Human" style="shape=actor;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="470" y="585" width="35" height="40" as="geometry" />
        </mxCell>

        <mxCell id="leg-note" value="Adapted from Azure 'Automate PDF forms processing' reference" style="text;html=1;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="520" y="595" width="90" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

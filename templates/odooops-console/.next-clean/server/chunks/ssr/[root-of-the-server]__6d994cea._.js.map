{"version":3,"sources":["../../../../../../../../../../Documents/GitHub/Insightpulseai/odoo/templates/odooops-console/app/%28app%29/projects/%5BprojectId%5D/branches/page.tsx"],"sourcesContent":["import { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport Link from \"next/link\";\n\ninterface Branch {\n  id: string;\n  name: string;\n  stage: \"production\" | \"staging\" | \"development\";\n  status: string;\n  last_build_status: string | null;\n  last_build_at: string | null;\n  git_ref: string | null;\n  last_build_id: string | null;\n  build_count: number;\n}\n\nfunction formatRelativeTime(date: string | null): string {\n  if (!date) return \"Never\";\n  const ms = Date.now() - new Date(date).getTime();\n  const minutes = Math.floor(ms / 60000);\n  const hours = Math.floor(ms / 3600000);\n  const days = Math.floor(ms / 86400000);\n\n  if (days > 0) return `${days}d ago`;\n  if (hours > 0) return `${hours}h ago`;\n  if (minutes > 0) return `${minutes}m ago`;\n  return \"Just now\";\n}\n\nfunction getBranchStatus(branch: Branch): \"healthy\" | \"building\" | \"failed\" | \"unknown\" {\n  if (branch.status === \"building\") return \"building\";\n  if (branch.status === \"error\") return \"failed\";\n\n  switch (branch.last_build_status) {\n    case \"success\":\n      return \"healthy\";\n    case \"running\":\n      return \"building\";\n    case \"failed\":\n      return \"failed\";\n    default:\n      return \"unknown\";\n  }\n}\n\nexport default async function BranchesPage({\n  params,\n}: {\n  params: Promise<{ projectId: string }>;\n}) {\n  const { projectId } = await params;\n\n  const supabase = await createSupabaseServerClient();\n\n  const { data: branches, error } = await supabase.rpc(\"ops.project_branches\", {\n    p_project_id: projectId,\n  });\n\n  if (error) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"rounded-md bg-red-50 p-4\">\n          <h3 className=\"text-sm font-medium text-red-800\">Error loading branches</h3>\n          <p className=\"mt-2 text-sm text-red-700\">{error.message}</p>\n        </div>\n      </div>\n    );\n  }\n\n  const productionBranches = (branches || []).filter((b: Branch) => b.stage === \"production\");\n  const stagingBranches = (branches || []).filter((b: Branch) => b.stage === \"staging\");\n  const developmentBranches = (branches || []).filter((b: Branch) => b.stage === \"development\");\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold\">Branches</h1>\n        <p className=\"text-sm text-gray-600 mt-1\">\n          3-stage deployment pipeline: Production → Staging → Development\n        </p>\n      </div>\n\n      {/* 3-Lane Deployment Pipeline */}\n      <div className=\"grid grid-cols-3 gap-6\">\n        {/* Production Lane */}\n        <div>\n          <div className=\"mb-4\">\n            <h2 className=\"text-lg font-semibold\">Production</h2>\n            <p className=\"text-xs text-gray-500\">Live environment</p>\n          </div>\n          <div className=\"space-y-3\">\n            {productionBranches.map((branch: Branch) => (\n              <BranchCard\n                key={branch.id}\n                branch={branch}\n                projectId={projectId}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Staging Lane */}\n        <div>\n          <div className=\"mb-4\">\n            <h2 className=\"text-lg font-semibold\">Staging</h2>\n            <p className=\"text-xs text-gray-500\">Pre-production testing</p>\n          </div>\n          <div className=\"space-y-3\">\n            {stagingBranches.map((branch: Branch) => (\n              <BranchCard\n                key={branch.id}\n                branch={branch}\n                projectId={projectId}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Development Lane */}\n        <div>\n          <div className=\"mb-4\">\n            <h2 className=\"text-lg font-semibold\">Development</h2>\n            <p className=\"text-xs text-gray-500\">Feature branches</p>\n          </div>\n          <div className=\"space-y-3\">\n            {developmentBranches.map((branch: Branch) => (\n              <BranchCard\n                key={branch.id}\n                branch={branch}\n                projectId={projectId}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction BranchCard({\n  branch,\n  projectId,\n}: {\n  branch: Branch;\n  projectId: string;\n}) {\n  const status = getBranchStatus(branch);\n\n  const statusColors = {\n    healthy: \"bg-green-100 text-green-800\",\n    building: \"bg-yellow-100 text-yellow-800\",\n    failed: \"bg-red-100 text-red-800\",\n    unknown: \"bg-gray-100 text-gray-800\",\n  };\n\n  const content = (\n    <div className=\"rounded-lg border border-gray-200 bg-white p-4 hover:border-gray-300 transition\">\n      <div className=\"flex items-start justify-between mb-2\">\n        <h3 className=\"font-semibold text-sm truncate flex-1\">{branch.name}</h3>\n        <span className={`rounded-full px-2 py-0.5 text-xs ${statusColors[status]}`}>\n          {status}\n        </span>\n      </div>\n      <div className=\"space-y-1 text-xs text-gray-600\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-gray-500\">Builds</span>\n          <span>{branch.build_count || 0}</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-gray-500\">Last deploy</span>\n          <span>{formatRelativeTime(branch.last_build_at)}</span>\n        </div>\n      </div>\n    </div>\n  );\n\n  // If last build exists, make clickable to build detail\n  if (branch.last_build_id) {\n    return (\n      <Link href={`/app/projects/${projectId}/builds/${branch.last_build_id}/logs`}>\n        {content}\n      </Link>\n    );\n  }\n\n  return <div>{content}</div>;\n}\n"],"names":[],"mappings":"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"}
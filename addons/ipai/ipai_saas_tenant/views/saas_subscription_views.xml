<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- SaaS Subscription Form View -->
    <record id="view_saas_subscription_form" model="ir.ui.view">
        <field name="name">saas.subscription.form</field>
        <field name="model">saas.subscription</field>
        <field name="arch" type="xml">
            <form string="SaaS Subscription">
                <header>
                    <button name="action_activate" type="object"
                            string="Activate" class="btn-primary"
                            invisible="status != 'draft'"/>
                    <button name="action_suspend" type="object"
                            string="Suspend" class="btn-warning"
                            invisible="status != 'active'"/>
                    <button name="action_reactivate" type="object"
                            string="Reactivate" class="btn-success"
                            invisible="status != 'suspended'"/>
                    <button name="action_cancel" type="object"
                            string="Cancel" class="btn-danger"
                            invisible="status not in ('active', 'suspended')"/>
                    <field name="status" widget="statusbar"
                           statusbar_visible="draft,active,suspended,cancelled"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="In Trial" bg_color="bg-info"
                            invisible="not is_trial"/>
                    <widget name="web_ribbon" title="Cancelled" bg_color="bg-danger"
                            invisible="status != 'cancelled'"/>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Parties">
                            <field name="tenant_account_id"/>
                            <field name="provider_account_id"/>
                        </group>
                        <group string="Service">
                            <field name="service_id"/>
                            <field name="plan_id" domain="[('service_id', '=', service_id)]"/>
                        </group>
                    </group>
                    <group>
                        <group string="Lifecycle">
                            <field name="started_at"/>
                            <field name="trial_ends_at"/>
                            <field name="next_billing_at"/>
                            <field name="ended_at"/>
                            <field name="cancelled_at" invisible="status != 'cancelled'"/>
                        </group>
                        <group string="Billing">
                            <field name="external_ref"/>
                            <field name="supabase_id" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <group string="Status">
                            <field name="is_trial" readonly="1"/>
                            <field name="days_remaining" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Billing Metadata" name="billing">
                            <field name="billing_metadata"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- SaaS Subscription List View -->
    <record id="view_saas_subscription_list" model="ir.ui.view">
        <field name="name">saas.subscription.list</field>
        <field name="model">saas.subscription</field>
        <field name="arch" type="xml">
            <list string="Subscriptions"
                  decoration-success="status == 'active'"
                  decoration-warning="status == 'suspended'"
                  decoration-danger="status == 'cancelled'"
                  decoration-muted="status == 'draft'">
                <field name="name"/>
                <field name="tenant_account_id"/>
                <field name="service_id"/>
                <field name="plan_id"/>
                <field name="status"/>
                <field name="started_at"/>
                <field name="next_billing_at"/>
                <field name="is_trial"/>
            </list>
        </field>
    </record>

    <!-- SaaS Subscription Search View -->
    <record id="view_saas_subscription_search" model="ir.ui.view">
        <field name="name">saas.subscription.search</field>
        <field name="model">saas.subscription</field>
        <field name="arch" type="xml">
            <search string="Search Subscriptions">
                <field name="name"/>
                <field name="tenant_account_id"/>
                <field name="provider_account_id"/>
                <field name="service_id"/>
                <separator/>
                <filter name="filter_draft" string="Draft"
                        domain="[('status', '=', 'draft')]"/>
                <filter name="filter_active" string="Active"
                        domain="[('status', '=', 'active')]"/>
                <filter name="filter_suspended" string="Suspended"
                        domain="[('status', '=', 'suspended')]"/>
                <filter name="filter_cancelled" string="Cancelled"
                        domain="[('status', '=', 'cancelled')]"/>
                <separator/>
                <filter name="filter_trial" string="In Trial"
                        domain="[('is_trial', '=', True)]"/>
                <group expand="0" string="Group By">
                    <filter name="group_tenant" string="Tenant"
                            context="{'group_by': 'tenant_account_id'}"/>
                    <filter name="group_provider" string="Provider"
                            context="{'group_by': 'provider_account_id'}"/>
                    <filter name="group_service" string="Service"
                            context="{'group_by': 'service_id'}"/>
                    <filter name="group_status" string="Status"
                            context="{'group_by': 'status'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- SaaS Subscription Action -->
    <record id="action_saas_subscription" model="ir.actions.act_window">
        <field name="name">Subscriptions</field>
        <field name="res_model">saas.subscription</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_saas_subscription_search"/>
        <field name="context">{'search_default_filter_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Subscription
            </p>
            <p>
                Subscriptions link tenants to provider services.
                They track billing, usage limits, and trial periods.
            </p>
        </field>
    </record>

    <!-- SaaS Account Link Form View -->
    <record id="view_saas_account_link_form" model="ir.ui.view">
        <field name="name">saas.account.link.form</field>
        <field name="model">saas.account.link</field>
        <field name="arch" type="xml">
            <form string="Account Link">
                <sheet>
                    <group>
                        <group>
                            <field name="from_account_id"/>
                            <field name="to_account_id"/>
                            <field name="link_type"/>
                            <field name="is_active"/>
                        </group>
                    </group>
                    <group>
                        <field name="metadata"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- SaaS Account Link List View -->
    <record id="view_saas_account_link_list" model="ir.ui.view">
        <field name="name">saas.account.link.list</field>
        <field name="model">saas.account.link</field>
        <field name="arch" type="xml">
            <list string="Account Links" decoration-muted="not is_active">
                <field name="from_account_id"/>
                <field name="link_type"/>
                <field name="to_account_id"/>
                <field name="is_active"/>
            </list>
        </field>
    </record>

    <!-- SaaS Account Link Action -->
    <record id="action_saas_account_link" model="ir.actions.act_window">
        <field name="name">Account Links</field>
        <field name="res_model">saas.account.link</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create account relationships
            </p>
            <p>
                Account links define relationships between organizations:
                provider-of, reseller-of, partner-of.
            </p>
        </field>
    </record>

    <!-- SaaS Environment Form View -->
    <record id="view_saas_environment_form" model="ir.ui.view">
        <field name="name">saas.environment.form</field>
        <field name="model">saas.environment</field>
        <field name="arch" type="xml">
            <form string="Environment">
                <header>
                    <button name="action_test_connection" type="object"
                            string="Test Connection" class="btn-secondary"/>
                </header>
                <sheet>
                    <group>
                        <group string="Basic Info">
                            <field name="account_id"/>
                            <field name="env_type"/>
                            <field name="is_active"/>
                        </group>
                        <group string="Supabase">
                            <field name="supabase_project_ref"/>
                            <field name="supabase_service_role" password="True"/>
                        </group>
                    </group>
                    <group>
                        <group string="Vercel">
                            <field name="vercel_project_id"/>
                            <field name="vercel_team_id"/>
                        </group>
                        <group string="DigitalOcean">
                            <field name="digitalocean_app_id"/>
                            <field name="digitalocean_cluster"/>
                        </group>
                    </group>
                    <group>
                        <group string="Odoo">
                            <field name="odoo_db_name"/>
                            <field name="odoo_base_url"/>
                        </group>
                        <group string="Superset">
                            <field name="superset_database_key"/>
                            <field name="superset_dashboard_ids"/>
                        </group>
                    </group>
                    <group>
                        <field name="supabase_id" readonly="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- SaaS Environment List View -->
    <record id="view_saas_environment_list" model="ir.ui.view">
        <field name="name">saas.environment.list</field>
        <field name="model">saas.environment</field>
        <field name="arch" type="xml">
            <list string="Environments" decoration-muted="not is_active">
                <field name="account_id"/>
                <field name="env_type"/>
                <field name="supabase_project_ref"/>
                <field name="odoo_db_name"/>
                <field name="vercel_project_id"/>
                <field name="is_active"/>
            </list>
        </field>
    </record>

    <!-- SaaS Environment Action -->
    <record id="action_saas_environment" model="ir.actions.act_window">
        <field name="name">Environments</field>
        <field name="res_model">saas.environment</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configure environments
            </p>
            <p>
                Environments map accounts to infrastructure bindings
                (Supabase, Vercel, DigitalOcean, Odoo, Superset).
            </p>
        </field>
    </record>

    <!-- SaaS Usage Record List View -->
    <record id="view_saas_usage_record_list" model="ir.ui.view">
        <field name="name">saas.usage.record.list</field>
        <field name="model">saas.usage.record</field>
        <field name="arch" type="xml">
            <list string="Usage Records" decoration-success="is_billed">
                <field name="subscription_id"/>
                <field name="tenant_account_id"/>
                <field name="service_id"/>
                <field name="period_start"/>
                <field name="period_end"/>
                <field name="request_count"/>
                <field name="token_count"/>
                <field name="is_billed"/>
                <field name="billed_at"/>
            </list>
        </field>
    </record>

    <!-- SaaS Usage Record Action -->
    <record id="action_saas_usage_record" model="ir.actions.act_window">
        <field name="name">Usage Records</field>
        <field name="res_model">saas.usage.record</field>
        <field name="view_mode">list</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No usage records yet
            </p>
            <p>
                Usage records track service consumption for billing
                and limit enforcement.
            </p>
        </field>
    </record>

</odoo>

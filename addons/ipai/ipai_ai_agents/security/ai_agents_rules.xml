<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="1">
        <!-- Agents: users can read enabled agents for their company or global agents -->
        <record id="rule_ipai_ai_agent_company" model="ir.rule">
            <field name="name">AI Agent: company scope</field>
            <field name="model_id" ref="model_ipai_ai_agent"/>
            <field name="domain_force">[
                '&amp;',
                ('enabled', '=', True),
                '|',
                ('company_id', '=', False),
                ('company_id', '=', user.company_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Threads: users can only access their own threads -->
        <record id="rule_ipai_ai_thread_own" model="ir.rule">
            <field name="name">AI Thread: own</field>
            <field name="model_id" ref="model_ipai_ai_thread"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Messages: users can only access messages for their own threads -->
        <record id="rule_ipai_ai_message_own" model="ir.rule">
            <field name="name">AI Message: own thread</field>
            <field name="model_id" ref="model_ipai_ai_message"/>
            <field name="domain_force">[('thread_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Sources: users can read sources for their company -->
        <record id="rule_ipai_ai_source_company" model="ir.rule">
            <field name="name">AI Source: company scope</field>
            <field name="model_id" ref="model_ipai_ai_source"/>
            <field name="domain_force">[
                '&amp;',
                ('enabled', '=', True),
                ('company_id', '=', user.company_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
    </data>
</odoo>
